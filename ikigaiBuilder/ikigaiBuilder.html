<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur d'Ikigai - Trouvez votre Raison d'Être</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="config.js"></script>
    <script src="demo-api.js"></script>
    <script src="ai-coach.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 25%, #32cd32 50%, #4169e1 75%, #9370db 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 25%, #32cd32 50%, #4169e1 75%, #9370db 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.95;
            font-size: 1.3rem;
            margin-bottom: 25px;
        }

        .ikigai-definition {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 500px;
            gap: 0;
            min-height: 80vh;
        }

        .form-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .visualization-section {
            padding: 40px;
            background: white;
            border-left: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            height: fit-content;
        }

        .ikigai-circle {
            width: 400px;
            height: 400px;
            position: relative;
            margin: 20px auto;
        }

        .circle {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            opacity: 0.7;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .circle:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .circle-passion {
            background: #ff6b6b;
            top: 0;
            left: 100px;
        }

        .circle-mission {
            background: #4169e1;
            top: 70px;
            left: 200px;
        }

        .circle-profession {
            background: #32cd32;
            top: 200px;
            left: 200px;
        }

        .circle-vocation {
            background: #ffa500;
            top: 200px;
            left: 0;
        }

        .intersection {
            position: absolute;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            text-align: center;
            border: 2px solid #333;
        }

        .intersection-love-good {
            width: 80px;
            height: 80px;
            top: 50px;
            left: 160px;
        }

        .intersection-good-paid {
            width: 80px;
            height: 80px;
            top: 120px;
            left: 220px;
        }

        .intersection-paid-need {
            width: 80px;
            height: 80px;
            top: 200px;
            left: 160px;
        }

        .intersection-need-love {
            width: 80px;
            height: 80px;
            top: 120px;
            left: 80px;
        }

        .ikigai-center {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border: 4px solid #333;
            border-radius: 50%;
            top: 150px;
            left: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        }

        .section-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #ddd;
            transition: all 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .section-card.passion { border-left-color: #ff6b6b; }
        .section-card.mission { border-left-color: #4169e1; }
        .section-card.profession { border-left-color: #32cd32; }
        .section-card.vocation { border-left-color: #ffa500; }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
        }

        .section-subtitle {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            min-height: 80px;
            background: white;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .tag-input-field {
            flex: 1;
            border: none;
            outline: none;
            padding: 6px;
            min-width: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .ikigai-result {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
        }

        .ikigai-statement {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            line-height: 1.4;
            margin-bottom: 20px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 3px solid #FFD700;
        }

        .ikigai-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .breakdown-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .breakdown-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .breakdown-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .breakdown-content {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s ease;
        }

        .progress-dot.filled {
            background: #28a745;
        }

        .suggestions {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }

        .suggestions h4 {
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .suggestion-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        /* Styles pour les nouvelles fonctionnalités */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .btn-guided {
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
        }

        .btn-guided:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .btn-small {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .btn-tiny {
            background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .btn-tiny:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        /* Styles pour la modale */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 20px;
        }

        .question-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .question-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .guided-question {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .question-text {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .question-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .blockage-alert {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .blockage-alert h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        /* Styles pour l'analyse de cohérence */
        .coherence-analysis {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e3f2fd;
        }

        .coherence-score {
            margin-bottom: 20px;
        }

        .score-label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .score-bar {
            background: #e2e8f0;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .coherence-section {
            margin-bottom: 20px;
        }

        .coherence-section h5 {
            color: #2d3748;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .contradiction-item {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .validation-item {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .alert-item {
            background: #cce5ff;
            border-left: 4px solid #0066cc;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        /* Styles pour les suggestions contextuelles */
        .contextual-suggestions {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #f3e5f5;
        }

        .suggestion-category {
            margin-bottom: 25px;
        }

        .suggestion-category h5 {
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .suggestion-item strong {
            color: #2d3748;
            display: block;
        }

        /* Styles pour l'analyse comportementale avancée */
        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(2px);
        }

        .tab-btn:hover:not(.active) {
            background: #f8f9fa;
            color: #495057;
        }

        .pattern-card, .prediction-card, .bias-card, .insight-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .pattern-header, .prediction-header, .bias-header, .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .confidence-badge, .probability-badge, .bias-status, .insight-category {
            background: #e9ecef;
            color: #495057;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .pattern-advice, .bias-solution, .insight-action {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border-left: 3px solid #28a745;
        }

        .bias-detected {
            border-left-color: #dc3545;
        }

        .bias-clear {
            border-left-color: #28a745;
        }

        .bias-status.bias-detected {
            background: #f8d7da;
            color: #721c24;
        }

        .bias-status.bias-clear {
            background: #d4edda;
            color: #155724;
        }

        .prediction-factors ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .prediction-factors li {
            margin-bottom: 5px;
            color: #495057;
        }

        .insight-resources {
            background: #fff3cd;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            border-left: 3px solid #ffc107;
        }

        /* Styles pour le parcours adaptatif */
        .adaptive-pathway {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #ff9800;
        }

        .pathway-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .pathway-step {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #dee2e6;
        }

        .pathway-step:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .pathway-step.current {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);
            border-left-color: #ff9800;
            font-weight: 600;
        }

        .pathway-step.completed {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-left-color: #4caf50;
            opacity: 0.8;
        }

        .pathway-step.pending {
            background: #f5f5f5;
            border-left-color: #bdbdbd;
            opacity: 0.7;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .pathway-step.current .step-number {
            background: #ff9800;
            color: white;
        }

        .pathway-step.completed .step-number {
            background: #4caf50;
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .step-section {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .step-status {
            font-size: 1.5rem;
        }

        .pathway-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .pathway-progress {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }

        .pathway-progress h5 {
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .step-suggestions {
            background: #fff3e0;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #ff9800;
        }

        .suggestion {
            margin: 5px 0;
            color: #e65100;
            font-size: 0.95rem;
        }

        /* Styles pour l'organisation des boutons */
        .action-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }

        .section-title {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-size: 1.1rem;
            padding: 15px 25px;
            font-weight: 600;
        }

        .advanced-btn {
            min-width: 200px;
            font-weight: 500;
        }

        .config-section {
            text-align: center;
            margin: 30px 0;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-config {
            background: linear-gradient(135deg, #607d8b 0%, #90a4ae 100%);
            font-size: 0.9rem;
            padding: 10px 20px;
            opacity: 0.8;
        }

        .btn-config:hover {
            opacity: 1;
        }

        /* Responsive pour les boutons */
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .advanced-btn {
                min-width: 250px;
            }
        }
            margin-bottom: 5px;
        }

        .no-suggestions {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        /* Styles pour l'évaluation psychologique */
        .psychological-results {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e1bee7;
        }

        .profile-section {
            margin-bottom: 15px;
        }

        .profile-section h5 {
            color: #2d3748;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trait-badge {
            background: linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 4px;
            display: inline-block;
        }

        /* Styles pour l'évaluation */
        .assessment-step {
            margin-bottom: 20px;
        }

        .assessment-question {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .question-text {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .likert-scale {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .likert-option input[type="radio"] {
            margin: 0;
        }

        .likert-option span {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .quick-questions {
            margin: 20px 0;
        }

        .quick-question {
            margin-bottom: 20px;
        }

        .quick-question label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .quick-question select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* Styles pour le parcours adaptatif */
        .adaptive-pathway {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #fff3e0;
        }

        .pathway-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .pathway-step {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }

        .pathway-step:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .pathway-step.completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }

        .pathway-step.current {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #ffc107;
        }

        .pathway-step.pending {
            background: #f8f9fa;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .pathway-step.completed .step-number {
            background: #28a745;
        }

        .pathway-step.current .step-number {
            background: #ffc107;
            color: #212529;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .step-section {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .step-status {
            font-size: 1.5rem;
        }

        .pathway-navigation {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        /* Styles pour le matching carrière */
        .career-matches {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .career-match {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #e2e8f0;
        }

        .career-match.excellent {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
        }

        .career-match.très-bon {
            border-left-color: #20c997;
            background: linear-gradient(135deg, #f8fffe 0%, #e8f8f7 100%);
        }

        .career-match.bon {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffef8 0%, #fef7e8 100%);
        }

        .career-match.faible {
            border-left-color: #6c757d;
            background: #f8f9fa;
        }

        .career-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .career-header h4 {
            margin: 0;
            color: #2d3748;
            flex: 1;
        }

        .match-score {
            text-align: right;
        }

        .score-bar {
            width: 100px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .score-text {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .career-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .career-info {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .career-info span {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .career-description {
            font-size: 0.9rem;
        }

        .career-description ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .career-description li {
            margin-bottom: 4px;
        }

        .career-actions {
            display: flex;
            gap: 10px;
        }

        /* Styles pour les modales larges */
        .large-modal .modal-content {
            max-width: 900px;
        }

        /* Animations supplémentaires */
        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .career-match {
            animation: slideInFromBottom 0.5s ease;
        }

        /* Styles pour les recommandations avancées */
        .recommendations-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .training-list, .projects-list, .risks-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .training-item, .project-item, .risk-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .training-item h5, .project-item h5, .risk-item h5 {
            margin: 0 0 10px 0;
            color: #2d3748;
        }

        .training-details {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .training-details span {
            background: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .training-outcomes ul, .project-tips ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .training-outcomes li, .project-tips li {
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .project-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .project-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .project-content {
            flex: 1;
        }

        .project-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .risk-item {
            border-left-color: #ffc107;
        }

        .risk-header h5 {
            color: #856404;
        }

        .risk-mitigation {
            margin-top: 10px;
        }

        .risk-mitigation p {
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Styles pour la timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .timeline-phase {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1;
        }

        .phase-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .phase-info h5 {
            margin: 0;
            color: #2d3748;
        }

        .phase-duration {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .phase-tasks ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .phase-tasks li {
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        /* Styles pour les actions */
        .action-steps {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .action-step {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #28a745;
        }

        .action-step h5 {
            margin: 0 0 10px 0;
            color: #2d3748;
        }

        .action-step ul {
            margin: 0;
            padding-left: 20px;
        }

        .action-step li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .motivation-boost {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #ffc107;
        }

        .motivation-boost h5 {
            color: #856404;
            margin-bottom: 10px;
        }

        .motivation-boost ul {
            margin: 0;
            padding-left: 20px;
        }

        .motivation-boost li {
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        /* Styles pour le Coach IA */
        .ai-coach-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .coach-info {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .coach-avatar {
            font-size: 3rem;
            margin-right: 15px;
        }

        .coach-details h4 {
            margin: 0 0 5px 0;
            color: #2d3748;
        }

        .coach-details p {
            margin: 0 0 10px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .coach-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #28a745;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-dot.online {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
            max-height: 400px;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
            animation: slideInMessage 0.3s ease;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.user-message {
            flex-direction: row-reverse;
        }

        .message.user-message .message-avatar {
            margin-right: 0;
            margin-left: 15px;
        }

        .message.user-message .message-content {
            align-items: flex-end;
        }

        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .message-text {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            line-height: 1.4;
            max-width: 80%;
        }

        .user-message .message-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-time {
            font-size: 0.7rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .system-message .message-text {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
        }

        .chat-input-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .chat-input-wrapper textarea {
            flex: 1;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            font-size: 1rem;
            resize: none;
            transition: all 0.3s ease;
        }

        .chat-input-wrapper textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chat-input-wrapper textarea:disabled {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        .btn-send {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-send:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-send:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* Styles pour l'analyse comportementale */
        .analysis-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .behavioral-results {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .analysis-section h4 {
            margin: 0 0 15px 0;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pattern-card, .prediction-card, .bias-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .pattern-header, .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .pattern-header h5, .prediction-header h5, .bias-card h5 {
            margin: 0;
            color: #2d3748;
        }

        .confidence-badge, .probability-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .probability-badge {
            background: linear-gradient(135deg, #28a745 0%, #81c784 100%);
        }

        .prediction-factors ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .prediction-factors li {
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .recommendation-item {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #2196f3;
        }

        .no-analysis {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        .loading-analysis {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .analysis-error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }

        .tab-placeholder {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        /* Styles pour la configuration */
        .config-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .config-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .config-section h4 {
            margin: 0 0 15px 0;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-group {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .config-group label {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .config-group input[type="password"],
        .config-group input[type="text"],
        .config-group input[type="number"],
        .config-group select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .config-group input[type="password"]:focus,
        .config-group input[type="text"]:focus,
        .config-group input[type="number"]:focus,
        .config-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .config-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .config-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .config-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .config-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }

        .config-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 8px;
        }

        /* Animations */
        @keyframes slideInMessage {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Styles pour les patterns de procrastination */
        .procrastination-pattern {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #ffc107;
        }

        .procrastination-pattern h5 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .pattern-triggers, .pattern-advice {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .pattern-triggers strong, .pattern-advice strong {
            color: #856404;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .visualization-section {
                border-left: none;
                border-top: 2px solid #e9ecef;
            }
            
            .ikigai-circle {
                width: 300px;
                height: 300px;
            }
            
            .circle {
                width: 150px;
                height: 150px;
                font-size: 0.8rem;
                padding: 15px;
            }
            
            .circle-passion { top: 0; left: 75px; }
            .circle-mission { top: 50px; left: 150px; }
            .circle-profession { top: 150px; left: 150px; }
            .circle-vocation { top: 150px; left: 0; }
            .ikigai-center { top: 100px; left: 100px; width: 80px; height: 80px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌸 Générateur d'Ikigai</h1>
            <p>Découvrez votre raison d'être selon la philosophie japonaise</p>
            <div class="ikigai-definition">
                <strong>Ikigai (生き甲斐)</strong> : Concept japonais qui signifie "raison d'être" ou "ce pour quoi on se lève le matin". 
                C'est l'intersection entre ce que vous aimez, ce en quoi vous excellez, ce dont le monde a besoin et ce pour quoi vous pouvez être payé.
            </div>
        </div>

        <div class="main-content">
            <div class="form-section">
                <div class="progress-indicator">
                    <div class="progress-dot filled" id="dot1"></div>
                    <div class="progress-dot" id="dot2"></div>
                    <div class="progress-dot" id="dot3"></div>
                    <div class="progress-dot" id="dot4"></div>
                    <div class="progress-dot" id="dot5"></div>
                </div>

                <!-- Section 1: Ce que vous aimez (Passion) -->
                <div class="section-card passion">
                    <div class="section-header">
                        <div class="section-icon">❤️</div>
                        <div>
                            <div class="section-title">Ce que vous AIMEZ</div>
                            <div class="section-subtitle">Vos passions et centres d'intérêt</div>
                        </div>
                        <button class="btn-guided" onclick="showGuidedQuestions('passions')" title="Questions guidées pour explorer vos passions">🧠</button>
                    </div>

                    <div class="form-group">
                        <label>Quelles activités vous passionnent vraiment ?</label>
                        <div class="tag-input" id="passionTags">
                            <input type="text" class="tag-input-field" placeholder="Tapez et appuyez sur Entrée pour ajouter..." 
                                   onkeypress="addTag(event, 'passionTags', 'passions')">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Décrivez votre passion principale</label>
                        <textarea id="passionDescription" placeholder="Qu'est-ce qui vous anime le plus ? Pourquoi cette passion est-elle importante pour vous ?"></textarea>
                    </div>
                </div>

                <!-- Section 2: Ce en quoi vous excellez (Mission) -->
                <div class="section-card mission">
                    <div class="section-header">
                        <div class="section-icon">🎯</div>
                        <div>
                            <div class="section-title">Ce en quoi vous EXCELLEZ</div>
                            <div class="section-subtitle">Vos talents et compétences naturelles</div>
                        </div>
                        <button class="btn-guided" onclick="showGuidedQuestions('talents')" title="Questions guidées pour identifier vos talents">🧠</button>
                    </div>

                    <div class="form-group">
                        <label>Quels sont vos talents naturels ?</label>
                        <div class="tag-input" id="talentTags">
                            <input type="text" class="tag-input-field" placeholder="Tapez et appuyez sur Entrée pour ajouter..." 
                                   onkeypress="addTag(event, 'talentTags', 'talents')">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Qu'est-ce que les autres reconnaissent en vous ?</label>
                        <textarea id="talentFeedback" placeholder="Quels compliments recevez-vous souvent ? Dans quoi les autres viennent-ils vous chercher ?"></textarea>
                    </div>
                </div>

                <!-- Section 3: Ce dont le monde a besoin (Profession) -->
                <div class="section-card profession">
                    <div class="section-header">
                        <div class="section-icon">🌍</div>
                        <div>
                            <div class="section-title">Ce dont le monde a BESOIN</div>
                            <div class="section-subtitle">Les problèmes que vous pouvez résoudre</div>
                        </div>
                        <button class="btn-guided" onclick="showGuidedQuestions('problems')" title="Questions guidées pour identifier les besoins mondiaux">🧠</button>
                    </div>

                    <div class="form-group">
                        <label>Quels problèmes vous préoccupent ?</label>
                        <div class="tag-input" id="problemTags">
                            <input type="text" class="tag-input-field" placeholder="Tapez et appuyez sur Entrée pour ajouter..." 
                                   onkeypress="addTag(event, 'problemTags', 'problems')">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Comment voulez-vous contribuer à améliorer le monde ?</label>
                        <textarea id="worldContribution" placeholder="Quel impact positif souhaitez-vous avoir ? Quels changements voulez-vous voir ?"></textarea>
                    </div>
                </div>

                <!-- Section 4: Ce pour quoi vous pouvez être payé (Vocation) -->
                <div class="section-card vocation">
                    <div class="section-header">
                        <div class="section-icon">💰</div>
                        <div>
                            <div class="section-title">Ce pour quoi vous pouvez être PAYÉ</div>
                            <div class="section-subtitle">Vos compétences monétisables</div>
                        </div>
                        <button class="btn-guided" onclick="showGuidedQuestions('skills')" title="Questions guidées pour identifier vos compétences monétisables">🧠</button>
                    </div>

                    <div class="form-group">
                        <label>Quelles compétences peuvent générer des revenus ?</label>
                        <div class="tag-input" id="skillTags">
                            <input type="text" class="tag-input-field" placeholder="Tapez et appuyez sur Entrée pour ajouter..." 
                                   onkeypress="addTag(event, 'skillTags', 'skills')">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Quelles opportunités économiques voyez-vous ?</label>
                        <textarea id="economicOpportunities" placeholder="Comment pourriez-vous monétiser vos talents ? Quels marchés vous intéressent ?"></textarea>
                    </div>
                </div>

                <!-- Actions principales sur les données -->
                <div class="action-section">
                    <h4 class="section-title">🔍 Actions Principales</h4>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="analyzeIkigai()">🔍 Analyser mon Ikigai</button>
                        <button class="btn btn-warning" onclick="fillExampleData()">🧪 Données d'exemple</button>
                    </div>
                </div>

                <!-- Sauvegarde et export -->
                <div class="action-section">
                    <h4 class="section-title">💾 Sauvegarde & Export</h4>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="generateIkigaiPDF()">📄 Générer PDF</button>
                        <button class="btn btn-info" onclick="saveProgress()">💾 Sauvegarder</button>
                        <button class="btn btn-secondary" onclick="loadProgress()">📂 Charger</button>
                        <button class="btn btn-outline" onclick="exportToJSON()">📤 Exporter JSON</button>
                    </div>
                </div>

                <!-- Outils d'analyse avancés -->
                <div class="action-section">
                    <h4 class="section-title">🚀 Outils d'Analyse Avancés</h4>
                    <div class="action-buttons">
                        <button class="btn advanced-btn" onclick="startPsychologicalAssessment()" style="background: linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%);">🧠 Évaluation Psychologique</button>
                        <button class="btn advanced-btn" onclick="initializeAdaptivePathway()" style="background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);">🧭 Parcours Adaptatif</button>
                        <button class="btn advanced-btn" onclick="findCareerMatches()" style="background: linear-gradient(135deg, #2196f3 0%, #64b5f6 100%);">🎯 Métiers Recommandés</button>
                        <button class="btn advanced-btn" onclick="startAICoach()" style="background: linear-gradient(135deg, #4caf50 0%, #81c784 100%);">🤖 Coach IA</button>
                        <button class="btn advanced-btn" onclick="showBehavioralAnalysis()" style="background: linear-gradient(135deg, #ff5722 0%, #ff8a65 100%);">📊 Analyse Comportementale</button>
                    </div>
                </div>

                <!-- Configuration -->
                <div class="config-section">
                    <button class="btn btn-config" onclick="openConfigPanel()">⚙️ Configuration</button>
                </div>

                <div id="ikigaiResult" class="ikigai-result" style="display: none;">
                    <div class="ikigai-statement" id="ikigaiStatement">
                        Votre Ikigai sera généré ici...
                    </div>

                    <div class="ikigai-breakdown">
                        <div class="breakdown-item">
                            <div class="breakdown-icon">❤️</div>
                            <div class="breakdown-title">Votre Passion</div>
                            <div class="breakdown-content" id="passionSummary"></div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-icon">🎯</div>
                            <div class="breakdown-title">Votre Mission</div>
                            <div class="breakdown-content" id="missionSummary"></div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-icon">💼</div>
                            <div class="breakdown-title">Votre Profession</div>
                            <div class="breakdown-content" id="professionSummary"></div>
                        </div>
                        <div class="breakdown-item">
                            <div class="breakdown-icon">🌟</div>
                            <div class="breakdown-title">Votre Vocation</div>
                            <div class="breakdown-content" id="vocationSummary"></div>
                        </div>
                    </div>

                    <div class="suggestions">
                        <h4>💡 Recommandations pour vivre votre Ikigai</h4>
                        <div id="recommendations"></div>
                    </div>
                </div>
            </div>

            <div class="visualization-section">
                <h3 style="text-align: center; margin-bottom: 20px;">🌸 Votre Ikigai Visuel</h3>
                
                <div class="ikigai-circle">
                    <!-- Les 4 cercles principaux -->
                    <div class="circle circle-passion" onclick="highlightSection('passion')">
                        <div>Ce que vous<br><strong>AIMEZ</strong></div>
                    </div>
                    <div class="circle circle-mission" onclick="highlightSection('mission')">
                        <div>Ce en quoi vous<br><strong>EXCELLEZ</strong></div>
                    </div>
                    <div class="circle circle-profession" onclick="highlightSection('profession')">
                        <div>Ce dont le monde<br>a <strong>BESOIN</strong></div>
                    </div>
                    <div class="circle circle-vocation" onclick="highlightSection('vocation')">
                        <div>Ce pour quoi vous<br>pouvez être <strong>PAYÉ</strong></div>
                    </div>

                    <!-- Les intersections -->
                    <div class="intersection intersection-love-good">
                        <div>PASSION</div>
                    </div>
                    <div class="intersection intersection-good-paid">
                        <div>MISSION</div>
                    </div>
                    <div class="intersection intersection-paid-need">
                        <div>PROFESSION</div>
                    </div>
                    <div class="intersection intersection-need-love">
                        <div>VOCATION</div>
                    </div>

                    <!-- Le centre : Ikigai -->
                    <div class="ikigai-center">
                        <div>IKIGAI</div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h4>📊 Votre progression</h4>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Passions définies</span>
                            <span id="passionProgress">0%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                            <div id="passionBar" style="background: #ff6b6b; height: 100%; width: 0%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Talents identifiés</span>
                            <span id="talentProgress">0%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                            <div id="talentBar" style="background: #4169e1; height: 100%; width: 0%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Besoins identifiés</span>
                            <span id="needProgress">0%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                            <div id="needBar" style="background: #32cd32; height: 100%; width: 0%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Opportunités définies</span>
                            <span id="opportunityProgress">0%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px;">
                            <div id="opportunityBar" style="background: #ffa500; height: 100%; width: 0%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h4>🎋 Sagesse japonaise</h4>
                    <div style="font-style: italic; color: #6c757d; margin-top: 10px;" id="wisdomQuote">
                        "L'ikigai est la raison pour laquelle vous vous levez le matin."
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let ikigaiData = {
            passions: [],
            talents: [],
            problems: [],
            skills: []
        };

        // Système de questions intelligentes
        let guidedQuestions = {
            currentSection: null,
            questionHistory: [],
            blockages: [],
            analogies: [],
            triggerQuestions: []
        };

        // Système de profilage psychologique
        let psychologicalProfile = {
            bigFive: {
                openness: 0,
                conscientiousness: 0,
                extraversion: 0,
                agreeableness: 0,
                neuroticism: 0
            },
            motivations: {
                intrinsic: 0,
                extrinsic: 0,
                autonomy: 0,
                security: 0
            },
            learningStyles: {
                visual: 0,
                auditory: 0,
                kinesthetic: 0
            },
            procrastinationPatterns: [],
            profileComplete: false
        };

        // Parcours adaptatif
        let adaptivePathway = {
            currentStep: 0,
            pathway: [],
            alternatives: [],
            startingPoint: null,
            progress: 0
        };

        // Questions de profilage psychologique
        const psychologicalQuestions = {
            bigFive: {
                openness: [
                    "Vous préférez les routines établies plutôt que l'imprévu",
                    "Vous êtes curieux(se) et aimez découvrir de nouvelles idées",
                    "Vous préférez les activités familières aux nouvelles expériences",
                    "Vous aimez l'art et trouvez de la beauté dans les choses inhabituelles",
                    "Vous êtes plutôt conservateur(trice) dans vos goûts"
                ],
                conscientiousness: [
                    "Vous êtes organisé(e) et aimez planifier à l'avance",
                    "Vous remettez souvent les tâches à plus tard",
                    "Vous êtes fiable et tenez vos promesses",
                    "Vous préférez l'improvisation à la planification détaillée",
                    "Vous êtes discipliné(e) dans votre travail"
                ],
                extraversion: [
                    "Vous aimez être au centre de l'attention",
                    "Vous préférez les activités solitaires aux rassemblements",
                    "Vous êtes énergique et enthousiaste en société",
                    "Vous êtes plutôt réservé(e) et discret(ète)",
                    "Vous aimez rencontrer de nouvelles personnes"
                ],
                agreeableness: [
                    "Vous êtes compatissant(e) et attentionné(e) envers les autres",
                    "Vous êtes compétitif(ve) et aimez gagner",
                    "Vous pardonnez facilement aux autres",
                    "Vous dites ce que vous pensez même si ça peut blesser",
                    "Vous aidez les autres sans attendre quelque chose en retour"
                ],
                neuroticism: [
                    "Vous vous inquiétez beaucoup pour l'avenir",
                    "Vous restez calme dans les situations stressantes",
                    "Vous êtes sensible aux critiques",
                    "Vous êtes émotionnellement stable",
                    "Vous vous sentez souvent anxieux(se)"
                ]
            },
            motivations: {
                intrinsic: [
                    "Vous travaillez dur parce que vous aimez ce que vous faites",
                    "Vous êtes motivé(e) par l'argent et les récompenses",
                    "Vous trouvez du plaisir dans le processus d'apprentissage",
                    "Vous êtes poussé(e) par la reconnaissance sociale",
                    "Vous aimez relever des défis pour le plaisir intellectuel"
                ],
                extrinsic: [
                    "Vous êtes motivé(e) par les compliments et la reconnaissance",
                    "Vous travaillez pour atteindre des objectifs personnels",
                    "Vous êtes poussé(e) par l'argent et les avantages matériels",
                    "Vous aimez aider les autres sans attendre de récompense",
                    "Vous êtes motivé(e) par le statut social"
                ],
                autonomy: [
                    "Vous aimez prendre vos propres décisions",
                    "Vous préférez suivre les instructions claires",
                    "Vous êtes indépendant(e) dans votre travail",
                    "Vous aimez travailler en équipe avec supervision",
                    "Vous déterminez vos propres objectifs"
                ],
                security: [
                    "Vous préférez la stabilité à l'aventure",
                    "Vous aimez prendre des risques calculés",
                    "Vous valorisez la sécurité de l'emploi",
                    "Vous êtes attiré(e) par les opportunités entrepreneuriales",
                    "Vous préférez les situations prévisibles"
                ]
            },
            learningStyles: {
                visual: [
                    "Vous retenez mieux ce que vous voyez (diagrammes, images)",
                    "Vous préférez écouter les explications",
                    "Vous aimez prendre des notes et faire des schémas",
                    "Vous apprenez mieux en faisant des expériences pratiques",
                    "Vous visualisez mentalement les concepts"
                ],
                auditory: [
                    "Vous retenez mieux ce que vous entendez",
                    "Vous aimez lire et prendre des notes",
                    "Vous apprenez en écoutant des podcasts ou conférences",
                    "Vous préférez les démonstrations pratiques",
                    "Vous répétez à voix haute pour mémoriser"
                ],
                kinesthetic: [
                    "Vous apprenez mieux en faisant des expériences",
                    "Vous aimez les explications théoriques",
                    "Vous retenez mieux en marchant ou bougeant",
                    "Vous préférez les discussions de groupe",
                    "Vous avez besoin de toucher et manipuler pour comprendre"
                ]
            },
            procrastination: [
                "Vous remettez les tâches importantes à plus tard",
                "Vous commencez par les tâches faciles plutôt que les difficiles",
                "Vous vous sentez paralysé(e) par la peur de l'échec",
                "Vous êtes perfectionniste et attendez les conditions idéales",
                "Vous êtes distrait(e) par les réseaux sociaux ou autres activités",
                "Vous sous-estimez le temps nécessaire pour les tâches",
                "Vous attendez la dernière minute pour agir"
            ]
        };

        // Base de données de questions intelligentes
        const questionDatabase = {
            passions: {
                socratic: [
                    "Qu'est-ce qui vous fait perdre la notion du temps ?",
                    "Si vous pouviez passer une journée parfaite, que feriez-vous ?",
                    "Quelles activités vous rendent le plus heureux, même si elles sont difficiles ?",
                    "Si l'argent n'était pas un problème, comment passeriez-vous vos journées ?",
                    "Quels sujets vous passionnent au point d'en parler pendant des heures ?"
                ],
                analogies: [
                    "Si vous étiez un animal, lequel seriez-vous et pourquoi ?",
                    "Si vous étiez un super-héros, quel serait votre pouvoir unique ?",
                    "Si votre vie était un film, quel serait le genre principal ?",
                    "Si vous étiez un instrument de musique, lequel seriez-vous ?",
                    "Si vous étiez une saison, laquelle seriez-vous et pourquoi ?"
                ],
                triggers: [
                    "Quel jeu vous fascinait enfant et pourquoi ?",
                    "Quel était votre rêve d'enfant que vous avez abandonné ?",
                    "Dans quel état de flow vous êtes-vous déjà retrouvé naturellement ?",
                    "Quelle frustration profonde vous motive à agir ?",
                    "Quel compliment vous touche le plus profondément ?"
                ]
            },
            talents: {
                socratic: [
                    "Quelles tâches les gens vous demandent-ils souvent d'accomplir ?",
                    "Dans quoi les autres vous disent-ils que vous êtes naturellement doué ?",
                    "Quelles compétences maîtrisez-vous sans effort apparent ?",
                    "Quels problèmes résolvez-vous plus facilement que les autres ?",
                    "Dans quel domaine recevez-vous le plus de compliments ?"
                ],
                analogies: [
                    "Si vous étiez un outil, lequel seriez-vous dans une boîte à outils ?",
                    "Si vous étiez un sport, lequel seriez-vous et pourquoi ?",
                    "Si vous étiez une couleur, laquelle seriez-vous et que représenteriez-vous ?",
                    "Si vous étiez un métier historique, lequel seriez-vous ?",
                    "Si vous étiez un élément chimique, lequel seriez-vous ?"
                ],
                triggers: [
                    "Quelle compétence avez-vous développée naturellement sans formation ?",
                    "Dans quoi étiez-vous meilleur que vos pairs à l'école ?",
                    "Quel défi avez-vous relevé avec une facilité surprenante ?",
                    "Quelle activité vous vient naturellement quand vous êtes stressé ?",
                    "Quel talent vous a sauvé dans une situation difficile ?"
                ]
            },
            problems: {
                socratic: [
                    "Quels problèmes du monde vous empêchent de dormir la nuit ?",
                    "Quelle injustice vous révolte le plus profondément ?",
                    "Quels changements aimeriez-vous voir dans votre communauté ?",
                    "Quel problème personnel vous motive à aider les autres ?",
                    "Quelle cause défendriez-vous même si elle était impopulaire ?"
                ],
                analogies: [
                    "Si le monde était un jardin, quelle mauvaise herbe arracheriez-vous ?",
                    "Si vous étiez un médecin, quelle maladie mondiale traiteriez-vous ?",
                    "Si vous étiez un architecte, quel bâtiment social reconstruiriez-vous ?",
                    "Si vous étiez un juge, quelle loi changeriez-vous ?",
                    "Si vous étiez un explorateur, quelle terra incognita découvririez-vous ?"
                ],
                triggers: [
                    "Quelle situation d'injustice vous a marqué enfant ?",
                    "Quel problème familial vous motive à agir ?",
                    "Quelle frustration professionnelle vous pousse à innover ?",
                    "Quel besoin social vous touche personnellement ?",
                    "Quelle cause environnementale vous concerne directement ?"
                ]
            },
            skills: {
                socratic: [
                    "Quelles compétences pourraient générer des revenus selon votre entourage ?",
                    "Dans quoi pourriez-vous facturer vos services dès demain ?",
                    "Quelles expertises uniques pourriez-vous monétiser ?",
                    "Quel savoir-faire avez-vous que les autres paieraient pour acquérir ?",
                    "Quelle valeur ajoutée pourriez-vous vendre à des entreprises ?"
                ],
                analogies: [
                    "Si vous étiez une entreprise, quel produit vendriez-vous ?",
                    "Si vous étiez un service, lequel seriez-vous sur un menu ?",
                    "Si vous étiez une monnaie, quelle valeur représenteriez-vous ?",
                    "Si vous étiez un marché, quelle niche occuperiez-vous ?",
                    "Si vous étiez un investissement, quel rendement promettriez-vous ?"
                ],
                triggers: [
                    "Quelle compétence avez-vous utilisée pour gagner de l'argent jeune ?",
                    "Quel talent vous a rapporté de l'argent de façon inattendue ?",
                    "Quelle expertise vous a valu une promotion ou une augmentation ?",
                    "Quel savoir-faire vous a permis de rendre service contre rémunération ?",
                    "Quelle compétence avez-vous développée spécifiquement pour gagner votre vie ?"
                ]
            }
        };

        const wisdomQuotes = [
            "L'ikigai est la raison pour laquelle vous vous levez le matin.",
            "Votre ikigai se trouve à l'intersection de vos passions et du service aux autres.",
            "Il n'y a pas de plus grande joie que de vivre selon son ikigai.",
            "L'ikigai n'est pas quelque chose que vous trouvez, c'est quelque chose que vous cultivez.",
            "Votre ikigai évolue avec vous tout au long de votre vie."
        ];

        // Gestion des tags
        function addTag(event, containerId, dataKey) {
            if (event.key === 'Enter' && event.target.value.trim() !== '') {
                const value = event.target.value.trim();
                const container = document.getElementById(containerId);
                
                // Vérifier si le tag existe déjà
                if (ikigaiData[dataKey].includes(value)) {
                    event.target.value = '';
                    return;
                }
                
                // Ajouter à la données
                ikigaiData[dataKey].push(value);
                
                // Créer l'élément tag
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `
                    ${value}
                    <span class="tag-remove" onclick="removeTag('${value}', '${containerId}', '${dataKey}')">×</span>
                `;
                
                // Insérer avant le champ de saisie
                container.insertBefore(tag, container.lastElementChild);
                event.target.value = '';
                
                updateProgress();
                updateDots();
                updateAdaptivePathway();
            }
        }

        function removeTag(value, containerId, dataKey) {
            // Supprimer des données
            ikigaiData[dataKey] = ikigaiData[dataKey].filter(item => item !== value);

            // Supprimer de l'interface
            const container = document.getElementById(containerId);
            const tags = container.querySelectorAll('.tag');
            tags.forEach(tag => {
                if (tag.textContent.includes(value)) {
                    tag.remove();
                }
            });

            updateProgress();
            updateDots();
            analyzeCoherence(); // Analyser la cohérence après modification
            updateAdaptivePathway();
        }

        function updateAdaptivePathway() {
            // Seulement mettre à jour si le parcours adaptatif est actif
            if (adaptivePathway && adaptivePathway.pathway && adaptivePathway.pathway.length > 0) {
                // Vérifier si l'étape actuelle est maintenant complétée
                checkStepCompletion(adaptivePathway.currentStep);
                
                // Redessiner le parcours pour refléter les nouveaux états
                const pathwayDiv = document.getElementById('adaptivePathway');
                if (pathwayDiv && pathwayDiv.style.display !== 'none') {
                    displayAdaptivePathway();
                }
            }
        }

        // Système de questions guidées
        function showGuidedQuestions(section) {
            guidedQuestions.currentSection = section;
            const questions = questionDatabase[section];

            // Créer la modale de questions
            const modal = document.createElement('div');
            modal.id = 'guidedQuestionsModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>🧠 Questions guidées - ${getSectionTitle(section)}</h3>
                        <button class="modal-close" onclick="closeGuidedQuestions()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="question-tabs">
                            <button class="tab-btn active" onclick="switchQuestionTab('socratic')">❓ Socratique</button>
                            <button class="tab-btn" onclick="switchQuestionTab('analogies')">🎭 Analogies</button>
                            <button class="tab-btn" onclick="switchQuestionTab('triggers')">🎯 Déclencheurs</button>
                        </div>
                        <div id="questionContent" class="question-content">
                            ${generateQuestionList('socratic', questions.socratic)}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function switchQuestionTab(type) {
            const questions = questionDatabase[guidedQuestions.currentSection];
            const content = document.getElementById('questionContent');

            // Mettre à jour les onglets actifs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Générer le contenu selon le type
            switch(type) {
                case 'socratic':
                    content.innerHTML = generateQuestionList('socratic', questions.socratic);
                    break;
                case 'analogies':
                    content.innerHTML = generateQuestionList('analogies', questions.analogies);
                    break;
                case 'triggers':
                    content.innerHTML = generateQuestionList('triggers', questions.triggers);
                    break;
            }
        }

        function generateQuestionList(type, questions) {
            return questions.map((question, index) => `
                <div class="guided-question">
                    <div class="question-text">${question}</div>
                    <div class="question-actions">
                        <button class="btn-small" onclick="answerQuestion('${type}', ${index}, 'yes')">✅ Oui, ça m'aide</button>
                        <button class="btn-small" onclick="answerQuestion('${type}', ${index}, 'no')">❌ Pas pertinent</button>
                        <button class="btn-small" onclick="answerQuestion('${type}', ${index}, 'block')">🤔 Je bloque</button>
                    </div>
                </div>
            `).join('');
        }

        function answerQuestion(type, index, response) {
            const question = questionDatabase[guidedQuestions.currentSection][type][index];

            if (response === 'block') {
                handleBlockage(guidedQuestions.currentSection, question);
            } else if (response === 'yes') {
                // Ouvrir un prompt pour saisir une réponse
                const answer = prompt(`Votre réponse à : "${question}"`);
                if (answer && answer.trim()) {
                    addInsightFromQuestion(guidedQuestions.currentSection, answer.trim());
                }
            }

            // Marquer la question comme répondue
            guidedQuestions.questionHistory.push({
                section: guidedQuestions.currentSection,
                type: type,
                question: question,
                response: response,
                timestamp: new Date()
            });
        }

        function handleBlockage(section, question) {
            const alternatives = getAlternativeQuestions(section, question);
            const modal = document.getElementById('guidedQuestionsModal');

            if (modal) {
                const content = document.getElementById('questionContent');
                content.innerHTML = `
                    <div class="blockage-alert">
                        <h4>🤔 Vous bloquez sur cette question ?</h4>
                        <p>Essayons une approche différente :</p>
                        ${alternatives.map(alt => `
                            <div class="guided-question">
                                <div class="question-text">${alt}</div>
                                <div class="question-actions">
                                    <button class="btn-small" onclick="addInsightFromQuestion('${section}', prompt('Votre réponse :'))">💡 Répondre</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function getAlternativeQuestions(section, originalQuestion) {
            // Générer des questions alternatives basées sur la section
            const alternatives = {
                passions: [
                    "Qu'est-ce qui vous énerve quand ce n'est pas fait correctement ?",
                    "Quel sujet vous fait vibrer dans les conversations ?",
                    "Si vous aviez 3 mois de liberté totale, que feriez-vous ?"
                ],
                talents: [
                    "Quelles tâches faites-vous mieux que la moyenne ?",
                    "Dans quoi êtes-vous plus rapide que les autres ?",
                    "Quel compliment recevez-vous régulièrement ?"
                ],
                problems: [
                    "Quelle situation vous met en colère ?",
                    "Quel changement aimeriez-vous voir autour de vous ?",
                    "Quelle injustice vous touche personnellement ?"
                ],
                skills: [
                    "Qu'est-ce que vous savez faire que peu de gens maîtrisent ?",
                    "Quelle compétence vous démarque professionnellement ?",
                    "Dans quoi pourriez-vous former quelqu'un ?"
                ]
            };

            return alternatives[section] || [];
        }

        function addInsightFromQuestion(section, answer) {
            if (!answer) return;

            // Analyser la réponse pour extraire des insights
            const insights = analyzeAnswer(answer);

            // Ajouter les insights aux données appropriées
            insights.forEach(insight => {
                if (!ikigaiData[section].includes(insight)) {
                    ikigaiData[section].push(insight);
                    updateTagDisplay(`${section}Tags`, ikigaiData[section], section + 's');
                }
            });

            updateProgress();
            updateDots();
            analyzeCoherence();

            // Fermer la modale si elle existe
            closeGuidedQuestions();
        }

        function analyzeAnswer(answer) {
            // Analyse simple du texte pour extraire des mots-clés
            const keywords = answer.toLowerCase().split(/[\s,.;!?]+/).filter(word => word.length > 2);

            // Filtrer les mots intéressants (à améliorer avec NLP plus tard)
            const interestingWords = keywords.filter(word =>
                !['mais', 'pour', 'dans', 'avec', 'sans', 'chez', 'vers', 'sous', 'sur', 'par', 'que', 'qui', 'quoi', 'quand', 'comment', 'pourquoi'].includes(word)
            );

            return interestingWords.slice(0, 3); // Retourner max 3 insights
        }

        function closeGuidedQuestions() {
            const modal = document.getElementById('guidedQuestionsModal');
            if (modal) {
                modal.remove();
            }
        }

        function getSectionTitle(section) {
            const titles = {
                passions: 'Ce que vous aimez',
                talents: 'Ce en quoi vous excellez',
                problems: 'Ce dont le monde a besoin',
                skills: 'Ce pour quoi vous pouvez être payé'
            };
            return titles[section] || section;
        }

        // Analyse de cohérence en temps réel
        function analyzeCoherence() {
            const coherenceResults = {
                contradictions: [],
                validations: [],
                realismScore: 0,
                alerts: []
            };

            // Détection de contradictions
            coherenceResults.contradiictions = detectContradictions();

            // Validation croisée
            coherenceResults.validations = crossValidate();

            // Score de réalisme
            coherenceResults.realismScore = calculateRealismScore();

            // Alertes d'auto-illusion
            coherenceResults.alerts = detectIllusions();

            // Afficher les résultats
            displayCoherenceResults(coherenceResults);
        }

        function detectContradictions() {
            const contradictions = [];

            // Contradiction : aimer la solitude mais vouloir coacher des groupes
            if (ikigaiData.passions.some(p => p.toLowerCase().includes('solitude') || p.toLowerCase().includes('tranquillité'))) {
                if (ikigaiData.problems.some(p => p.toLowerCase().includes('groupe') || p.toLowerCase().includes('communauté'))) {
                    contradictions.push({
                        type: 'solitude_vs_groupe',
                        message: 'Vous aimez la solitude mais voulez aider des groupes - contradiction potentielle',
                        severity: 'medium'
                    });
                }
            }

            // Contradiction : passion pour l'aventure mais besoin de stabilité
            if (ikigaiData.passions.some(p => p.toLowerCase().includes('aventure') || p.toLowerCase().includes('voyage'))) {
                if (ikigaiData.problems.some(p => p.toLowerCase().includes('stabilité') || p.toLowerCase().includes('sécurité'))) {
                    contradictions.push({
                        type: 'aventure_vs_stabilite',
                        message: 'Passion pour l\'aventure vs besoin de stabilité - équilibre à trouver',
                        severity: 'low'
                    });
                }
            }

            // Contradiction : talents créatifs mais problèmes techniques
            if (ikigaiData.talents.some(t => t.toLowerCase().includes('créatif') || t.toLowerCase().includes('artistique'))) {
                if (ikigaiData.problems.some(p => p.toLowerCase().includes('technique') || p.toLowerCase().includes('scientifique'))) {
                    contradictions.push({
                        type: 'creatif_vs_technique',
                        message: 'Talents créatifs pour résoudre problèmes techniques - approche innovante possible',
                        severity: 'info'
                    });
                }
            }

            return contradictions;
        }

        function crossValidate() {
            const validations = [];

            // Vérifier que les talents correspondent aux passions
            ikigaiData.talents.forEach(talent => {
                const relatedPassions = ikigaiData.passions.filter(passion =>
                    passion.toLowerCase().includes(talent.toLowerCase().split(' ')[0]) ||
                    talent.toLowerCase().includes(passion.toLowerCase().split(' ')[0])
                );
                if (relatedPassions.length > 0) {
                    validations.push({
                        type: 'talent_passion_match',
                        message: `Votre talent "${talent}" s'aligne avec vos passions`,
                        strength: 'strong'
                    });
                }
            });

            // Vérifier que les compétences répondent aux problèmes
            ikigaiData.skills.forEach(skill => {
                const relatedProblems = ikigaiData.problems.filter(problem =>
                    problem.toLowerCase().includes(skill.toLowerCase().split(' ')[0])
                );
                if (relatedProblems.length > 0) {
                    validations.push({
                        type: 'skill_problem_match',
                        message: `Votre compétence "${skill}" peut résoudre des problèmes identifiés`,
                        strength: 'strong'
                    });
                }
            });

            return validations;
        }

        function calculateRealismScore() {
            let score = 50; // Score de base

            // Bonus pour alignement passion-talent
            const passionTalentAlignment = ikigaiData.passions.filter(passion =>
                ikigaiData.talents.some(talent =>
                    passion.toLowerCase().includes(talent.toLowerCase().split(' ')[0])
                )
            ).length;
            score += passionTalentAlignment * 10;

            // Bonus pour compétences monétisables
            const monetizableSkills = ikigaiData.skills.filter(skill =>
                skill.toLowerCase().includes('communication') ||
                skill.toLowerCase().includes('management') ||
                skill.toLowerCase().includes('technique') ||
                skill.toLowerCase().includes('créatif')
            ).length;
            score += monetizableSkills * 8;

            // Pénalité pour manque de réalisme
            if (ikigaiData.passions.length > 0 && ikigaiData.talents.length === 0) {
                score -= 20;
            }
            if (ikigaiData.problems.length > 0 && ikigaiData.skills.length === 0) {
                score -= 15;
            }

            return Math.max(0, Math.min(100, score));
        }

        function detectIllusions() {
            const alerts = [];

            // Alerte : beaucoup de passions mais peu de talents concrets
            if (ikigaiData.passions.length >= 5 && ikigaiData.talents.length < 2) {
                alerts.push({
                    type: 'passion_without_talent',
                    message: 'Vous avez beaucoup de passions mais peu de talents identifiés - explorez vos forces naturelles',
                    priority: 'high'
                });
            }

            // Alerte : compétences avancées mais peu d'expérience
            if (ikigaiData.skills.some(skill => skill.toLowerCase().includes('expert') || skill.toLowerCase().includes('spécialiste'))) {
                if (ikigaiData.talents.length < 3) {
                    alerts.push({
                        type: 'skill_without_evidence',
                        message: 'Vous déclarez des compétences expertes mais peu de talents sous-jacents - vérifiez votre niveau réel',
                        priority: 'medium'
                    });
                }
            }

            // Alerte : problèmes trop vastes
            if (ikigaiData.problems.some(problem =>
                problem.toLowerCase().includes('monde') ||
                problem.toLowerCase().includes('tous') ||
                problem.toLowerCase().includes('humanité')
            )) {
                alerts.push({
                    type: 'too_broad_problems',
                    message: 'Vos problèmes sont très vastes - concentrez-vous sur des impacts plus ciblés',
                    priority: 'low'
                });
            }

            return alerts;
        }

        function displayCoherenceResults(results) {
            const coherenceDiv = document.getElementById('coherenceAnalysis') || createCoherenceDiv();

            let html = '<h4>🔍 Analyse de cohérence</h4>';

            // Score de réalisme
            const scoreColor = results.realismScore >= 70 ? '#28a745' : results.realismScore >= 40 ? '#ffc107' : '#dc3545';
            html += `
                <div class="coherence-score">
                    <div class="score-label">Score de réalisme : <span style="color: ${scoreColor}">${results.realismScore}%</span></div>
                    <div class="score-bar">
                        <div class="score-fill" style="width: ${results.realismScore}%; background: ${scoreColor}"></div>
                    </div>
                </div>
            `;

            // Contradictions
            if (results.contradictions.length > 0) {
                html += '<div class="coherence-section"><h5>⚠️ Contradictions détectées :</h5><ul>';
                results.contradictions.forEach(contradiction => {
                    const icon = contradiction.severity === 'high' ? '🔴' : contradiction.severity === 'medium' ? '🟡' : '🔵';
                    html += `<li class="contradiction-item">${icon} ${contradiction.message}</li>`;
                });
                html += '</ul></div>';
            }

            // Validations positives
            if (results.validations.length > 0) {
                html += '<div class="coherence-section"><h5>✅ Alignements positifs :</h5><ul>';
                results.validations.forEach(validation => {
                    html += `<li class="validation-item">✅ ${validation.message}</li>`;
                });
                html += '</ul></div>';
            }

            // Alertes
            if (results.alerts.length > 0) {
                html += '<div class="coherence-section"><h5>💡 Alertes d\'auto-illusion :</h5><ul>';
                results.alerts.forEach(alert => {
                    const icon = alert.priority === 'high' ? '🚨' : alert.priority === 'medium' ? '⚠️' : '💡';
                    html += `<li class="alert-item">${icon} ${alert.message}</li>`;
                });
                html += '</ul></div>';
            }

            coherenceDiv.innerHTML = html;
        }

        function createCoherenceDiv() {
            const div = document.createElement('div');
            div.id = 'coherenceAnalysis';
            div.className = 'coherence-analysis';

            // L'insérer dans la section de visualisation
            const visualizationSection = document.querySelector('.visualization-section');
            visualizationSection.appendChild(div);

            return div;
        }

        // Suggestions contextuelles profondes
        function generateContextualSuggestions() {
            const suggestions = {
                hiddenPassions: detectHiddenPassions(),
                unrecognizedTalents: detectUnrecognizedTalents(),
                underlyingNeeds: detectUnderlyingNeeds(),
                missedOpportunities: detectMissedOpportunities()
            };

            displayContextualSuggestions(suggestions);
        }

        function detectHiddenPassions() {
            const hiddenPassions = [];

            // Analyser les descriptions pour détecter des passions cachées
            const allText = [
                document.getElementById('passionDescription')?.value || '',
                document.getElementById('talentFeedback')?.value || '',
                document.getElementById('worldContribution')?.value || '',
                document.getElementById('economicOpportunities')?.value || ''
            ].join(' ').toLowerCase();

            // Patterns indiquant des passions cachées
            const passionPatterns = [
                {
                    keywords: ['aider', 'accompagner', 'soutenir', 'guider'],
                    passion: 'Accompagnement et mentorat',
                    reason: 'Vous mentionnez souvent des termes liés à l\'aide aux autres'
                },
                {
                    keywords: ['enseigner', 'transmettre', 'partager', 'éduquer'],
                    passion: 'Transmission du savoir',
                    reason: 'Vos réponses montrent un intérêt pour l\'éducation'
                },
                {
                    keywords: ['créer', 'inventer', 'imaginer', 'construire'],
                    passion: 'Créativité et innovation',
                    reason: 'Vous exprimez un besoin de création'
                },
                {
                    keywords: ['explorer', 'découvrir', 'chercher', 'comprendre'],
                    passion: 'Exploration et découverte',
                    reason: 'Vous montrez de la curiosité intellectuelle'
                },
                {
                    keywords: ['organiser', 'structurer', 'planifier', 'coordonner'],
                    passion: 'Organisation et structure',
                    reason: 'Vous valorisez l\'ordre et la méthode'
                }
            ];

            passionPatterns.forEach(pattern => {
                const matches = pattern.keywords.filter(keyword => allText.includes(keyword));
                if (matches.length >= 2) {
                    hiddenPassions.push({
                        passion: pattern.passion,
                        reason: pattern.reason,
                        confidence: Math.min(100, matches.length * 25)
                    });
                }
            });

            return hiddenPassions;
        }

        function detectUnrecognizedTalents() {
            const unrecognizedTalents = [];

            // Analyser les réponses pour détecter des talents non-reconnus
            const allText = [
                ...ikigaiData.passions,
                ...ikigaiData.talents,
                ...ikigaiData.problems,
                ...ikigaiData.skills,
                document.getElementById('passionDescription')?.value || '',
                document.getElementById('talentFeedback')?.value || '',
                document.getElementById('worldContribution')?.value || '',
                document.getElementById('economicOpportunities')?.value || ''
            ].join(' ').toLowerCase();

            const talentPatterns = [
                {
                    keywords: ['empathie', 'écoute', 'compréhension', 'soutien'],
                    talent: 'Intelligence émotionnelle',
                    reason: 'Vos réponses montrent une forte capacité d\'empathie'
                },
                {
                    keywords: ['analyser', 'comprendre', 'résoudre', 'logique'],
                    talent: 'Pensée analytique',
                    reason: 'Vous démontrez des capacités d\'analyse'
                },
                {
                    keywords: ['communiquer', 'expliquer', 'convaincre', 'présenter'],
                    talent: 'Communication efficace',
                    reason: 'Vous exprimez clairement vos idées'
                },
                {
                    keywords: ['adapter', 'flexible', 'changer', 'évoluer'],
                    talent: 'Adaptabilité',
                    reason: 'Vous montrez de la flexibilité dans vos réponses'
                },
                {
                    keywords: ['motiver', 'inspirer', 'encourager', 'stimuler'],
                    talent: 'Leadership inspirant',
                    reason: 'Vous motivez et inspirez les autres'
                }
            ];

            talentPatterns.forEach(pattern => {
                const matches = pattern.keywords.filter(keyword => allText.includes(keyword));
                if (matches.length >= 2 && !ikigaiData.talents.some(t => t.toLowerCase().includes(pattern.talent.toLowerCase().split(' ')[0]))) {
                    unrecognizedTalents.push({
                        talent: pattern.talent,
                        reason: pattern.reason,
                        confidence: Math.min(100, matches.length * 30)
                    });
                }
            });

            return unrecognizedTalents;
        }

        function detectUnderlyingNeeds() {
            const underlyingNeeds = [];

            // Analyser les problèmes mentionnés pour détecter des besoins sous-jacents
            const problemsText = [
                ...ikigaiData.problems,
                document.getElementById('worldContribution')?.value || ''
            ].join(' ').toLowerCase();

            const needPatterns = [
                {
                    keywords: ['stress', 'anxiété', 'pression', 'tension'],
                    need: 'Besoin de sérénité et d\'équilibre',
                    reason: 'Derrière le stress se cache souvent un besoin de paix intérieure'
                },
                {
                    keywords: ['seul', 'isolement', 'solitude', 'rejet'],
                    need: 'Besoin de connexion authentique',
                    reason: 'L\'isolement révèle un besoin profond de relations sincères'
                },
                {
                    keywords: ['manque', 'insuffisant', 'pas assez', 'déficit'],
                    need: 'Besoin de reconnaissance et de valeur',
                    reason: 'Les sentiments d\'insuffisance masquent un besoin de validation'
                },
                {
                    keywords: ['perdu', 'direction', 'sens', 'orientation'],
                    need: 'Besoin de sens et de direction',
                    reason: 'La perte de direction indique un besoin de purpose'
                },
                {
                    keywords: ['fatigue', 'épuisement', 'burnout', 'lassitude'],
                    need: 'Besoin de renouvellement énergétique',
                    reason: 'L\'épuisement signale un besoin de recharge et de repos'
                }
            ];

            needPatterns.forEach(pattern => {
                const matches = pattern.keywords.filter(keyword => problemsText.includes(keyword));
                if (matches.length >= 1) {
                    underlyingNeeds.push({
                        need: pattern.need,
                        reason: pattern.reason,
                        confidence: Math.min(100, matches.length * 40)
                    });
                }
            });

            return underlyingNeeds;
        }

        function detectMissedOpportunities() {
            const missedOpportunities = [];

            // Détecter des opportunités manquées basées sur les combinaisons
            const allData = {
                passions: ikigaiData.passions,
                talents: ikigaiData.talents,
                problems: ikigaiData.problems,
                skills: ikigaiData.skills
            };

            // Opportunité : talents créatifs + problèmes sociaux
            if (allData.talents.some(t => t.toLowerCase().includes('créatif') || t.toLowerCase().includes('artistique'))) {
                if (allData.problems.some(p => p.toLowerCase().includes('social') || p.toLowerCase().includes('communauté'))) {
                    missedOpportunities.push({
                        opportunity: 'Art-thérapie ou médiation culturelle',
                        reason: 'Vos talents créatifs + problèmes sociaux = opportunité en art-thérapie',
                        combination: 'talents_problems'
                    });
                }
            }

            // Opportunité : compétences techniques + passions humaines
            if (allData.skills.some(s => s.toLowerCase().includes('technique') || s.toLowerCase().includes('tech'))) {
                if (allData.passions.some(p => p.toLowerCase().includes('aider') || p.toLowerCase().includes('humain'))) {
                    missedOpportunities.push({
                        opportunity: 'Tech for Good ou solutions humanitaires',
                        reason: 'Vos compétences tech + passions humaines = impact social via la technologie',
                        combination: 'skills_passions'
                    });
                }
            }

            // Opportunité : talents relationnels + problèmes éducatifs
            if (allData.talents.some(t => t.toLowerCase().includes('communication') || t.toLowerCase().includes('relation'))) {
                if (allData.problems.some(p => p.toLowerCase().includes('éducation') || p.toLowerCase().includes('apprentissage'))) {
                    missedOpportunities.push({
                        opportunity: 'Coaching éducatif ou formation personnalisée',
                        reason: 'Vos talents relationnels + problèmes éducatifs = coaching sur mesure',
                        combination: 'talents_problems'
                    });
                }
            }

            // Opportunité : passions analytiques + besoins économiques
            if (allData.passions.some(p => p.toLowerCase().includes('analyser') || p.toLowerCase().includes('comprendre'))) {
                if (allData.problems.some(p => p.toLowerCase().includes('économie') || p.toLowerCase().includes('financier'))) {
                    missedOpportunities.push({
                        opportunity: 'Conseil stratégique ou analyse de données',
                        reason: 'Vos passions analytiques + besoins économiques = expertise stratégique',
                        combination: 'passions_problems'
                    });
                }
            }

            return missedOpportunities;
        }

        function displayContextualSuggestions(suggestions) {
            const suggestionsDiv = document.getElementById('contextualSuggestions') || createSuggestionsDiv();

            let html = '<h4>💡 Suggestions contextuelles profondes</h4>';

            // Passions cachées
            if (suggestions.hiddenPassions.length > 0) {
                html += '<div class="suggestion-category"><h5>🌟 Passions cachées détectées :</h5>';
                suggestions.hiddenPassions.forEach(passion => {
                    html += `
                        <div class="suggestion-item">
                            <strong>${passion.passion}</strong> (${passion.confidence}% de confiance)
                            <br><small>${passion.reason}</small>
                            <button class="btn-tiny" onclick="addToSection('passions', '${passion.passion}')">➕ Ajouter</button>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Talents non-reconnus
            if (suggestions.unrecognizedTalents.length > 0) {
                html += '<div class="suggestion-category"><h5>🎯 Talents non-reconnus identifiés :</h5>';
                suggestions.unrecognizedTalents.forEach(talent => {
                    html += `
                        <div class="suggestion-item">
                            <strong>${talent.talent}</strong> (${talent.confidence}% de confiance)
                            <br><small>${talent.reason}</small>
                            <button class="btn-tiny" onclick="addToSection('talents', '${talent.talent}')">➕ Ajouter</button>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Besoins sous-jacents
            if (suggestions.underlyingNeeds.length > 0) {
                html += '<div class="suggestion-category"><h5>🧠 Besoins sous-jacents révélés :</h5>';
                suggestions.underlyingNeeds.forEach(need => {
                    html += `
                        <div class="suggestion-item">
                            <strong>${need.need}</strong> (${need.confidence}% de confiance)
                            <br><small>${need.reason}</small>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Opportunités manquées
            if (suggestions.missedOpportunities.length > 0) {
                html += '<div class="suggestion-category"><h5>🚀 Opportunités manquées potentielles :</h5>';
                suggestions.missedOpportunities.forEach(opportunity => {
                    html += `
                        <div class="suggestion-item">
                            <strong>${opportunity.opportunity}</strong>
                            <br><small>${opportunity.reason}</small>
                            <button class="btn-tiny" onclick="exploreOpportunity('${opportunity.opportunity}')">🔍 Explorer</button>
                        </div>
                    `;
                });
                html += '</div>';
            }

            if (suggestions.hiddenPassions.length === 0 && suggestions.unrecognizedTalents.length === 0 &&
                suggestions.underlyingNeeds.length === 0 && suggestions.missedOpportunities.length === 0) {
                html += '<p class="no-suggestions">Ajoutez plus d\'informations pour recevoir des suggestions personnalisées.</p>';
            }

            suggestionsDiv.innerHTML = html;
        }

        function createSuggestionsDiv() {
            const div = document.createElement('div');
            div.id = 'contextualSuggestions';
            div.className = 'contextual-suggestions';

            // L'insérer dans la section de visualisation
            const visualizationSection = document.querySelector('.visualization-section');
            visualizationSection.appendChild(div);

            return div;
        }

        function addToSection(section, item) {
            if (!ikigaiData[section].includes(item)) {
                ikigaiData[section].push(item);
                updateTagDisplay(`${section}Tags`, ikigaiData[section], section + 's');
                updateProgress();
                updateDots();
                analyzeCoherence();
                generateContextualSuggestions();
            }
        }

        function exploreOpportunity(opportunity) {
            alert(`🔍 Exploration de l'opportunité : ${opportunity}\n\nPour explorer cette piste :\n1. Recherchez des formations dans ce domaine\n2. Contactez des professionnels du secteur\n3. Testez un projet pilote à petite échelle\n4. Évaluez le potentiel de revenus\n\nCette opportunité combine vos forces uniques !`);
        }

        // Système de profilage psychologique
        function startPsychologicalAssessment() {
            const modal = document.createElement('div');
            modal.id = 'psychologyModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3>🧠 Évaluation Psychologique</h3>
                        <button class="modal-close" onclick="closePsychologyModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="assessment-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="assessmentProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="assessmentStep">Étape 1/5</div>
                        </div>
                        <div id="assessmentContent">
                            ${generateAssessmentStep(0)}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function generateAssessmentStep(step) {
            const steps = [
                { title: 'Ouverture d\'esprit', trait: 'openness', questions: psychologicalQuestions.bigFive.openness },
                { title: 'Conscience professionnelle', trait: 'conscientiousness', questions: psychologicalQuestions.bigFive.conscientiousness },
                { title: 'Extraversion', trait: 'extraversion', questions: psychologicalQuestions.bigFive.extraversion },
                { title: 'Agréabilité', trait: 'agreeableness', questions: psychologicalQuestions.bigFive.agreeableness },
                { title: 'Névrosisme', trait: 'neuroticism', questions: psychologicalQuestions.bigFive.neuroticism }
            ];

            if (step >= steps.length) {
                return generateMotivationAssessment();
            }

            const currentStep = steps[step];
            return `
                <div class="assessment-step">
                    <h4>${currentStep.title}</h4>
                    <p>Évaluez dans quelle mesure ces affirmations vous correspondent :</p>
                    ${currentStep.questions.map((question, index) => `
                        <div class="assessment-question">
                            <div class="question-text">${question}</div>
                            <div class="likert-scale">
                                ${[1,2,3,4,5].map(value => `
                                    <label class="likert-option">
                                        <input type="radio" name="q${step}_${index}" value="${value}"
                                               onchange="recordAssessmentAnswer('${currentStep.trait}', ${index}, ${value})">
                                        <span>${value}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                    <div class="step-navigation">
                        <button class="btn" onclick="nextAssessmentStep(${step + 1})">Suivant →</button>
                    </div>
                </div>
            `;
        }

        function generateMotivationAssessment() {
            return `
                <div class="assessment-step">
                    <h4>🎯 Vos motivations</h4>
                    <p>Évaluez vos sources de motivation :</p>
                    ${psychologicalQuestions.motivations.intrinsic.map((question, index) => `
                        <div class="assessment-question">
                            <div class="question-text">${question}</div>
                            <div class="likert-scale">
                                ${[1,2,3,4,5].map(value => `
                                    <label class="likert-option">
                                        <input type="radio" name="motiv_${index}" value="${value}"
                                               onchange="recordMotivationAnswer('intrinsic', ${index}, ${value})">
                                        <span>${value}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                    <div class="step-navigation">
                        <button class="btn" onclick="completePsychologicalProfile()">Finaliser l'évaluation</button>
                    </div>
                </div>
            `;
        }

        function recordAssessmentAnswer(trait, questionIndex, value) {
            // Enregistrer la réponse pour le trait Big Five
            if (!psychologicalProfile.bigFive.responses) {
                psychologicalProfile.bigFive.responses = {};
            }
            if (!psychologicalProfile.bigFive.responses[trait]) {
                psychologicalProfile.bigFive.responses[trait] = [];
            }
            psychologicalProfile.bigFive.responses[trait][questionIndex] = value;

            // Calculer le score moyen pour ce trait
            const responses = psychologicalProfile.bigFive.responses[trait].filter(r => r !== undefined);
            if (responses.length > 0) {
                psychologicalProfile.bigFive[trait] = responses.reduce((a, b) => a + b, 0) / responses.length;
            }
        }

        function recordMotivationAnswer(type, questionIndex, value) {
            if (!psychologicalProfile.motivations.responses) {
                psychologicalProfile.motivations.responses = {};
            }
            if (!psychologicalProfile.motivations.responses[type]) {
                psychologicalProfile.motivations.responses[type] = [];
            }
            psychologicalProfile.motivations.responses[type][questionIndex] = value;

            // Calculer le score moyen
            const responses = psychologicalProfile.motivations.responses[type].filter(r => r !== undefined);
            if (responses.length > 0) {
                psychologicalProfile.motivations[type] = responses.reduce((a, b) => a + b, 0) / responses.length;
            }
        }

        function nextAssessmentStep(step) {
            const progress = (step / 6) * 100;
            document.getElementById('assessmentProgress').style.width = progress + '%';
            document.getElementById('assessmentStep').textContent = `Étape ${step + 1}/6`;

            const content = document.getElementById('assessmentContent');
            if (step < 5) {
                content.innerHTML = generateAssessmentStep(step);
            } else {
                content.innerHTML = generateMotivationAssessment();
            }
        }

        function completePsychologicalProfile() {
            psychologicalProfile.profileComplete = true;
            analyzePsychologicalProfile();
            displayPsychologicalResults();
            closePsychologyModal();
        }

        function analyzePsychologicalProfile() {
            // Analyser les traits dominants
            const traits = psychologicalProfile.bigFive;
            const dominantTraits = [];

            if (traits.openness > 3.5) dominantTraits.push('Ouverture d\'esprit');
            if (traits.conscientiousness > 3.5) dominantTraits.push('Conscience professionnelle');
            if (traits.extraversion > 3.5) dominantTraits.push('Extraversion');
            if (traits.agreeableness > 3.5) dominantTraits.push('Agréabilité');
            if (traits.neuroticism > 3.5) dominantTraits.push('Émotivité');

            psychologicalProfile.dominantTraits = dominantTraits;

            // Déterminer le style d'apprentissage dominant
            const learning = psychologicalProfile.learningStyles;
            const maxLearning = Math.max(learning.visual, learning.auditory, learning.kinesthetic);
            if (maxLearning === learning.visual) psychologicalProfile.dominantLearningStyle = 'Visuel';
            else if (maxLearning === learning.auditory) psychologicalProfile.dominantLearningStyle = 'Auditif';
            else psychologicalProfile.dominantLearningStyle = 'Kinesthésique';

            // Analyser les motivations
            const motivations = psychologicalProfile.motivations;
            if (motivations.intrinsic > motivations.extrinsic) {
                psychologicalProfile.motivationType = 'Intrinsèque';
            } else {
                psychologicalProfile.motivationType = 'Extrinsèque';
            }

            if (motivations.autonomy > motivations.security) {
                psychologicalProfile.orientationType = 'Autonomie';
            } else {
                psychologicalProfile.orientationType = 'Sécurité';
            }
        }

        function displayPsychologicalResults() {
            const resultsDiv = document.getElementById('psychologicalResults') || createPsychologyResultsDiv();

            let html = '<h4>🧠 Votre Profil Psychologique</h4>';

            // Traits de personnalité dominants
            html += '<div class="profile-section"><h5>Traits Dominants (Big Five) :</h5>';
            psychologicalProfile.dominantTraits.forEach(trait => {
                html += `<span class="trait-badge">${trait}</span>`;
            });
            html += '</div>';

            // Style d'apprentissage
            html += `<div class="profile-section"><h5>Style d'Apprentissage Dominant :</h5><strong>${psychologicalProfile.dominantLearningStyle}</strong></div>`;

            // Type de motivation
            html += `<div class="profile-section"><h5>Type de Motivation :</h5><strong>${psychologicalProfile.motivationType}</strong></div>`;

            // Orientation
            html += `<div class="profile-section"><h5>Orientation :</h5><strong>${psychologicalProfile.orientationType}</strong></div>`;

            resultsDiv.innerHTML = html;
        }

        function createPsychologyResultsDiv() {
            const div = document.createElement('div');
            div.id = 'psychologicalResults';
            div.className = 'psychological-results';

            const visualizationSection = document.querySelector('.visualization-section');
            visualizationSection.appendChild(div);

            return div;
        }

        function closePsychologyModal() {
            const modal = document.getElementById('psychologyModal');
            if (modal) {
                modal.remove();
            }
        }

        // Système de parcours adaptatif
        function initializeAdaptivePathway() {
            if (!psychologicalProfile.profileComplete && !psychologicalProfile.quickProfile) {
                // Si pas de profil, commencer par une évaluation rapide
                startQuickAssessment();
                return;
            }

            // Utiliser soit le profil complet soit le profil rapide
            if (psychologicalProfile.quickProfile) {
                adaptivePathway.startingPoint = psychologicalProfile.quickProfile.startingPoint;
            } else {
                determineStartingPoint();
            }
            
            createAdaptivePathway();
            displayAdaptivePathway();
        }

        function startQuickAssessment() {
            const modal = document.createElement('div');
            modal.id = 'quickAssessmentModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>🚀 Évaluation Rapide</h3>
                        <button class="modal-close" onclick="closeQuickAssessment()">×</button>
                    </div>
                    <div class="modal-body">
                        <p>Pour personnaliser votre parcours, répondez à ces 3 questions :</p>
                        <div class="quick-questions">
                            <div class="quick-question">
                                <label>Quelle section vous semble la plus évidente à remplir ?</label>
                                <select id="startingPoint" onchange="updateQuickAssessment()">
                                    <option value="">Choisissez...</option>
                                    <option value="passions">Ce que j'aime</option>
                                    <option value="talents">Ce en quoi je suis doué</option>
                                    <option value="problems">Les problèmes du monde</option>
                                    <option value="skills">Ce que je peux monétiser</option>
                                </select>
                            </div>
                            <div class="quick-question">
                                <label>Préférez-vous commencer par des questions concrètes ou créatives ?</label>
                                <select id="questionStyle" onchange="updateQuickAssessment()">
                                    <option value="">Choisissez...</option>
                                    <option value="concrete">Questions concrètes</option>
                                    <option value="creative">Questions créatives</option>
                                </select>
                            </div>
                            <div class="quick-question">
                                <label>Vous considérez-vous comme plutôt...</label>
                                <select id="personalityType" onchange="updateQuickAssessment()">
                                    <option value="">Choisissez...</option>
                                    <option value="analytical">Analytique et logique</option>
                                    <option value="creative">Créatif et intuitif</option>
                                    <option value="practical">Pratique et concret</option>
                                    <option value="social">Social et relationnel</option>
                                </select>
                            </div>
                        </div>
                        <div class="step-navigation">
                            <button class="btn" id="startAdaptiveBtn" disabled onclick="startAdaptiveJourney()">Commencer le parcours adaptatif</button>
                            <button class="btn btn-outline" onclick="startDefaultPathway()" style="margin-top: 10px;">Ou commencer avec un parcours par défaut</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function updateQuickAssessment() {
            const startingPoint = document.getElementById('startingPoint').value;
            const questionStyle = document.getElementById('questionStyle').value;
            const personalityType = document.getElementById('personalityType').value;

            const btn = document.getElementById('startAdaptiveBtn');
            if (startingPoint && questionStyle && personalityType) {
                btn.disabled = false;
                btn.textContent = `Commencer par ${getSectionTitle(startingPoint)}`;
            }
        }

        function startAdaptiveJourney() {
            const startingPoint = document.getElementById('startingPoint').value;
            const questionStyle = document.getElementById('questionStyle').value;
            const personalityType = document.getElementById('personalityType').value;

            // Créer un profil rapide
            psychologicalProfile.quickProfile = {
                startingPoint: startingPoint,
                questionStyle: questionStyle,
                personalityType: personalityType
            };

            adaptivePathway.startingPoint = startingPoint;
            createAdaptivePathway();
            displayAdaptivePathway();

            closeQuickAssessment();
        }

        function determineStartingPoint() {
            // Déterminer le point de départ basé sur le profil psychologique
            const traits = psychologicalProfile.bigFive;
            const motivations = psychologicalProfile.motivations;

            // Logique de détermination du point de départ
            if (traits.extraversion > 3.5 && motivations.intrinsic > 3.5) {
                adaptivePathway.startingPoint = 'passions'; // Les extravertis intrinsèquement motivés commencent par les passions
            } else if (traits.conscientiousness > 3.5) {
                adaptivePathway.startingPoint = 'talents'; // Les consciencieux commencent par leurs talents
            } else if (traits.agreeableness > 3.5) {
                adaptivePathway.startingPoint = 'problems'; // Les agréables commencent par les problèmes du monde
            } else {
                adaptivePathway.startingPoint = 'skills'; // Les autres commencent par les compétences monétisables
            }
        }

        function createAdaptivePathway() {
            const startingPoint = adaptivePathway.startingPoint;
            const pathway = [];

            // Créer un parcours personnalisé basé sur le profil
            switch(startingPoint) {
                case 'passions':
                    pathway.push(
                        { step: 1, section: 'passions', type: 'guided', title: 'Explorez vos passions' },
                        { step: 2, section: 'talents', type: 'validation', title: 'Validez vos talents naturels' },
                        { step: 3, section: 'problems', type: 'connection', title: 'Connectez avec les besoins du monde' },
                        { step: 4, section: 'skills', type: 'monetization', title: 'Monétisez vos forces' }
                    );
                    break;
                case 'talents':
                    pathway.push(
                        { step: 1, section: 'talents', type: 'assessment', title: 'Évaluez vos compétences' },
                        { step: 2, section: 'passions', type: 'discovery', title: 'Découvrez vos passions cachées' },
                        { step: 3, section: 'problems', type: 'application', title: 'Appliquez vos talents' },
                        { step: 4, section: 'skills', type: 'optimization', title: 'Optimisez vos revenus' }
                    );
                    break;
                case 'problems':
                    pathway.push(
                        { step: 1, section: 'problems', type: 'identification', title: 'Identifiez les problèmes qui vous touchent' },
                        { step: 2, section: 'passions', type: 'alignment', title: 'Alignez vos passions' },
                        { step: 3, section: 'talents', type: 'contribution', title: 'Contribuez avec vos talents' },
                        { step: 4, section: 'skills', type: 'impact', title: 'Maximisez votre impact' }
                    );
                    break;
                case 'skills':
                    pathway.push(
                        { step: 1, section: 'skills', type: 'inventory', title: 'Faites l\'inventaire de vos compétences' },
                        { step: 2, section: 'problems', type: 'market', title: 'Identifiez les besoins du marché' },
                        { step: 3, section: 'passions', type: 'integration', title: 'Intégrez vos passions' },
                        { step: 4, section: 'talents', type: 'mastery', title: 'Maîtrisez vos talents' }
                    );
                    break;
            }

            adaptivePathway.pathway = pathway;
            adaptivePathway.currentStep = 0;
        }

        function displayAdaptivePathway() {
            const pathwayDiv = document.getElementById('adaptivePathway') || createPathwayDiv();

            let html = '<h4>🧭 Votre Parcours Adaptatif</h4>';

            html += '<div class="pathway-steps">';
            adaptivePathway.pathway.forEach((step, index) => {
                const isCompleted = isStepCompleted(index) || index < adaptivePathway.currentStep;
                const isCurrent = index === adaptivePathway.currentStep;
                const statusClass = isCompleted ? 'completed' : isCurrent ? 'current' : 'pending';

                html += `
                    <div class="pathway-step ${statusClass}" onclick="goToPathwayStep(${index})">
                        <div class="step-number">${step.step}</div>
                        <div class="step-content">
                            <div class="step-title">${step.title}</div>
                            <div class="step-section">${getSectionTitle(step.section)}</div>
                        </div>
                        <div class="step-status">
                            ${isCompleted ? '✅' : isCurrent ? '🎯' : '⏳'}
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            // Progression et conseils pour l'étape actuelle
            const stepProgress = getStepProgress();
            html += `
                <div class="pathway-progress">
                    <h5>📊 Progression de l'étape actuelle</h5>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${stepProgress.progress}%"></div>
                    </div>
                    <p class="progress-text">${stepProgress.progress.toFixed(0)}% complété</p>
                    <div class="step-suggestions">
                        ${stepProgress.suggestions.map(suggestion => `<p class="suggestion">💡 ${suggestion}</p>`).join('')}
                    </div>
                </div>
            `;

            // Boutons de navigation
            html += '<div class="pathway-navigation">';
            if (adaptivePathway.currentStep > 0) {
                html += '<button class="btn btn-warning" onclick="previousPathwayStep()">← Étape précédente</button>';
            }
            if (adaptivePathway.currentStep < adaptivePathway.pathway.length - 1) {
                const canAdvance = stepProgress.progress >= 50; // Au moins 50% pour avancer
                const nextBtnClass = canAdvance ? 'btn' : 'btn btn-secondary';
                const nextBtnText = canAdvance ? 'Étape suivante →' : 'Complétez d\'abord cette étape';
                html += `<button class="${nextBtnClass}" onclick="nextPathwayStep()" ${!canAdvance ? 'disabled' : ''}>${nextBtnText}</button>`;
            } else {
                html += '<button class="btn btn-success" onclick="completePathway()">🎉 Finaliser le parcours</button>';
            }
            html += '</div>';

            pathwayDiv.innerHTML = html;
            pathwayDiv.style.display = 'block';
            
            // Scroller vers le parcours pour le rendre visible
            pathwayDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function goToPathwayStep(stepIndex) {
            adaptivePathway.currentStep = stepIndex;
            const step = adaptivePathway.pathway[stepIndex];

            // Mettre en évidence la section correspondante
            highlightSection(step.section);

            // Ouvrir les questions guidées pour cette section
            showGuidedQuestions(step.section);

            // Vérifier si l'étape précédente peut être marquée comme complétée
            checkStepCompletion(stepIndex - 1);

            displayAdaptivePathway();
        }

        function nextPathwayStep() {
            if (adaptivePathway.currentStep < adaptivePathway.pathway.length - 1) {
                adaptivePathway.currentStep++;
                goToPathwayStep(adaptivePathway.currentStep);
            }
        }

        function previousPathwayStep() {
            if (adaptivePathway.currentStep > 0) {
                adaptivePathway.currentStep--;
                goToPathwayStep(adaptivePathway.currentStep);
            }
        }

        function createPathwayDiv() {
            const div = document.createElement('div');
            div.id = 'adaptivePathway';
            div.className = 'adaptive-pathway';

            const visualizationSection = document.querySelector('.visualization-section');
            visualizationSection.appendChild(div);

            return div;
        }

        function closeQuickAssessment() {
            const modal = document.getElementById('quickAssessmentModal');
            if (modal) {
                modal.remove();
            }
        }

        function startDefaultPathway() {
            // Créer un profil par défaut
            psychologicalProfile.quickProfile = {
                startingPoint: 'passions',
                questionStyle: 'creative',
                personalityType: 'creative'
            };

            adaptivePathway.startingPoint = 'passions';
            createAdaptivePathway();
            displayAdaptivePathway();

            closeQuickAssessment();
        }

        function checkStepCompletion(stepIndex) {
            if (stepIndex < 0 || stepIndex >= adaptivePathway.pathway.length) return;
            
            const step = adaptivePathway.pathway[stepIndex];
            const sectionData = ikigaiData[step.section];
            
            // Considérer une étape comme complétée si elle a au moins 2 éléments
            if (sectionData && sectionData.length >= 2) {
                if (!adaptivePathway.completedSteps) {
                    adaptivePathway.completedSteps = new Set();
                }
                adaptivePathway.completedSteps.add(stepIndex);
            }
        }

        function isStepCompleted(stepIndex) {
            return adaptivePathway.completedSteps && adaptivePathway.completedSteps.has(stepIndex);
        }

        function getStepProgress() {
            const currentStep = adaptivePathway.pathway[adaptivePathway.currentStep];
            if (!currentStep) return { progress: 0, suggestions: [] };
            
            const sectionData = ikigaiData[currentStep.section];
            const itemCount = sectionData ? sectionData.length : 0;
            
            const progress = Math.min((itemCount / 3) * 100, 100); // 3 éléments = 100%
            
            const suggestions = [];
            if (itemCount === 0) {
                suggestions.push(`Commencez par ajouter quelques éléments à "${getSectionTitle(currentStep.section)}"`);
            } else if (itemCount < 3) {
                suggestions.push(`Ajoutez encore ${3 - itemCount} élément(s) pour compléter cette étape`);
            } else {
                suggestions.push(`Étape complétée ! Vous pouvez passer à la suivante`);
            }
            
            return { progress, suggestions };
        }

        function completePathway() {
            const totalCompleted = adaptivePathway.completedSteps ? adaptivePathway.completedSteps.size : 0;
            const totalSteps = adaptivePathway.pathway.length;
            
            alert(`🎉 Félicitations ! Parcours adaptatif terminé !\n\n` +
                  `✅ Étapes complétées : ${totalCompleted}/${totalSteps}\n\n` +
                  `Vous pouvez maintenant :\n` +
                  `• Analyser votre Ikigai complet\n` +
                  `• Explorer les métiers recommandés\n` +
                  `• Discuter avec le Coach IA`);
        }

        // Base de données de métiers et système de matching
        const careerDatabase = [
            // Créatif & Artistique
            {
                id: 1,
                title: "Designer UX/UI",
                category: "Créatif",
                skills: ["Créativité", "Analyse", "Communication", "Technique"],
                passions: ["Design", "Innovation", "Résolution de problèmes", "Esthétique"],
                problems: ["Expérience utilisateur", "Interface", "Accessibilité"],
                salary: "35k-70k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Moyen",
                matchFactors: ["Créativité", "Technique", "Résolution de problèmes"]
            },
            {
                id: 2,
                title: "Photographe artistique",
                category: "Créatif",
                skills: ["Créativité", "Technique", "Patience", "Relationnel"],
                passions: ["Art", "Beauté", "Expression", "Voyage"],
                problems: ["Communication visuelle", "Conservation culturelle"],
                salary: "20k-50k€",
                growth: "Moyen",
                autonomy: "Élevé",
                social: "Faible",
                matchFactors: ["Créativité", "Expression artistique", "Autonomie"]
            },
            {
                id: 3,
                title: "Écrivain / Auteur",
                category: "Créatif",
                skills: ["Écriture", "Créativité", "Discipline", "Recherche"],
                passions: ["Raconter des histoires", "Transmettre", "Apprendre"],
                problems: ["Éducation", "Communication", "Culture"],
                salary: "15k-100k€",
                growth: "Variable",
                autonomy: "Élevé",
                social: "Faible",
                matchFactors: ["Écriture", "Créativité", "Autonomie"]
            },

            // Technique & Scientifique
            {
                id: 4,
                title: "Développeur Full-Stack",
                category: "Technique",
                skills: ["Programmation", "Logique", "Résolution de problèmes", "Apprentissage continu"],
                passions: ["Innovation", "Création", "Logique", "Apprendre"],
                problems: ["Numérisation", "Automatisation", "Efficacité"],
                salary: "30k-80k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Moyen",
                matchFactors: ["Technique", "Logique", "Innovation"]
            },
            {
                id: 5,
                title: "Data Scientist",
                category: "Technique",
                skills: ["Mathématiques", "Statistiques", "Programmation", "Analyse"],
                passions: ["Découverte", "Compréhension", "Innovation"],
                problems: ["Prise de décision", "Optimisation", "Prédiction"],
                salary: "40k-90k€",
                growth: "Élevé",
                autonomy: "Élevé",
                social: "Faible",
                matchFactors: ["Analyse", "Mathématiques", "Innovation"]
            },
            {
                id: 6,
                title: "Ingénieur IA/ML",
                category: "Technique",
                skills: ["Mathématiques", "Programmation", "Machine Learning", "Créativité"],
                passions: ["Innovation", "Résolution de problèmes", "Futur"],
                problems: ["Automatisation", "Intelligence artificielle", "Éthique"],
                salary: "45k-100k€",
                growth: "Très élevé",
                autonomy: "Élevé",
                social: "Moyen",
                matchFactors: ["Technique", "Innovation", "Créativité"]
            },

            // Social & Relationnel
            {
                id: 7,
                title: "Coach de vie",
                category: "Social",
                skills: ["Écoute", "Empathie", "Communication", "Guidance"],
                passions: ["Aider les autres", "Développement personnel", "Relationnel"],
                problems: ["Épanouissement", "Orientation", "Confiance"],
                salary: "25k-60k€",
                growth: "Élevé",
                autonomy: "Élevé",
                social: "Élevé",
                matchFactors: ["Empathie", "Communication", "Aide aux autres"]
            },
            {
                id: 8,
                title: "Enseignant / Formateur",
                category: "Social",
                skills: ["Pédagogie", "Communication", "Patience", "Adaptabilité"],
                passions: ["Transmettre", "Apprendre", "Aider", "Développer"],
                problems: ["Éducation", "Formation", "Développement"],
                salary: "25k-45k€",
                growth: "Stable",
                autonomy: "Moyen",
                social: "Élevé",
                matchFactors: ["Pédagogie", "Communication", "Transmettre"]
            },
            {
                id: 9,
                title: "Consultant RH",
                category: "Social",
                skills: ["Relationnel", "Analyse", "Communication", "Stratégie"],
                passions: ["Développement humain", "Organisation", "Amélioration"],
                problems: ["Gestion des talents", "Motivation", "Culture d'entreprise"],
                salary: "35k-70k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Élevé",
                matchFactors: ["Relationnel", "Analyse", "Stratégie"]
            },

            // Entreprenariat & Business
            {
                id: 10,
                title: "Entrepreneur Social",
                category: "Entrepreneuriat",
                skills: ["Leadership", "Vision", "Résilience", "Créativité"],
                passions: ["Impact social", "Innovation", "Leadership", "Changement"],
                problems: ["Inégalités", "Environnement", "Éducation"],
                salary: "Variable",
                growth: "Variable",
                autonomy: "Très élevé",
                social: "Élevé",
                matchFactors: ["Leadership", "Impact social", "Innovation"]
            },
            {
                id: 11,
                title: "Chef de projet digital",
                category: "Business",
                skills: ["Organisation", "Communication", "Gestion", "Technique"],
                passions: ["Coordination", "Résultats", "Innovation", "Équipe"],
                problems: ["Efficacité", "Transformation digitale", "Collaboration"],
                salary: "35k-65k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Élevé",
                matchFactors: ["Organisation", "Communication", "Innovation"]
            },

            // Santé & Bien-être
            {
                id: 12,
                title: "Thérapeute / Psychologue",
                category: "Santé",
                skills: ["Écoute", "Empathie", "Analyse", "Communication"],
                passions: ["Aider", "Comprendre l'humain", "Guérison", "Développement"],
                problems: ["Santé mentale", "Bien-être", "Épanouissement"],
                salary: "30k-60k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Élevé",
                matchFactors: ["Empathie", "Écoute", "Aide aux autres"]
            },
            {
                id: 13,
                title: "Coach sportif",
                category: "Santé",
                skills: ["Motivation", "Pédagogie", "Physiologie", "Relationnel"],
                passions: ["Santé", "Performance", "Aider", "Mouvement"],
                problems: ["Santé physique", "Motivation", "Bien-être"],
                salary: "20k-45k€",
                growth: "Moyen",
                autonomy: "Élevé",
                social: "Élevé",
                matchFactors: ["Motivation", "Pédagogie", "Santé"]
            },

            // Environnement & Développement durable
            {
                id: 14,
                title: "Consultant développement durable",
                category: "Environnement",
                skills: ["Analyse", "Stratégie", "Communication", "Innovation"],
                passions: ["Environnement", "Futur", "Impact positif", "Changement"],
                problems: ["Climat", "Ressources", "Développement durable"],
                salary: "30k-60k€",
                growth: "Élevé",
                autonomy: "Moyen",
                social: "Moyen",
                matchFactors: ["Analyse", "Innovation", "Impact positif"]
            },
            {
                id: 15,
                title: "Éducateur environnemental",
                category: "Environnement",
                skills: ["Pédagogie", "Communication", "Passion", "Créativité"],
                passions: ["Nature", "Éducation", "Sensibilisation", "Protection"],
                problems: ["Conscience écologique", "Éducation", "Protection"],
                salary: "25k-40k€",
                growth: "Moyen",
                autonomy: "Élevé",
                social: "Élevé",
                matchFactors: ["Pédagogie", "Communication", "Passion environnementale"]
            }
        ];

        // Système de matching de carrière
        function findCareerMatches() {
            if (ikigaiData.passions.length === 0 && ikigaiData.talents.length === 0 &&
                ikigaiData.problems.length === 0 && ikigaiData.skills.length === 0) {
                alert('Veuillez d\'abord remplir au moins une section pour obtenir des recommandations de carrière.');
                return;
            }

            const matches = careerDatabase.map(career => {
                let score = 0;
                let matchDetails = [];

                // Matching avec les passions
                ikigaiData.passions.forEach(passion => {
                    career.passions.forEach(careerPassion => {
                        if (passion.toLowerCase().includes(careerPassion.toLowerCase().split(' ')[0]) ||
                            careerPassion.toLowerCase().includes(passion.toLowerCase().split(' ')[0])) {
                            score += 15;
                            matchDetails.push(`Passion: ${passion}`);
                        }
                    });
                });

                // Matching avec les talents
                ikigaiData.talents.forEach(talent => {
                    career.skills.forEach(careerSkill => {
                        if (talent.toLowerCase().includes(careerSkill.toLowerCase().split(' ')[0]) ||
                            careerSkill.toLowerCase().includes(talent.toLowerCase().split(' ')[0])) {
                            score += 20;
                            matchDetails.push(`Talent: ${talent}`);
                        }
                    });
                });

                // Matching avec les problèmes
                ikigaiData.problems.forEach(problem => {
                    career.problems.forEach(careerProblem => {
                        if (problem.toLowerCase().includes(careerProblem.toLowerCase().split(' ')[0]) ||
                            careerProblem.toLowerCase().includes(problem.toLowerCase().split(' ')[0])) {
                            score += 15;
                            matchDetails.push(`Problème: ${problem}`);
                        }
                    });
                });

                // Matching avec les compétences
                ikigaiData.skills.forEach(skill => {
                    career.skills.forEach(careerSkill => {
                        if (skill.toLowerCase().includes(careerSkill.toLowerCase().split(' ')[0]) ||
                            careerSkill.toLowerCase().includes(skill.toLowerCase().split(' ')[0])) {
                            score += 25;
                            matchDetails.push(`Compétence: ${skill}`);
                        }
                    });
                });

                // Bonus pour l'adéquation psychologique
                if (psychologicalProfile.profileComplete) {
                    if (psychologicalProfile.motivationType === 'Intrinsèque' &&
                        career.category === 'Créatif') {
                        score += 10;
                    }
                    if (psychologicalProfile.orientationType === 'Autonomie' &&
                        career.autonomy === 'Élevé') {
                        score += 10;
                    }
                }

                return {
                    ...career,
                    matchScore: score,
                    matchDetails: matchDetails,
                    matchLevel: score >= 80 ? 'Excellent' : score >= 60 ? 'Très bon' : score >= 40 ? 'Bon' : 'Faible'
                };
            });

            // Trier par score décroissant et retourner les 10 meilleurs
            const topMatches = matches
                .filter(match => match.matchScore > 0)
                .sort((a, b) => b.matchScore - a.matchScore)
                .slice(0, 10);

            displayCareerMatches(topMatches);
        }

        function displayCareerMatches(matches) {
            const modal = document.createElement('div');
            modal.id = 'careerMatchesModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3>🎯 Métiers Recommandés</h3>
                        <button class="modal-close" onclick="closeCareerModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="career-matches">
                            ${matches.map(match => `
                                <div class="career-match ${match.matchLevel.toLowerCase()}">
                                    <div class="career-header">
                                        <h4>${match.title}</h4>
                                        <div class="match-score">
                                            <div class="score-bar">
                                                <div class="score-fill" style="width: ${Math.min(match.matchScore, 100)}%"></div>
                                            </div>
                                            <span class="score-text">${match.matchScore}% - ${match.matchLevel}</span>
                                        </div>
                                    </div>
                                    <div class="career-details">
                                        <div class="career-info">
                                            <span class="category">${match.category}</span>
                                            <span class="salary">💰 ${match.salary}</span>
                                            <span class="growth">📈 ${match.growth}</span>
                                        </div>
                                        <div class="career-description">
                                            <strong>Pourquoi ce métier ?</strong>
                                            <ul>
                                                ${match.matchDetails.map(detail => `<li>${detail}</li>`).join('')}
                                            </ul>
                                        </div>
                                        <div class="career-actions">
                                            <button class="btn-small" onclick="exploreCareer(${match.id})">🔍 Explorer</button>
                                            <button class="btn-small" onclick="generateAdvancedRecommendations(${match.id})">🚀 Plan d'action</button>
                                            <button class="btn-small" onclick="saveCareer(${match.id})">💾 Sauvegarder</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function exploreCareer(careerId) {
            const career = careerDatabase.find(c => c.id === careerId);
            if (!career) return;

            alert(`🔍 Exploration du métier : ${career.title}

📋 Description :
${career.title} - ${career.category}

💰 Salaire : ${career.salary}
📈 Croissance : ${career.growth}
🤝 Autonomie : ${career.autonomy}
👥 Contact social : ${career.social}

🎯 Compétences clés :
${career.skills.join(', ')}

❤️ Passions alignées :
${career.passions.join(', ')}

🌍 Problèmes adressés :
${career.problems.join(', ')}

💡 Pour explorer cette voie :
1. Recherchez des formations dans ce domaine
2. Contactez des professionnels du secteur
3. Testez un projet pilote
4. Évaluez vos compétences actuelles`);
        }

        function saveCareer(careerId) {
            const career = careerDatabase.find(c => c.id === careerId);
            if (!career) return;

            if (!ikigaiData.savedCareers) {
                ikigaiData.savedCareers = [];
            }

            if (!ikigaiData.savedCareers.find(c => c.id === careerId)) {
                ikigaiData.savedCareers.push(career);
                alert(`✅ ${career.title} sauvegardé dans vos favoris !`);
            } else {
                alert(`ℹ️ ${career.title} est déjà dans vos favoris.`);
            }
        }

        function closeCareerModal() {
            const modal = document.getElementById('careerMatchesModal');
            if (modal) {
                modal.remove();
            }
        }

        // Système de prédictions et recommandations avancées
        const trainingDatabase = [
            {
                id: 1,
                title: "Design Thinking",
                category: "Créatif",
                duration: "2-3 jours",
                cost: "500-2000€",
                skills: ["Créativité", "Innovation", "Résolution de problèmes"],
                outcomes: ["Méthodologie de design", "Pensée créative", "Prototypage rapide"]
            },
            {
                id: 2,
                title: "Développement Web Full-Stack",
                category: "Technique",
                duration: "3-6 mois",
                cost: "2000-8000€",
                skills: ["HTML/CSS", "JavaScript", "Backend", "Bases de données"],
                outcomes: ["Création d'applications web", "Développement autonome", "Portfolio professionnel"]
            },
            {
                id: 3,
                title: "Intelligence Artificielle & Machine Learning",
                category: "Technique",
                duration: "4-8 mois",
                cost: "3000-10000€",
                skills: ["Python", "Statistiques", "ML", "Data Science"],
                outcomes: ["Analyse prédictive", "Automatisation", "Innovation technologique"]
            },
            {
                id: 4,
                title: "Coaching et Développement Personnel",
                category: "Social",
                duration: "2-4 mois",
                cost: "1500-5000€",
                skills: ["Écoute active", "Communication", "Outils de coaching", "Psychologie"],
                outcomes: ["Accompagnement individuel", "Animation de groupes", "Développement personnel"]
            },
            {
                id: 5,
                title: "Marketing Digital",
                category: "Business",
                duration: "2-3 mois",
                cost: "1000-4000€",
                skills: ["SEO/SEA", "Réseaux sociaux", "Analytics", "Content Marketing"],
                outcomes: ["Stratégie digitale", "Acquisition clients", "Mesure de performance"]
            },
            {
                id: 6,
                title: "Photographie Professionnelle",
                category: "Créatif",
                duration: "1-3 mois",
                cost: "800-3000€",
                skills: ["Composition", "Éclairage", "Post-traitement", "Business"],
                outcomes: ["Portfolio professionnel", "Techniques avancées", "Monétisation"]
            }
        ];

        function generateAdvancedRecommendations(careerId) {
            const career = careerDatabase.find(c => c.id === careerId);
            if (!career) return;

            const recommendations = {
                trainings: findRelevantTrainings(career),
                pilotProjects: generatePilotProjects(career),
                risks: identifyRisks(career),
                timeline: createTimeline(career),
                nextSteps: generateNextSteps(career)
            };

            displayAdvancedRecommendations(career, recommendations);
        }

        function findRelevantTrainings(career) {
            return trainingDatabase.filter(training => {
                return training.skills.some(skill =>
                    career.skills.some(careerSkill =>
                        careerSkill.toLowerCase().includes(skill.toLowerCase().split(' ')[0])
                    )
                );
            }).slice(0, 3);
        }

        function generatePilotProjects(career) {
            const projects = {
                "Designer UX/UI": [
                    "Refaire l'interface d'un site web personnel",
                    "Créer un prototype d'app mobile pour un ami",
                    "Participer à un hackathon design"
                ],
                "Développeur Full-Stack": [
                    "Construire un portfolio personnel",
                    "Créer une app web pour une association",
                    "Développer un outil interne pour votre entreprise"
                ],
                "Data Scientist": [
                    "Analyser un dataset public (Kaggle)",
                    "Créer un modèle prédictif simple",
                    "Visualiser des données pour une ONG"
                ],
                "Coach de vie": [
                    "Coacher gratuitement 2-3 amis",
                    "Animer un atelier dans une association",
                    "Créer du contenu sur les réseaux sociaux"
                ],
                "Consultant RH": [
                    "Conduire un entretien d'embauche bénévole",
                    "Organiser une formation interne",
                    "Mener une enquête de satisfaction"
                ]
            };

            return projects[career.title] || [
                "Créer un projet personnel lié à ce métier",
                "Participer à des événements professionnels",
                "Rechercher des mentors dans ce domaine"
            ];
        }

        function identifyRisks(career) {
            const risks = [];

            // Risques basés sur le profil psychologique
            if (psychologicalProfile.profileComplete) {
                if (psychologicalProfile.motivationType === 'Extrinsèque' && career.autonomy === 'Élevé') {
                    risks.push({
                        type: 'motivation_mismatch',
                        risk: 'Risque d\'épuisement dans un métier très autonome',
                        mitigation: 'Développer votre motivation intrinsèque'
                    });
                }

                if (psychologicalProfile.orientationType === 'Sécurité' && career.growth === 'Variable') {
                    risks.push({
                        type: 'security_risk',
                        risk: 'Revenus instables dans un secteur à risque',
                        mitigation: 'Construire un filet de sécurité financière'
                    });
                }
            }

            // Risques basés sur les données Ikigai
            if (ikigaiData.passions.length < 2) {
                risks.push({
                    type: 'passion_gap',
                    risk: 'Manque de passions clairement identifiées',
                    mitigation: 'Explorer plus profondément vos centres d\'intérêt'
                });
            }

            if (ikigaiData.skills.length < 2) {
                risks.push({
                    type: 'skill_gap',
                    risk: 'Compétences à développer pour ce métier',
                    mitigation: 'Suivre une formation spécialisée'
                });
            }

            // Risques spécifiques au métier
            if (career.category === 'Entrepreneuriat') {
                risks.push({
                    type: 'entrepreneur_risk',
                    risk: 'Risque d\'échec entrepreneurial élevé',
                    mitigation: 'Commencer petit et valider le concept'
                });
            }

            return risks;
        }

        function createTimeline(career) {
            const timeline = [];

            // Timeline basée sur le niveau actuel
            if (ikigaiData.skills.length === 0) {
                timeline.push(
                    { phase: 'Préparation', duration: '1-3 mois', tasks: ['Formation de base', 'Apprentissage théorique'] },
                    { phase: 'Pratique', duration: '3-6 mois', tasks: ['Projets personnels', 'Stages bénévoles'] },
                    { phase: 'Transition', duration: '6-12 mois', tasks: ['Emploi à temps partiel', 'Réseautage'] }
                );
            } else if (ikigaiData.skills.length < 3) {
                timeline.push(
                    { phase: 'Spécialisation', duration: '2-4 mois', tasks: ['Formation avancée', 'Certification'] },
                    { phase: 'Expérience', duration: '4-8 mois', tasks: ['Projets rémunérés', 'Collaboration'] },
                    { phase: 'Établissement', duration: '8-12 mois', tasks: ['Poste stable', 'Développement professionnel'] }
                );
            } else {
                timeline.push(
                    { phase: 'Optimisation', duration: '1-2 mois', tasks: ['Évaluation des compétences', 'Positionnement'] },
                    { phase: 'Accélération', duration: '2-4 mois', tasks: ['Projets ambitieux', 'Leadership'] },
                    { phase: 'Maîtrise', duration: '4-6 mois', tasks: ['Mentorat', 'Innovation'] }
                );
            }

            return timeline;
        }

        function generateNextSteps(career) {
            const steps = [
                {
                    step: 'Semaine 1-2',
                    actions: [
                        'Rechercher des formations en ligne',
                        'Créer un profil LinkedIn professionnel',
                        'Contacter 3 professionnels du secteur'
                    ]
                },
                {
                    step: 'Mois 1',
                    actions: [
                        'Commencer une formation courte',
                        'Participer à un événement professionnel',
                        'Créer un projet pilote simple'
                    ]
                },
                {
                    step: 'Mois 2-3',
                    actions: [
                        'Développer un portfolio',
                        'Rechercher des opportunités d\'emploi/stage',
                        'Affiner votre pitch professionnel'
                    ]
                }
            ];

            return steps;
        }

        function displayAdvancedRecommendations(career, recommendations) {
            const modal = document.createElement('div');
            modal.id = 'advancedRecommendationsModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3>🚀 Plan d'Action pour ${career.title}</h3>
                        <button class="modal-close" onclick="closeAdvancedModal()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="recommendations-tabs">
                            <button class="tab-btn active" onclick="switchRecommendationTab('formations')">🎓 Formations</button>
                            <button class="tab-btn" onclick="switchRecommendationTab('projets')">💡 Projets</button>
                            <button class="tab-btn" onclick="switchRecommendationTab('risques')">⚠️ Risques</button>
                            <button class="tab-btn" onclick="switchRecommendationTab('timeline')">📅 Timeline</button>
                            <button class="tab-btn" onclick="switchRecommendationTab('actions')">🎯 Actions</button>
                        </div>
                        <div id="recommendationsContent">
                            ${generateFormationsContent(recommendations.trainings)}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';

            // Stocker les recommandations pour les onglets
            modal.recommendations = recommendations;
        }

        function switchRecommendationTab(tabType) {
            const modal = document.getElementById('advancedRecommendationsModal');
            const recommendations = modal.recommendations;
            const content = document.getElementById('recommendationsContent');

            // Mettre à jour les onglets actifs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Générer le contenu selon l'onglet
            switch(tabType) {
                case 'formations':
                    content.innerHTML = generateFormationsContent(recommendations.trainings);
                    break;
                case 'projets':
                    content.innerHTML = generateProjectsContent(recommendations.pilotProjects);
                    break;
                case 'risques':
                    content.innerHTML = generateRisksContent(recommendations.risks);
                    break;
                case 'timeline':
                    content.innerHTML = generateTimelineContent(recommendations.timeline);
                    break;
                case 'actions':
                    content.innerHTML = generateActionsContent(recommendations.nextSteps);
                    break;
            }
        }

        function generateFormationsContent(trainings) {
            if (trainings.length === 0) {
                return '<p>Aucune formation spécifique recommandée pour ce métier.</p>';
            }

            return `
                <h4>🎓 Formations Recommandées</h4>
                <div class="training-list">
                    ${trainings.map(training => `
                        <div class="training-item">
                            <h5>${training.title}</h5>
                            <div class="training-details">
                                <span>⏱️ ${training.duration}</span>
                                <span>💰 ${training.cost}</span>
                                <span>📚 ${training.category}</span>
                            </div>
                            <div class="training-outcomes">
                                <strong>Ce que vous apprendrez :</strong>
                                <ul>
                                    ${training.outcomes.map(outcome => `<li>${outcome}</li>`).join('')}
                                </ul>
                            </div>
                            <button class="btn-small" onclick="researchTraining('${training.title}')">🔍 Rechercher</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateProjectsContent(projects) {
            return `
                <h4>💡 Projets Pilotes à Tester</h4>
                <div class="projects-list">
                    ${projects.map((project, index) => `
                        <div class="project-item">
                            <div class="project-number">${index + 1}</div>
                            <div class="project-content">
                                <h5>${project}</h5>
                                <div class="project-actions">
                                    <button class="btn-tiny" onclick="scheduleProject('${project}')">📅 Planifier</button>
                                    <button class="btn-tiny" onclick="getProjectResources('${project}')">📚 Ressources</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="project-tips">
                    <h5>💡 Conseils pour vos projets pilotes :</h5>
                    <ul>
                        <li>Commencez petit (2-4 semaines maximum)</li>
                        <li>Fixez-vous des objectifs mesurables</li>
                        <li>Documentez votre processus et apprentissages</li>
                        <li>Partagez vos résultats sur LinkedIn</li>
                    </ul>
                </div>
            `;
        }

        function generateRisksContent(risks) {
            if (risks.length === 0) {
                return '<p>✅ Aucun risque majeur identifié pour ce parcours.</p>';
            }

            return `
                <h4>⚠️ Risques à Anticiper</h4>
                <div class="risks-list">
                    ${risks.map(risk => `
                        <div class="risk-item ${risk.type}">
                            <div class="risk-header">
                                <h5>🚨 ${risk.risk}</h5>
                            </div>
                            <div class="risk-mitigation">
                                <strong>💡 Stratégie d'atténuation :</strong>
                                <p>${risk.mitigation}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateTimelineContent(timeline) {
            return `
                <h4>📅 Feuille de Route</h4>
                <div class="timeline">
                    ${timeline.map((phase, index) => `
                        <div class="timeline-phase">
                            <div class="phase-header">
                                <div class="phase-number">${index + 1}</div>
                                <div class="phase-info">
                                    <h5>${phase.phase}</h5>
                                    <span class="phase-duration">⏱️ ${phase.duration}</span>
                                </div>
                            </div>
                            <div class="phase-tasks">
                                <ul>
                                    ${phase.tasks.map(task => `<li>${task}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateActionsContent(nextSteps) {
            return `
                <h4>🎯 Prochaines Actions Concrètes</h4>
                <div class="action-steps">
                    ${nextSteps.map(step => `
                        <div class="action-step">
                            <h5>${step.step}</h5>
                            <ul>
                                ${step.actions.map(action => `<li>${action}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>
                <div class="motivation-boost">
                    <h5>🔥 Pour rester motivé :</h5>
                    <ul>
                        <li>Célébrez chaque petite victoire</li>
                        <li>Tenez un journal de bord de vos progrès</li>
                        <li>Partagez vos objectifs avec un ami</li>
                        <li>Visualisez votre succès régulièrement</li>
                    </ul>
                </div>
            `;
        }

        function researchTraining(trainingTitle) {
            alert(`🔍 Recherche de formation : ${trainingTitle}

Plateformes recommandées :
• Udemy / Coursera / LinkedIn Learning
• Centres de formation spécialisés
• Écoles et universités
• Formations professionnelles certifiantes

Conseils :
• Vérifiez les avis et le contenu du programme
• Comparez les prix et les modalités
• Privilégiez les formations avec projets pratiques
• Visez les certifications reconnues`);
        }

        function scheduleProject(project) {
            const deadline = prompt(`Quand souhaitez-vous terminer ce projet : "${project}" ? (ex: dans 2 semaines)`);
            if (deadline) {
                alert(`📅 Projet planifié : "${project}"
⏰ Échéance : ${deadline}

Prochaines étapes :
1. Définir les objectifs spécifiques
2. Lister les ressources nécessaires
3. Créer un plan d'action détaillé
4. Commencer par la première tâche

Bon courage ! 🚀`);
            }
        }

        function getProjectResources(project) {
            alert(`📚 Ressources pour : "${project}"

Ressources générales :
• Livres spécialisés dans le domaine
• Tutoriels en ligne (YouTube, Udemy)
• Communautés professionnelles (Reddit, LinkedIn)
• Mentors et experts du secteur

Outils recommandés :
• Trello / Asana pour la gestion de projet
• Google Docs pour la documentation
• Canva pour les visuels
• LinkedIn pour le réseautage

N'oubliez pas de documenter votre apprentissage ! 📝`);
        }

        function closeAdvancedModal() {
            const modal = document.getElementById('advancedRecommendationsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Coach IA Conversationnel
        function startAICoach() {
            // Préparer les données utilisateur
            const userData = {
                passions: ikigaiData.passions,
                talents: ikigaiData.talents,
                problems: ikigaiData.problems,
                skills: ikigaiData.skills,
                descriptions: {
                    passion: document.getElementById('passionDescription')?.value || '',
                    talent: document.getElementById('talentFeedback')?.value || '',
                    world: document.getElementById('worldContribution')?.value || '',
                    economic: document.getElementById('economicOpportunities')?.value || ''
                }
            };

            // Créer l'interface de chat
            const chatModal = document.createElement('div');
            chatModal.id = 'aiCoachModal';
            chatModal.className = 'modal-overlay';
            chatModal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3>🤖 Coach IA - Votre Guide Ikigai</h3>
                        <button class="modal-close" onclick="closeAICoach()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="ai-coach-container">
                            <div class="coach-info">
                                <div class="coach-avatar">🤖</div>
                                <div class="coach-details">
                                    <h4>Coach IA Ikigai</h4>
                                    <p>Expert en méthode socratique • Mémoire contextuelle • Adaptation émotionnelle</p>
                                    <div class="coach-status">
                                        <span class="status-dot online"></span>
                                        <span>En ligne - Prêt à vous guider</span>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-messages" id="chatMessages">
                                <div class="message system-message">
                                    <div class="message-avatar">🤖</div>
                                    <div class="message-content">
                                        <div class="message-text">Bonjour ! Je suis votre coach IA spécialisé en Ikigai. Je vais vous guider à travers un dialogue socratique pour découvrir votre raison d'être profonde.</div>
                                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-input-container">
                                <div class="chat-input-wrapper">
                                    <textarea id="chatInput" placeholder="Partagez vos pensées, vos doutes, vos découvertes..." rows="2"></textarea>
                                    <button class="btn-send" onclick="sendMessageToCoach()">📤 Envoyer</button>
                                </div>
                                <div class="chat-actions">
                                    <button class="btn-small" onclick="showCoachHelp()">❓ Aide</button>
                                    <button class="btn-small" onclick="getConversationSummary()">📊 Résumé</button>
                                    <button class="btn-small" onclick="clearConversation()">🗑️ Effacer</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(chatModal);
            chatModal.style.display = 'flex';

            // Démarrer la conversation
            setTimeout(() => {
                startConversationWithCoach(userData);
            }, 1000);

            // Permettre l'envoi avec Entrée
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessageToCoach();
                }
            });
        }

        async function startConversationWithCoach(userData) {
            try {
                const firstMessage = await aiCoach.startConversation(userData);
                addMessageToChat('assistant', firstMessage);
            } catch (error) {
                console.error('Erreur lors du démarrage de la conversation:', error);
                addMessageToChat('assistant', 'Désolé, une erreur s\'est produite. Pouvez-vous me dire ce qui vous amène ici aujourd\'hui ?');
            }
        }

        async function sendMessageToCoach() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // Ajouter le message utilisateur
            addMessageToChat('user', message);
            input.value = '';

            // Désactiver l'input pendant la réponse
            input.disabled = true;
            document.querySelector('.btn-send').disabled = true;

            try {
                // Obtenir la réponse du coach IA
                const response = await aiCoach.sendMessage(message);
                addMessageToChat('assistant', response);
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message:', error);
                addMessageToChat('assistant', 'Je rencontre un problème technique. Pouvez-vous reformuler votre pensée ?');
            }

            // Réactiver l'input
            input.disabled = false;
            document.querySelector('.btn-send').disabled = false;
            input.focus();
        }

        function addMessageToChat(role, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;

            const avatar = role === 'user' ? '👤' : '🤖';

            // S'assurer que le contenu est une string
            let displayContent = content;
            if (typeof content === 'object') {
                console.warn('Contenu objet reçu, tentative d\'extraction:', content);
                if (content && content.choices && content.choices[0] && content.choices[0].message) {
                    displayContent = content.choices[0].message.content;
                } else if (content && typeof content.toString === 'function') {
                    displayContent = content.toString();
                } else {
                    displayContent = 'Erreur: Réponse du coach non valide';
                }
            }

            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-text">${displayContent}</div>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                </div>
            `;

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showCoachHelp() {
            const helpText = `
🤖 <strong>Comment fonctionne votre Coach IA :</strong><br><br>

🧠 <strong>Méthode Socratique :</strong> Je pose des questions puissantes pour vous guider vers vos propres découvertes<br><br>

💭 <strong>Mémoire Contextuelle :</strong> Je me souviens de nos échanges précédents pour des conseils personnalisés<br><br>

😊 <strong>Adaptation Émotionnelle :</strong> Je détecte votre état émotionnel et m'adapte (enthousiasme, frustration, confusion)<br><br>

🎯 <strong>Expertise Métier :</strong> Je connais les tendances des secteurs, les réalités économiques et les parcours réussis<br><br>

💡 <strong>Conseils d'utilisation :</strong><br>
• Soyez honnête et authentique<br>
• Prenez le temps de réfléchir à mes questions<br>
• Partagez vos doutes et blocages<br>
• Laissez-vous guider naturellement<br><br>

🔄 <strong>Pour commencer :</strong> Dites-moi simplement ce qui vous amène ici aujourd'hui !
            `;

            addMessageToChat('assistant', helpText);
        }

        function getConversationSummary() {
            const summary = aiCoach.getConversationSummary();

            const summaryText = `
📊 <strong>Résumé de notre conversation :</strong><br><br>

🗣️ <strong>${summary.totalMessages} messages échangés</strong><br>
👤 <strong>${summary.userMessages} messages de votre part</strong><br>
🎭 <strong>État émotionnel moyen : ${summary.avgEmotionalState}</strong><br><br>

🎯 <strong>Sujets abordés :</strong> ${summary.keyTopics.join(', ') || 'Aucun sujet spécifique'}<br><br>

📈 <strong>Progression : ${summary.progressIndicators.percentage.toFixed(0)}%</strong><br><br>

💡 <strong>Prochaines étapes suggérées :</strong><br>
${summary.progressIndicators.nextSteps.map(step => `• ${step}`).join('<br>')}
            `;

            addMessageToChat('assistant', summaryText);
        }

        function clearConversation() {
            if (confirm('Êtes-vous sûr de vouloir effacer la conversation ? Cette action est irréversible.')) {
                aiCoach.conversationHistory = [];
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message system-message">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="message-text">Conversation effacée. Par quoi souhaitez-vous commencer ?</div>
                            <div class="message-time">${new Date().toLocaleTimeString()}</div>
                        </div>
                    </div>
                `;
            }
        }

        function closeAICoach() {
            const modal = document.getElementById('aiCoachModal');
            if (modal) {
                modal.remove();
            }
        }

        // Analyse comportementale avancée
        async function showBehavioralAnalysis() {
            const modal = document.createElement('div');
            modal.id = 'behavioralAnalysisModal';
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content large-modal">
                    <div class="modal-header">
                        <h3>📊 Analyse Comportementale Avancée</h3>
                        <button class="modal-close" onclick="closeBehavioralAnalysis()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="analysis-tabs">
                            <button class="tab-btn active" onclick="switchAnalysisTab('patterns')">🎭 Patterns</button>
                            <button class="tab-btn" onclick="switchAnalysisTab('predictions')">🔮 Prédictions</button>
                            <button class="tab-btn" onclick="switchAnalysisTab('biases')">🧠 Biais</button>
                            <button class="tab-btn" onclick="switchAnalysisTab('insights')">💡 Insights</button>
                        </div>
                        <div id="analysisContent">
                            <div class="loading-analysis">
                                <div class="loading-spinner"></div>
                                <p>Analyse comportementale en cours...</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'flex';

            // Lancer l'analyse
            setTimeout(() => {
                performBehavioralAnalysis();
            }, 1000);
        }

        async function performBehavioralAnalysis() {
            try {
                if (typeof aiCoach !== 'undefined' && aiCoach.analyzeBehavioralPatterns) {
                    const analysis = await aiCoach.analyzeBehavioralPatterns();
                    displayBehavioralAnalysis(analysis);
                } else {
                    console.warn('AI Coach non disponible, utilisation de l\'analyse basique');
                    const basicAnalysis = generateBasicAnalysis();
                    displayBehavioralAnalysis(basicAnalysis);
                }
                
                // Afficher l'onglet patterns par défaut
                const content = document.getElementById('analysisContent');
                displayPatternsAnalysis(content);
            } catch (error) {
                console.error('Erreur lors de l\'analyse comportementale:', error);
                displayAnalysisError();
            }
        }

        function generateBasicAnalysis() {
            return {
                patterns: [
                    {
                        type: 'exploration_active',
                        description: 'Vous êtes en phase d\'exploration active de vos passions et talents',
                        confidence: 0.8
                    }
                ],
                predictions: [
                    {
                        type: 'career_success',
                        probability: 0.7,
                        factors: ['Engagement dans la réflexion', 'Utilisation d\'outils de développement personnel']
                    }
                ]
            };
        }

        function displayAnalysisError() {
            const content = document.getElementById('analysisContent');
            content.innerHTML = `
                <div class="error-message">
                    <h4>⚠️ Erreur d'analyse</h4>
                    <p>Une erreur s'est produite lors de l'analyse comportementale. Veuillez réessayer plus tard.</p>
                </div>
            `;
        }

        function displayBehavioralAnalysis(analysis) {
            const content = document.getElementById('analysisContent');

            let html = '<div class="behavioral-results">';

            // Patterns identifiés
            if (analysis.patterns.length > 0) {
                html += '<div class="analysis-section"><h4>🎭 Patterns Comportementaux Identifiés</h4>';
                analysis.patterns.forEach(pattern => {
                    const confidencePercent = (pattern.confidence * 100).toFixed(0);
                    html += `
                        <div class="pattern-card">
                            <div class="pattern-header">
                                <h5>${pattern.type.replace('_', ' ').toUpperCase()}</h5>
                                <span class="confidence-badge">${confidencePercent}% de confiance</span>
                            </div>
                            <p>${pattern.description}</p>
                            <div class="pattern-actions">
                                <button class="btn-tiny" onclick="getPatternAdvice('${pattern.type}')">💡 Conseils</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Prédictions de succès
            if (analysis.predictions.length > 0) {
                html += '<div class="analysis-section"><h4>🔮 Prédictions de Succès</h4>';
                analysis.predictions.forEach(prediction => {
                    const probabilityPercent = (prediction.probability * 100).toFixed(0);
                    const probabilityColor = prediction.probability >= 0.7 ? '#28a745' : prediction.probability >= 0.4 ? '#ffc107' : '#dc3545';

                    html += `
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <h5>${prediction.type.replace('_', ' ').toUpperCase()}</h5>
                                <span class="probability-badge" style="background: ${probabilityColor}">${probabilityPercent}%</span>
                            </div>
                            <div class="prediction-factors">
                                <strong>Facteurs influençant :</strong>
                                <ul>
                                    ${prediction.factors.map(factor => `<li>${factor}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Biais cognitifs
            if (analysis.biases.length > 0) {
                html += '<div class="analysis-section"><h4>🧠 Biais Cognitifs Détectés</h4>';
                analysis.biases.forEach(bias => {
                    html += `
                        <div class="bias-card">
                            <h5>${bias.type}</h5>
                            <p>${bias.description}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Recommandations
            if (analysis.recommendations.length > 0) {
                html += '<div class="analysis-section"><h4>💡 Recommandations Personnalisées</h4>';
                analysis.recommendations.forEach(rec => {
                    html += `<div class="recommendation-item">• ${rec}</div>`;
                });
                html += '</div>';
            }

            if (analysis.patterns.length === 0 && analysis.predictions.length === 0 &&
                analysis.biases.length === 0 && analysis.recommendations.length === 0) {
                html += '<div class="no-analysis"><p>Pas assez de données pour une analyse comportementale approfondie. Continuez à explorer votre Ikigai !</p></div>';
            }

            html += '</div>';
            content.innerHTML = html;
        }

        function displayAnalysisError() {
            const content = document.getElementById('analysisContent');
            content.innerHTML = `
                <div class="analysis-error">
                    <h4>❌ Erreur d'analyse</h4>
                    <p>Impossible de réaliser l'analyse comportementale pour le moment.</p>
                    <p>Vérifiez votre connexion internet ou réessayez plus tard.</p>
                </div>
            `;
        }

        function switchAnalysisTab(tabType) {
            // Désactiver tous les onglets
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const content = document.getElementById('analysisContent');
            
            switch(tabType) {
                case 'patterns':
                    displayPatternsAnalysis(content);
                    break;
                case 'predictions':
                    displayPredictionsAnalysis(content);
                    break;
                case 'biases':
                    displayBiasesAnalysis(content);
                    break;
                case 'insights':
                    displayInsightsAnalysis(content);
                    break;
                default:
                    content.innerHTML = `<div class="tab-placeholder"><p>Contenu de l'onglet ${tabType} en développement...</p></div>`;
            }
        }

        function displayPatternsAnalysis(container) {
            const patterns = [
                {
                    type: 'exploration_active',
                    title: 'Exploration Active',
                    description: 'Vous êtes actuellement en phase d\'exploration active de vos passions et talents',
                    confidence: 0.85,
                    advice: 'Continuez cette démarche introspective, elle est très prometteuse !'
                },
                {
                    type: 'growth_mindset',
                    title: 'Mentalité de Croissance',
                    description: 'Votre approche démontre une ouverture à l\'apprentissage et au développement',
                    confidence: 0.78,
                    advice: 'Exploitez cette force pour surmonter les obstacles futurs'
                }
            ];

            let html = '<div class="patterns-results"><h4>🎭 Patterns Comportementaux Détectés</h4>';
            
            patterns.forEach(pattern => {
                const confidencePercent = (pattern.confidence * 100).toFixed(0);
                html += `
                    <div class="pattern-card">
                        <div class="pattern-header">
                            <h5>${pattern.title}</h5>
                            <span class="confidence-badge">${confidencePercent}% de confiance</span>
                        </div>
                        <p class="pattern-description">${pattern.description}</p>
                        <div class="pattern-advice">
                            <strong>💡 Conseil :</strong> ${pattern.advice}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayPredictionsAnalysis(container) {
            const completionLevel = calculateCompletionLevel();
            
            let successProbability = 0.4;
            if (completionLevel > 75) successProbability = 0.85;
            else if (completionLevel > 50) successProbability = 0.70;
            else if (completionLevel > 25) successProbability = 0.55;

            const predictions = [
                {
                    type: 'Alignement Ikigai',
                    probability: successProbability,
                    factors: [
                        `${Math.round(completionLevel)}% de profil complété`,
                        'Démarche proactive entreprise',
                        'Utilisation d\'outils de développement personnel'
                    ],
                    timeline: '3-6 mois'
                },
                {
                    type: 'Changement Professionnel',
                    probability: successProbability * 0.8,
                    factors: [
                        'Conscience de ses talents naturels',
                        'Identification des problèmes à résoudre',
                        'Ouverture au changement'
                    ],
                    timeline: '6-12 mois'
                }
            ];

            let html = '<div class="predictions-results"><h4>🔮 Prédictions de Succès Personnalisées</h4>';
            
            predictions.forEach(prediction => {
                const probabilityPercent = (prediction.probability * 100).toFixed(0);
                const probabilityColor = prediction.probability >= 0.7 ? '#28a745' : prediction.probability >= 0.4 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div class="prediction-card">
                        <div class="prediction-header">
                            <h5>${prediction.type}</h5>
                            <span class="probability-badge" style="background: ${probabilityColor}; color: white; padding: 5px 10px; border-radius: 15px;">${probabilityPercent}%</span>
                        </div>
                        <div class="prediction-factors">
                            <strong>📈 Facteurs positifs :</strong>
                            <ul>
                                ${prediction.factors.map(factor => `<li>${factor}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="prediction-timeline">
                            <strong>⏱️ Échéance probable :</strong> ${prediction.timeline}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayBiasesAnalysis(container) {
            const biases = [
                {
                    type: 'Syndrome de l\'imposteur',
                    detected: Math.random() > 0.6,
                    description: 'Tendance à minimiser ses compétences et accomplissements',
                    impact: 'Modéré',
                    solution: 'Tenez un journal de vos réussites quotidiennes'
                },
                {
                    type: 'Perfectionnisme',
                    detected: Math.random() > 0.5,
                    description: 'Recherche excessive de la perfection qui peut paralyser l\'action',
                    impact: 'Élevé',
                    solution: 'Adoptez la règle du "assez bon" et fixez des échéances'
                },
                {
                    type: 'Biais de confirmation',
                    detected: Math.random() > 0.7,
                    description: 'Tendance à ne chercher que des informations qui confirment nos croyances',
                    impact: 'Faible',
                    solution: 'Cherchez activement des points de vue opposés'
                }
            ];

            let html = '<div class="biases-results"><h4>🧠 Analyse des Biais Cognitifs</h4>';
            
            biases.forEach(bias => {
                const statusIcon = bias.detected ? '⚠️' : '✅';
                const statusText = bias.detected ? 'Détecté' : 'Non détecté';
                const statusClass = bias.detected ? 'bias-detected' : 'bias-clear';
                
                html += `
                    <div class="bias-card ${statusClass}">
                        <div class="bias-header">
                            <h5>${statusIcon} ${bias.type}</h5>
                            <span class="bias-status ${statusClass}">${statusText}</span>
                        </div>
                        <p class="bias-description">${bias.description}</p>
                        ${bias.detected ? `
                            <div class="bias-impact">
                                <strong>Impact :</strong> ${bias.impact}
                            </div>
                            <div class="bias-solution">
                                <strong>💡 Solution :</strong> ${bias.solution}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayInsightsAnalysis(container) {
            const insights = generatePersonalizedInsights();
            
            let html = '<div class="insights-results"><h4>💡 Insights Personnalisés</h4>';
            
            insights.forEach(insight => {
                html += `
                    <div class="insight-card">
                        <div class="insight-header">
                            <h5>${insight.icon} ${insight.title}</h5>
                            <span class="insight-category">${insight.category}</span>
                        </div>
                        <p class="insight-description">${insight.description}</p>
                        <div class="insight-action">
                            <strong>🎯 Action recommandée :</strong> ${insight.action}
                        </div>
                        ${insight.resources ? `
                            <div class="insight-resources">
                                <strong>📚 Ressources :</strong> ${insight.resources}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function generatePersonalizedInsights() {
            const totalElements = Object.values(ikigaiData).reduce((sum, arr) => sum + arr.length, 0);
            
            const insights = [
                {
                    icon: '🎯',
                    title: 'Zone de Focus Prioritaire',
                    category: 'Stratégie',
                    description: `Avec ${totalElements} éléments identifiés, vous devriez vous concentrer sur l'approfondissement plutôt que l'élargissement.`,
                    action: 'Choisissez vos 3 éléments les plus forts dans chaque catégorie et explorez-les davantage.',
                    resources: 'Technique du "Deep Work" par Cal Newport'
                },
                {
                    icon: '🔗',
                    title: 'Opportunités de Synergie',
                    category: 'Innovation',
                    description: 'Des connexions inattendues entre vos passions et compétences pourraient révéler des opportunités uniques.',
                    action: 'Créez une carte mentale reliant vos différents intérêts et compétences.',
                    resources: 'Méthode de "Combinaison créative" de James Webb Young'
                },
                {
                    icon: '📈',
                    title: 'Potentiel de Croissance',
                    category: 'Développement',
                    description: 'Votre profil montre un fort potentiel d\'évolution dans les domaines créatifs et technologiques.',
                    action: 'Investissez dans une formation qui combine créativité et technologie.',
                    resources: 'Coursera, Udemy, ou formations locales en design thinking'
                }
            ];
            
            return insights;
        }

        function getPatternAdvice(patternType) {
            const advice = {
                'impostor_syndrome': `
💡 <strong>Conseils pour le Syndrome de l'Imposteur :</strong><br><br>
• Listez vos accomplissements concrets<br>
• Célébrez vos petites victoires quotidiennes<br>
• Entourez-vous de personnes bienveillantes<br>
• Rappelez-vous : "Si j'ai été choisi, c'est que je mérite d'être là"<br>
• Transformez "Je ne suis pas assez" en "Qu'est-ce que je peux apprendre ?"
                `,
                'perfectionism': `
💡 <strong>Conseils contre le Perfectionnisme :</strong><br><br>
• Adoptez le "bon assez" plutôt que la perfection<br>
• Fixez-vous des deadlines réalistes<br>
• Célébrez l'effort plutôt que le résultat<br>
• Acceptez que l'imperfection fait partie de l'apprentissage<br>
• Commencez par des tâches plus petites
                `,
                'procrastination': `
💡 <strong>Conseils contre la Procrastination :</strong><br><br>
• Utilisez la technique Pomodoro (25min travail + 5min pause)<br>
• Commencez par la tâche la plus facile<br>
• Décomposez les gros projets en petites étapes<br>
• Identifiez vos moments de plus haute énergie<br>
• Récompensez-vous après chaque accomplissement
                `
            };

            const patternAdvice = advice[patternType] || 'Conseils spécifiques en développement...';
            alert(patternAdvice);
        }

        function closeBehavioralAnalysis() {
            const modal = document.getElementById('behavioralAnalysisModal');
            if (modal) {
                modal.remove();
            }
        }

        // Détection de patterns de procrastination
        function detectProcrastinationPatterns() {
            const patterns = [];
            const allText = [
                ...ikigaiData.passions,
                ...ikigaiData.talents,
                ...ikigaiData.problems,
                ...ikigaiData.skills,
                document.getElementById('passionDescription')?.value || '',
                document.getElementById('talentFeedback')?.value || '',
                document.getElementById('worldContribution')?.value || '',
                document.getElementById('economicOpportunities')?.value || ''
            ].join(' ').toLowerCase();

            // Patterns de procrastination courants
            const procrastinationIndicators = [
                {
                    keywords: ['plus tard', 'demain', 'bientôt', 'un jour', 'peut-être'],
                    pattern: 'Remise à plus tard généralisée',
                    advice: 'Utilisez la technique Pomodoro : 25 minutes de travail concentré'
                },
                {
                    keywords: ['parfait', 'idéal', 'parfaitement', 'impeccable'],
                    pattern: 'Syndrome de la perfection',
                    advice: 'Adoptez le "bon assez" - terminez plutôt que perfectionner'
                },
                {
                    keywords: ['difficile', 'compliqué', 'dur', 'lourd', 'fastidieux'],
                    pattern: 'Peur de l\'effort',
                    advice: 'Commencez par la tâche la plus facile pour créer de l\'élan'
                },
                {
                    keywords: ['trop', 'beaucoup', 'énorme', 'gigantesque'],
                    pattern: 'Projets trop ambitieux',
                    advice: 'Décomposez en tâches minuscules et réalisables'
                },
                {
                    keywords: ['distraction', 'réseaux', 'téléphone', 'social'],
                    pattern: 'Distractions numériques',
                    advice: 'Utilisez des apps de blocage et créez des rituels de concentration'
                }
            ];

            procrastinationIndicators.forEach(indicator => {
                const matches = indicator.keywords.filter(keyword => allText.includes(keyword));
                if (matches.length >= 2) {
                    patterns.push({
                        pattern: indicator.pattern,
                        triggers: matches,
                        advice: indicator.advice,
                        severity: matches.length >= 3 ? 'high' : 'medium'
                    });
                }
            });

            // Patterns basés sur l'inactivité
            if (ikigaiData.passions.length === 0) {
                patterns.push({
                    pattern: 'Évitement de l\'introspection',
                    triggers: ['Aucune passion saisie'],
                    advice: 'Commencez par noter 3 activités que vous aimez vraiment',
                    severity: 'high'
                });
            }

            if (ikigaiData.problems.length === 0) {
                patterns.push({
                    pattern: 'Évitement des problèmes du monde',
                    triggers: ['Aucun problème identifié'],
                    advice: 'Quelles injustices vous touchent personnellement ?',
                    severity: 'medium'
                });
            }

            return patterns;
        }

        function displayProcrastinationInsights() {
            const patterns = detectProcrastinationPatterns();

            if (patterns.length === 0) {
                return '<p>✅ Aucun pattern de procrastination détecté. Continuez comme ça !</p>';
            }

            let html = '<h4>🎯 Patterns de Procrastination Identifiés</h4>';

            patterns.forEach(pattern => {
                const severityColor = pattern.severity === 'high' ? '#dc3545' : '#ffc107';
                html += `
                    <div class="procrastination-pattern" style="border-left-color: ${severityColor}">
                        <h5 style="color: ${severityColor}">${pattern.pattern}</h5>
                        <div class="pattern-triggers">
                            <strong>Déclencheurs :</strong> ${pattern.triggers.join(', ')}
                        </div>
                        <div class="pattern-advice">
                            <strong>💡 Conseil :</strong> ${pattern.advice}
                        </div>
                    </div>
                `;
            });

            return html;
        }

        // Nouvelles fonctions d'interaction améliorées
        
        // Affichage des détails de section au survol
        function showSectionDetails(section) {
            const tooltip = document.getElementById('sectionTooltip');
            const items = ikigaiData[getSectionDataKey(section)];
            
            if (items.length === 0) return;
            
            const sectionNames = {
                passion: 'Ce que vous aimez',
                mission: 'Ce en quoi vous excellez', 
                profession: 'Ce dont le monde a besoin',
                vocation: 'Ce pour quoi vous pouvez être payé'
            };
            
            document.getElementById('tooltipHeader').textContent = sectionNames[section];
            document.getElementById('tooltipContent').innerHTML = items.slice(0, 3).map(item => `• ${item}`).join('<br>');
            
            tooltip.style.display = 'block';
            
            // Positionner le tooltip près du curseur
            document.addEventListener('mousemove', updateTooltipPosition);
        }
        
        function hideSectionDetails() {
            document.getElementById('sectionTooltip').style.display = 'none';
            document.removeEventListener('mousemove', updateTooltipPosition);
        }
        
        function updateTooltipPosition(e) {
            const tooltip = document.getElementById('sectionTooltip');
            tooltip.style.left = (e.pageX + 15) + 'px';
            tooltip.style.top = (e.pageY - 15) + 'px';
        }
        
        function getSectionDataKey(section) {
            const mapping = {
                passion: 'passions',
                mission: 'talents',
                profession: 'problems', 
                vocation: 'skills'
            };
            return mapping[section];
        }

        // Calcul et affichage des scores d'intersection
        function calculateIntersectionStrength(section1, section2) {
            const data1 = ikigaiData[getSectionDataKey(section1)];
            const data2 = ikigaiData[getSectionDataKey(section2)];
            
            if (data1.length === 0 || data2.length === 0) return 0;
            
            // Calcul basé sur le nombre d'éléments et leur qualité supposée
            const baseScore = Math.min((data1.length + data2.length) / 10 * 100, 100);
            
            // Bonus si les sections sont bien remplies
            const completionBonus = (data1.length >= 3 && data2.length >= 3) ? 20 : 0;
            
            return Math.min(baseScore + completionBonus, 100);
        }

        function updateIntersectionStrengths() {
            const intersections = [
                { id: 'passionMissionStrength', sections: ['passion', 'mission'] },
                { id: 'missionProfessionStrength', sections: ['mission', 'profession'] },
                { id: 'professionVocationStrength', sections: ['profession', 'vocation'] },
                { id: 'vocationPassionStrength', sections: ['vocation', 'passion'] }
            ];
            
            intersections.forEach(intersection => {
                const strength = calculateIntersectionStrength(intersection.sections[0], intersection.sections[1]);
                document.getElementById(intersection.id).textContent = Math.round(strength) + '%';
            });
        }

        // Calcul du score Ikigai global
        function calculateIkigaiScore() {
            const sections = ['passions', 'talents', 'problems', 'skills'];
            let totalScore = 0;
            let completedSections = 0;
            
            sections.forEach(section => {
                if (ikigaiData[section].length > 0) {
                    completedSections++;
                    // Score basé sur le nombre d'éléments (max 5 par section)
                    totalScore += Math.min(ikigaiData[section].length / 5 * 25, 25);
                }
            });
            
            // Bonus d'équilibre si toutes les sections sont remplies
            const balanceBonus = (completedSections === 4) ? 20 : 0;
            
            return Math.min(totalScore + balanceBonus, 100);
        }

        function updateIkigaiScore() {
            const score = calculateIkigaiScore();
            document.getElementById('ikigaiScore').textContent = Math.round(score) + '%';
            
            // Changer la couleur du centre selon le score
            const center = document.querySelector('.ikigai-center');
            if (score >= 80) {
                center.style.background = 'radial-gradient(circle, #00ff00, #32cd32)';
            } else if (score >= 60) {
                center.style.background = 'radial-gradient(circle, #FFD700, #FFA500)';
            } else if (score >= 40) {
                center.style.background = 'radial-gradient(circle, #ff6b6b, #ffa500)';
            } else {
                center.style.background = 'radial-gradient(circle, #ccc, #999)';
            }
        }

        // Analyse des déséquilibres
        function updateBalanceAnalysis() {
            const passion = ikigaiData.passions.length;
            const talent = ikigaiData.talents.length;
            const problem = ikigaiData.problems.length;
            const skill = ikigaiData.skills.length;
            
            // Passion vs Pragmatisme (passion+talent vs problem+skill)
            const passionSide = passion + talent;
            const pragmatismSide = problem + skill;
            const passionPragmatismBalance = passionSide / (passionSide + pragmatismSide) * 100;
            
            // Personnel vs Professionnel (passion+problem vs talent+skill)
            const personalSide = passion + problem;
            const professionalSide = talent + skill;
            const personalProfessionalBalance = personalSide / (personalSide + professionalSide) * 100;
            
            // Idéal vs Réalisme (passion+talent vs problem+skill - différent calcul)
            const idealSide = passion + problem;
            const realismSide = talent + skill;
            const idealRealismBalance = idealSide / (idealSide + realismSide) * 100;
            
            document.getElementById('passionPragmatismBalance').style.width = passionPragmatismBalance + '%';
            document.getElementById('personalProfessionalBalance').style.width = personalProfessionalBalance + '%';
            document.getElementById('idealRealismBalance').style.width = idealRealismBalance + '%';
        }

        // Modal d'intersection détaillée
        function showIntersectionDetails(intersectionType) {
            const modal = document.createElement('div');
            modal.className = 'intersection-modal';
            modal.style.display = 'flex';
            
            const intersectionData = getIntersectionData(intersectionType);
            
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="modal-close" onclick="closeModal(this)">&times;</span>
                    <h3>${intersectionData.title}</h3>
                    <div class="intersection-details">
                        <p><strong>Ce que cela signifie :</strong></p>
                        <p>${intersectionData.description}</p>
                        
                        <div class="intersection-suggestions">
                            <h4>💡 Suggestions pour renforcer cette intersection :</h4>
                            ${intersectionData.suggestions.map(s => `<div class="suggestion-card">• ${s}</div>`).join('')}
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <strong>Force actuelle : ${intersectionData.strength}%</strong>
                            <div class="balance-bar" style="margin-top: 5px;">
                                <div class="balance-fill" style="width: ${intersectionData.strength}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function getIntersectionData(intersectionType) {
            const data = {
                'passion-mission': {
                    title: '❤️ Passion + 🎯 Mission = JOIE',
                    description: 'Quand vous faites ce que vous aimez ET ce en quoi vous excellez, vous éprouvez une joie profonde, mais attention au risque de manquer de revenus.',
                    suggestions: [
                        'Identifiez comment monétiser vos talents passion',
                        'Cherchez des missions qui combinent plaisir et expertise',
                        'Développez vos compétences dans vos domaines de passion'
                    ],
                    strength: calculateIntersectionStrength('passion', 'mission')
                },
                'mission-profession': {
                    title: '🎯 Mission + 🌍 Besoin = EXCELLENCE',
                    description: 'Vos talents répondent aux besoins du monde - c\'est là que vous pouvez exceller, mais veillez à rester passionné.',
                    suggestions: [
                        'Identifiez les secteurs où vos talents sont le plus demandés',
                        'Développez votre expertise dans ces domaines',
                        'Créez de la valeur mesurable pour les autres'
                    ],
                    strength: calculateIntersectionStrength('mission', 'profession')
                },
                'profession-vocation': {
                    title: '🌍 Besoin + 💰 Rémunération = PROSPÉRITÉ',
                    description: 'Vous répondez à un besoin ET pouvez en vivre - c\'est la base de la prospérité, mais gardez votre passion.',
                    suggestions: [
                        'Optimisez vos revenus dans ces domaines',
                        'Développez plusieurs sources de revenus',
                        'Automatisez ce qui peut l\'être'
                    ],
                    strength: calculateIntersectionStrength('profession', 'vocation')
                },
                'vocation-passion': {
                    title: '💰 Rémunération + ❤️ Passion = PLÉNITUDE',
                    description: 'Être payé pour faire ce qu\'on aime - le rêve ! Mais assurez-vous que le monde en a vraiment besoin.',
                    suggestions: [
                        'Validez la demande du marché pour vos passions',
                        'Créez de la valeur authentique',
                        'Développez votre personal branding'
                    ],
                    strength: calculateIntersectionStrength('vocation', 'passion')
                }
            };
            
            return data[intersectionType];
        }

        function closeModal(element) {
            element.closest('.intersection-modal').remove();
        }

        function showIkigaiScore() {
            const score = calculateIkigaiScore();
            let message = '';
            let recommendations = [];
            
            if (score >= 80) {
                message = '🌟 Excellent ! Votre Ikigai est très équilibré.';
                recommendations = [
                    'Continuez sur cette voie',
                    'Partagez votre expérience avec d\'autres',
                    'Affinez continuellement votre approche'
                ];
            } else if (score >= 60) {
                message = '👍 Bon équilibre, quelques ajustements possible.';
                recommendations = [
                    'Identifiez les sections les moins développées',
                    'Cherchez des connexions entre vos différents domaines',
                    'Expérimentez de nouvelles approches'
                ];
            } else if (score >= 40) {
                message = '⚠️ Votre Ikigai nécessite du travail.';
                recommendations = [
                    'Focalisez-vous sur une section à la fois',
                    'Prenez le temps de la réflexion profonde',
                    'Demandez des retours à votre entourage'
                ];
            } else {
                message = '🚨 Commencez par explorer une section qui vous inspire.';
                recommendations = [
                    'Ne vous découragez pas, c\'est un processus',
                    'Commencez par ce que vous aimez vraiment',
                    'Avancez étape par étape'
                ];
            }
            
            alert(`${message}\n\nRecommandations :\n• ${recommendations.join('\n• ')}`);
        }

        // Mise à jour de la fonction updateProgress existante
        function updateProgress() {
            const passionPercent = Math.min((ikigaiData.passions.length / 5) * 100, 100);
            const talentPercent = Math.min((ikigaiData.talents.length / 5) * 100, 100);
            const needPercent = Math.min((ikigaiData.problems.length / 5) * 100, 100);
            const opportunityPercent = Math.min((ikigaiData.skills.length / 5) * 100, 100);
            
            document.getElementById('passionBar').style.width = passionPercent + '%';
            document.getElementById('talentBar').style.width = talentPercent + '%';
            document.getElementById('needBar').style.width = needPercent + '%';
            document.getElementById('opportunityBar').style.width = opportunityPercent + '%';
            
            document.getElementById('passionProgress').textContent = Math.round(passionPercent) + '%';
            document.getElementById('talentProgress').textContent = Math.round(talentPercent) + '%';
            document.getElementById('needProgress').textContent = Math.round(needPercent) + '%';
            document.getElementById('opportunityProgress').textContent = Math.round(opportunityPercent) + '%';
            
            // Mise à jour des compteurs dans les cercles
            const passionCountEl = document.getElementById('passionCount');
            const missionCountEl = document.getElementById('missionCount');
            const professionCountEl = document.getElementById('professionCount');
            const vocationCountEl = document.getElementById('vocationCount');
            
            if (passionCountEl) passionCountEl.textContent = ikigaiData.passions.length;
            if (missionCountEl) missionCountEl.textContent = ikigaiData.talents.length;
            if (professionCountEl) professionCountEl.textContent = ikigaiData.problems.length;
            if (vocationCountEl) vocationCountEl.textContent = ikigaiData.skills.length;
            
            // Nouvelles mises à jour
            updateIntersectionStrengths();
            updateIkigaiScore();
            updateBalanceAnalysis();
        }

        // Mise à jour des points de progression
        function updateDots() {
            const conditions = [
                ikigaiData.passions.length >= 3,
                ikigaiData.talents.length >= 3,
                ikigaiData.problems.length >= 3,
                ikigaiData.skills.length >= 3,
                Object.values(ikigaiData).every(arr => arr.length >= 2)
            ];
            
            conditions.forEach((condition, index) => {
                const dot = document.getElementById(`dot${index + 1}`);
                if (condition) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            });
        }

        // Mise en évidence des sections
        function highlightSection(section) {
            // Mapping des sections du parcours vers les cercles de visualisation
            const sectionMapping = {
                'passions': 'passion',
                'talents': 'mission', 
                'problems': 'profession',
                'skills': 'vocation'
            };
            
            const circleClass = sectionMapping[section] || section;
            
            // Reset tous les cercles
            document.querySelectorAll('.circle').forEach(circle => {
                circle.style.opacity = '0.3';
                circle.style.transform = 'scale(1)';
            });
            
            // Mettre en évidence la section sélectionnée
            const targetCircle = document.querySelector(`.circle-${circleClass}`);
            if (targetCircle) {
                targetCircle.style.opacity = '1';
                targetCircle.style.transform = 'scale(1.1)';
                targetCircle.style.boxShadow = '0 0 20px rgba(255, 165, 0, 0.6)';
            }
            
            // Reset après 3 secondes
            setTimeout(() => {
                document.querySelectorAll('.circle').forEach(circle => {
                    circle.style.opacity = '0.7';
                    circle.style.transform = 'scale(1)';
                    circle.style.boxShadow = '';
                });
            }, 3000);
        }

        // Analyse de l'Ikigai
        function analyzeIkigai() {
            // Vérifier que toutes les sections ont au moins 2 éléments
            const isComplete = Object.values(ikigaiData).every(arr => arr.length >= 2);
            
            if (!isComplete) {
                alert('⚠️ Veuillez remplir au moins 2 éléments dans chaque section pour générer votre Ikigai.');
                return;
            }
            
            // Générer l'analyse
            generateIkigaiAnalysis();
            
            // Afficher les résultats
            document.getElementById('ikigaiResult').style.display = 'block';
            document.getElementById('ikigaiResult').scrollIntoView({ behavior: 'smooth' });
        }

        function generateIkigaiAnalysis() {
            // Construire la déclaration Ikigai
            const statement = generateIkigaiStatement();
            document.getElementById('ikigaiStatement').textContent = statement;
            
            // Remplir les résumés
            document.getElementById('passionSummary').textContent = ikigaiData.passions.slice(0, 3).join(', ');
            document.getElementById('missionSummary').textContent = ikigaiData.talents.slice(0, 3).join(', ');
            document.getElementById('professionSummary').textContent = ikigaiData.problems.slice(0, 3).join(', ');
            document.getElementById('vocationSummary').textContent = ikigaiData.skills.slice(0, 3).join(', ');
            
            // Générer les recommandations
            generateRecommendations();
        }

        function generateIkigaiStatement() {
            const passion = ikigaiData.passions[0] || 'votre passion';
            const talent = ikigaiData.talents[0] || 'vos talents';
            const problem = ikigaiData.problems[0] || 'les besoins du monde';
            const skill = ikigaiData.skills[0] || 'vos compétences';
            
            return `Votre Ikigai se trouve dans l'utilisation de ${talent} pour résoudre ${problem}, en vous appuyant sur votre passion pour ${passion}, tout en développant ${skill} comme source de revenus durable.`;
        }

        function generateRecommendations() {
            const recommendations = [
                `🎯 <strong>Action immédiate :</strong> Commencez par un projet qui combine ${ikigaiData.passions[0]} et ${ikigaiData.talents[0]}.`,
                `💡 <strong>Développement :</strong> Approfondissez vos compétences en ${ikigaiData.skills[0]} pour créer de la valeur.`,
                `🌱 <strong>Impact :</strong> Cherchez des moyens d'adresser ${ikigaiData.problems[0]} dans votre quotidien.`,
                `🔄 <strong>Évolution :</strong> Réévaluez votre Ikigai tous les 6 mois pour l'adapter à votre croissance.`,
                `🤝 <strong>Communauté :</strong> Connectez-vous avec d'autres personnes partageant vos passions et visions.`
            ];
            
            document.getElementById('recommendations').innerHTML = recommendations.map(rec => 
                `<div class="suggestion-item">${rec}</div>`
            ).join('');
        }

        // Remplir avec des données d'exemple
        function fillExampleData() {
            // Réinitialiser
            ikigaiData = {
                passions: ['Écriture', 'Psychologie', 'Développement personnel', 'Voyages', 'Photographie'],
                talents: ['Communication', 'Écoute active', 'Analyse', 'Créativité', 'Empathie'],
                problems: ['Stress au travail', 'Manque de confiance', 'Isolation sociale', 'Burnout', 'Orientation professionnelle'],
                skills: ['Coaching', 'Formation', 'Consultation', 'Rédaction', 'Thérapie']
            };
            
            // Remplir l'interface
            updateTagDisplay('passionTags', ikigaiData.passions, 'passions');
            updateTagDisplay('talentTags', ikigaiData.talents, 'talents');
            updateTagDisplay('problemTags', ikigaiData.problems, 'problems');
            updateTagDisplay('skillTags', ikigaiData.skills, 'skills');
            
            // Remplir les descriptions
            document.getElementById('passionDescription').value = "J'ai toujours été passionné par la compréhension de l'être humain et la façon dont nous pouvons nous développer. L'écriture me permet d'exprimer ces idées et de les partager.";
            document.getElementById('talentFeedback').value = "Les gens me disent souvent que j'ai un don pour écouter et pour poser les bonnes questions. Je parviens à créer un environnement de confiance rapidement.";
            document.getElementById('worldContribution').value = "Je veux aider les gens à retrouver du sens dans leur travail et leur vie. Trop de personnes souffrent de stress et de manque de direction.";
            document.getElementById('economicOpportunities').value = "Il y a une demande croissante pour le coaching professionnel et personnel. Les entreprises investissent de plus en plus dans le bien-être de leurs employés.";
            
            updateProgress();
            updateDots();
            
            alert('🧪 Données d\'exemple chargées ! Vous pouvez maintenant analyser votre Ikigai.');
        }

        function updateTagDisplay(containerId, items, dataKey) {
            const container = document.getElementById(containerId);
            // Garder seulement le champ de saisie
            const input = container.querySelector('.tag-input-field');
            container.innerHTML = '';
            
            // Ajouter les tags
            items.forEach(item => {
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `
                    ${item}
                    <span class="tag-remove" onclick="removeTag('${item}', '${containerId}', '${dataKey}')">×</span>
                `;
                container.appendChild(tag);
            });
            
            // Remettre le champ de saisie
            container.appendChild(input);
        }

        // Génération PDF
        function generateIkigaiPDF() {
            if (!window.jspdf) {
                alert('❌ Erreur : jsPDF non disponible');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configuration
            const margin = 20;
            let y = margin;
            const pageWidth = doc.internal.pageSize.width;
            const pageHeight = doc.internal.pageSize.height;
            
            // Couleurs
            const colors = {
                passion: [255, 107, 107],
                mission: [65, 105, 225],
                profession: [50, 205, 50],
                vocation: [255, 165, 0],
                ikigai: [255, 215, 0]
            };
            
            // En-tête dégradé
            doc.setFillColor(...colors.ikigai);
            doc.rect(0, 0, pageWidth, 60, 'F');
            
            // Titre principal
            doc.setTextColor(51, 51, 51);
            doc.setFontSize(32);
            doc.setFont('helvetica', 'bold');
            doc.text('MON IKIGAI', margin, 30);
            
            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.text('Ma raison d\'être selon la philosophie japonaise', margin, 45);
            doc.text(`Généré le ${new Date().toLocaleDateString('fr-FR')}`, margin, 52);
            
            y = 80;
            
            // Déclaration Ikigai principale
            const ikigaiText = document.getElementById('ikigaiStatement')?.textContent || generateIkigaiStatement();
            
            doc.setFillColor(255, 248, 220);
            doc.rect(margin, y, pageWidth - 2*margin, 45, 'F');
            doc.setDrawColor(...colors.ikigai);
            doc.setLineWidth(3);
            doc.rect(margin, y, pageWidth - 2*margin, 45, 'S');
            
            doc.setTextColor(51, 51, 51);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('🌸 MON IKIGAI', margin + 5, y + 12);
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            const ikigaiLines = doc.splitTextToSize(ikigaiText, pageWidth - 2*margin - 10);
            doc.text(ikigaiLines, margin + 5, y + 25);
            
            y += 60;
            
            // Les 4 sections principales
            const sections = [
                { title: '❤️ CE QUE J\'AIME', items: ikigaiData.passions, color: colors.passion },
                { title: '🎯 CE EN QUOI J\'EXCELLE', items: ikigaiData.talents, color: colors.mission },
                { title: '🌍 CE DONT LE MONDE A BESOIN', items: ikigaiData.problems, color: colors.profession },
                { title: '💰 CE POUR QUOI JE PEUX ÊTRE PAYÉ', items: ikigaiData.skills, color: colors.vocation }
            ];
            
            sections.forEach((section, index) => {
                if (y > pageHeight - 80) {
                    doc.addPage();
                    y = margin;
                }
                
                // En-tête de section
                doc.setFillColor(...section.color);
                doc.rect(margin, y, pageWidth - 2*margin, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text(section.title, margin + 5, y + 10);
                
                y += 20;
                
                // Contenu
                doc.setTextColor(51, 51, 51);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                
                if (section.items.length > 0) {
                    section.items.forEach((item, itemIndex) => {
                        if (itemIndex < 8) { // Limiter à 8 items pour l'espace
                            doc.text(`• ${item}`, margin + 5, y + (itemIndex * 6));
                        }
                    });
                    y += Math.min(section.items.length, 8) * 6 + 10;
                } else {
                    doc.setTextColor(150, 150, 150);
                    doc.text('Aucun élément défini', margin + 5, y);
                    y += 15;
                }
            });
            
            // Recommandations
            if (y > pageHeight - 100) {
                doc.addPage();
                y = margin;
            }
            
            doc.setFillColor(227, 242, 253);
            doc.rect(margin, y, pageWidth - 2*margin, 80, 'F');
            doc.setDrawColor(33, 150, 243);
            doc.setLineWidth(2);
            doc.rect(margin, y, pageWidth - 2*margin, 80, 'S');
            
            doc.setTextColor(25, 118, 210);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('💡 RECOMMANDATIONS', margin + 5, y + 12);
            
            doc.setTextColor(51, 51, 51);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            
            const recommendations = [
                '1. Commencez petit : Lancez un projet pilote qui combine vos passions et talents',
                '2. Développez vos compétences : Investissez dans votre formation continue',
                '3. Créez de la valeur : Trouvez des moyens concrets d\'aider les autres',
                '4. Construisez votre réseau : Connectez-vous avec des personnes alignées',
                '5. Mesurez votre impact : Évaluez régulièrement votre progression',
                '6. Restez flexible : Adaptez votre Ikigai selon votre évolution'
            ];
            
            recommendations.forEach((rec, index) => {
                const recLines = doc.splitTextToSize(rec, pageWidth - 2*margin - 10);
                doc.text(recLines, margin + 5, y + 20 + (index * 10));
            });
            
            // Footer
            const footerY = pageHeight - 15;
            doc.setFillColor(100, 100, 100);
            doc.rect(0, footerY - 5, pageWidth, 20, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text('Générateur d\'Ikigai - Trouvez votre raison d\'être', margin, footerY);
            doc.text('ikigai = 生き甲斐', pageWidth - margin - 30, footerY);
            
            // Sauvegarder
            const fileName = `mon-ikigai-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
            
            alert(`✅ PDF Ikigai généré avec succès : ${fileName}`);
        }

        // Fonctions de sauvegarde et chargement
        function saveProgress() {
            const saveData = {
                ikigaiData: ikigaiData,
                timestamp: new Date().toISOString(),
                version: '2.0.0',
                metadata: {
                    totalItems: Object.values(ikigaiData).reduce((sum, arr) => sum + arr.length, 0),
                    completionLevel: calculateCompletionLevel()
                }
            };
            
            const jsonData = JSON.stringify(saveData, null, 2);
            localStorage.setItem('ikigaiProgress', jsonData);
            
            // Aussi télécharger une copie
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ikigai-sauvegarde-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('✅ Progression sauvegardée avec succès !');
        }

        function loadProgress() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const saveData = JSON.parse(e.target.result);
                        
                        if (saveData.ikigaiData) {
                            ikigaiData = saveData.ikigaiData;
                            
                            // Mettre à jour l'interface
                            Object.keys(ikigaiData).forEach(key => {
                                const container = document.querySelector(`#${key}Container .tags-container`);
                                if (container) {
                                    container.innerHTML = '';
                                    ikigaiData[key].forEach(item => {
                                        const tag = document.createElement('span');
                                        tag.className = 'tag';
                                        tag.innerHTML = `${item} <span class="remove-tag" onclick="removeTag('${item}', '${key}Container', '${key}')">&times;</span>`;
                                        container.appendChild(tag);
                                    });
                                }
                            });
                            
                            updateProgress();
                            updateDots();
                            analyzeCoherence();
                            generateContextualSuggestions();
                            
                            alert(`✅ Données chargées avec succès ! Version: ${saveData.version || 'Inconnue'}`);
                        } else {
                            throw new Error('Format de fichier invalide');
                        }
                    } catch (error) {
                        alert('❌ Erreur lors du chargement du fichier: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function exportToJSON() {
            const exportData = {
                ikigaiData: ikigaiData,
                analysis: {
                    coherence: analyzeCoherence(),
                    completion: calculateCompletionLevel(),
                    recommendations: generateContextualSuggestions()
                },
                timestamp: new Date().toISOString(),
                version: '2.0.0'
            };
            
            const jsonData = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ikigai-export-complet-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('✅ Export JSON créé avec succès !');
        }

        function calculateCompletionLevel() {
            const total = Object.values(ikigaiData).reduce((sum, arr) => sum + arr.length, 0);
            const maxExpected = 20; // 5 éléments par catégorie
            return Math.min((total / maxExpected) * 100, 100);
        }

        // Fonction de diagnostic pour vérifier que tout fonctionne
        function runInterfaceCheck() {
            const checks = {
                'Questions guidées': typeof showGuidedQuestions === 'function',
                'Analyse Ikigai': typeof analyzeIkigai === 'function',
                'Génération PDF': typeof generateIkigaiPDF === 'function',
                'Sauvegarde': typeof saveProgress === 'function',
                'Coach IA': typeof startAICoach === 'function',
                'Analyse comportementale': typeof showBehavioralAnalysis === 'function',
                'Parcours adaptatif': typeof initializeAdaptivePathway === 'function',
                'Métiers recommandés': typeof findCareerMatches === 'function',
                'Évaluation psychologique': typeof startPsychologicalAssessment === 'function',
                'Configuration': typeof openConfigPanel === 'function'
            };

            const allWorking = Object.values(checks).every(check => check);
            
            if (allWorking) {
                console.log('✅ Toutes les fonctionnalités sont correctement chargées');
            } else {
                console.warn('⚠️ Problèmes détectés:', 
                    Object.entries(checks).filter(([name, works]) => !works).map(([name]) => name)
                );
            }

            return checks;
        }

        // Chargement automatique depuis localStorage
        function autoLoadProgress() {
            const savedProgress = localStorage.getItem('ikigaiProgress');
            if (savedProgress) {
                try {
                    const saveData = JSON.parse(savedProgress);
                    if (saveData.ikigaiData && confirm('Des données sauvegardées ont été trouvées. Souhaitez-vous les charger ?')) {
                        ikigaiData = saveData.ikigaiData;
                        
                        // Mettre à jour l'interface
                        Object.keys(ikigaiData).forEach(key => {
                            const container = document.querySelector(`#${key}Container .tags-container`);
                            if (container) {
                                container.innerHTML = '';
                                ikigaiData[key].forEach(item => {
                                    const tag = document.createElement('span');
                                    tag.className = 'tag';
                                    tag.innerHTML = `${item} <span class="remove-tag" onclick="removeTag('${item}', '${key}Container', '${key}')">&times;</span>`;
                                    container.appendChild(tag);
                                });
                            }
                        });
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement automatique:', error);
                }
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            autoLoadProgress();
            updateProgress();
            updateDots();
            analyzeCoherence();
            generateContextualSuggestions();
            
            // Vérifier que toutes les fonctionnalités sont chargées
            setTimeout(runInterfaceCheck, 1000);

            // Rotation des citations de sagesse
            setInterval(() => {
                const randomQuote = wisdomQuotes[Math.floor(Math.random() * wisdomQuotes.length)];
                document.getElementById('wisdomQuote').textContent = randomQuote;
            }, 10000);

            // Mise à jour automatique des analyses toutes les 3 secondes
            setInterval(() => {
                if (ikigaiData.passions.length > 0 || ikigaiData.talents.length > 0 ||
                    ikigaiData.problems.length > 0 || ikigaiData.skills.length > 0) {
                    analyzeCoherence();
                    generateContextualSuggestions();
                }
            }, 3000);

            // Écouteurs d'événements pour les champs de texte
            const textFields = ['passionDescription', 'talentFeedback', 'worldContribution', 'economicOpportunities'];
            textFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', () => {
                        analyzeCoherence();
                        generateContextualSuggestions();
                    });
                }
            });
        });
    </script>
</body>
</html>