<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Maturité Digitale - Formulaire Universel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }

        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .question-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #e3f2fd;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .text-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .textarea {
            min-height: 100px;
            resize: vertical;
        }

        .sector-selection {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sector-selection h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .sector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .sector-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .sector-item:hover {
            border-color: #4caf50;
        }

        .sector-item input[type="radio"] {
            margin-right: 10px;
        }

        .api-config {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .api-config h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .api-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .api-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .api-item:hover {
            border-color: #f39c12;
        }

        .api-item input[type="radio"] {
            margin-right: 10px;
        }

        .generate-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.6);
        }

        .generate-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .utility-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .utility-btn {
            background: #95a5a6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .utility-btn:hover {
            background: #7f8c8d;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .report-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .chart-wrapper {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .report-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .score-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            flex: 1;
            min-width: 120px;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .api-help {
            font-size: 0.85em;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .sector-grid, .api-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Audit Maturité Digitale</h1>
            <p>Évaluation universelle de la transformation numérique - Tous secteurs d'activité</p>
        </div>

        <!-- Configuration API -->
        <div class="api-config">
            <h3>Configuration API</h3>
            
            <div class="api-selection">
                <label class="api-item">
                    <input type="radio" name="api_provider" value="anthropic" checked> Claude (Anthropic)
                </label>
                <label class="api-item">
                    <input type="radio" name="api_provider" value="openai"> GPT (OpenAI)
                </label>
                <label class="api-item">
                    <input type="radio" name="api_provider" value="gemini"> Gemini (Google)
                </label>
                <label class="api-item">
                    <input type="radio" name="api_provider" value="grok"> Grok (xAI)
                </label>
            </div>

            <div style="position: relative;">
                <input type="password" id="apiKey" class="text-input" placeholder="Clé API" style="margin-bottom: 10px; padding-right: 120px;">
                <button id="saveApiKeyBtn" onclick="saveApiKey()" class="utility-btn" style="position: absolute; right: 5px; top: 5px; background: #27ae60; padding: 5px 10px; font-size: 0.8em;">💾 Sauver</button>
            </div>
            
            <div class="api-help" id="apiHelp">
                <strong>Claude (Anthropic):</strong> Clé format "sk-ant-..." - Recommandé pour l'analyse business<br>
                <strong>Endpoint:</strong> https://api.anthropic.com/v1/messages
            </div>
            
            <div style="font-size: 0.9em; color: #856404; margin-top: 10px;">
                <p id="apiSecurityInfo">🔒 Clé API sauvegardée localement dans votre navigateur - <button onclick="clearSavedApiKey()" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 3px; font-size: 0.8em; cursor: pointer;">Effacer</button></p>
            </div>
        </div>

        <!-- Sélection du secteur -->
        <div class="sector-selection">
            <h3>Secteur d'activité de l'entreprise</h3>
            <div class="sector-grid">
                <label class="sector-item">
                    <input type="radio" name="sector" value="industrie"> Industrie & Manufacturing
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="btp"> BTP & Construction
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="services"> Services & Conseil
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="commerce"> Commerce & Distribution
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="sante"> Santé & Médical
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="education"> Éducation & Formation
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="transport"> Transport & Logistique
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="agriculture"> Agriculture & Agroalimentaire
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="finance"> Finance & Banque
                </label>
                <label class="sector-item">
                    <input type="radio" name="sector" value="autre"> Autre secteur
                </label>
            </div>
            <input type="text" id="sector_custom" class="text-input" placeholder="Précisez le secteur si 'Autre'" style="display: none;">
        </div>

        <!-- Informations générales -->
        <div class="form-section">
            <h2 class="section-title">Informations Générales</h2>
            
            <div class="question-group">
                <div class="question-title">Entreprise auditée</div>
                <input type="text" id="company_name" class="text-input" placeholder="Nom de l'entreprise">
                <input type="text" id="contact_name" class="text-input" placeholder="Nom du contact principal">
                <input type="text" id="contact_role" class="text-input" placeholder="Fonction du contact">
                <input type="text" id="audit_date" class="text-input" type="date">
                <input type="number" id="employee_count" class="text-input" placeholder="Nombre d'employés">
            </div>

            <div class="question-group">
                <div class="question-title">Contexte de l'entreprise</div>
                <textarea id="company_context" class="text-input textarea" placeholder="Décrivez brièvement l'activité, les produits/services, les spécificités de l'entreprise..."></textarea>
            </div>
        </div>

        <!-- Processus Commercial & Marketing -->
        <div class="form-section">
            <h2 class="section-title">Commercial & Marketing</h2>
            
            <div class="question-group">
                <div class="question-title">Gestion clients et prospects</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="crm_structure"> CRM ou base clients structurée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="prospection_digitale"> Prospection digitale (emails, réseaux sociaux)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="site_web_pro"> Site web professionnel et optimisé
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="reseaux_sociaux"> Présence active sur réseaux sociaux
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="marketing_automation"> Marketing automation/email campaigns
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="commercial" value="analytics"> Analytics et mesure de performance
                    </label>
                </div>
                <textarea id="commercial_notes" class="text-input textarea" placeholder="Observations spécifiques sur les processus commerciaux et marketing..."></textarea>
            </div>

            <div class="question-group">
                <div class="question-title">Processus de vente et devis</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="vente" value="logiciel_devis"> Logiciel de devis/facturation dédié
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vente" value="configurateur"> Configurateur produits/services en ligne
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vente" value="signature_electronique"> Signature électronique des contrats
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vente" value="suivi_pipeline"> Suivi pipeline commercial structuré
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="vente" value="reporting_commercial"> Reporting commercial automatisé
                    </label>
                </div>
                <textarea id="vente_notes" class="text-input textarea" placeholder="Processus de vente, outils utilisés, temps de traitement..."></textarea>
            </div>
        </div>

        <!-- Production & Opérations -->
        <div class="form-section">
            <h2 class="section-title">Production & Opérations</h2>
            
            <div class="question-group">
                <div class="question-title">Planification et suivi</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="planning_digital"> Planning de production digital
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="suivi_temps_reel"> Suivi de production en temps réel
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="gestion_priorites"> Gestion automatisée des priorités
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="kpi_dashboards"> Tableaux de bord KPI en temps réel
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="maintenance_predictive"> Maintenance prédictive/préventive
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="production" value="iot_capteurs"> IoT et capteurs connectés
                    </label>
                </div>
                <textarea id="production_notes" class="text-input textarea" placeholder="Méthodes actuelles de planification et suivi opérationnel..."></textarea>
            </div>

            <div class="question-group">
                <div class="question-title">Gestion des ressources</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="ressources" value="gestion_stocks"> Gestion informatisée des stocks
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="ressources" value="codes_barres"> Codes-barres ou puces RFID
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="ressources" value="approvisionnement_auto"> Approvisionnement automatisé
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="ressources" value="tracabilite"> Traçabilité complète des produits
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="ressources" value="integration_fournisseurs"> Intégration EDI fournisseurs
                    </label>
                </div>
            </div>
        </div>

        <!-- Service Client & Support -->
        <div class="form-section">
            <h2 class="section-title">Service Client & Support</h2>
            
            <div class="question-group">
                <div class="question-title">Gestion de la relation client</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="helpdesk"> Système de helpdesk/ticketing
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="portail_client"> Portail client en ligne
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="chat_support"> Chat en ligne ou chatbot
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="knowledge_base"> Base de connaissances/FAQ
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="satisfaction_mesure"> Mesure satisfaction client automatisée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="service_client" value="multi_canal"> Support multi-canal intégré
                    </label>
                </div>
                <textarea id="service_notes" class="text-input textarea" placeholder="Organisation du support client, outils et processus..."></textarea>
            </div>
        </div>

        <!-- Ressources Humaines -->
        <div class="form-section">
            <h2 class="section-title">Ressources Humaines</h2>
            
            <div class="question-group">
                <div class="question-title">Gestion RH et collaboration</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="sirh"> SIRH (Système d'Information RH)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="planning_equipes"> Planning équipes digitalisé
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="formation_elearning"> Formation e-learning/LMS
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="evaluation_performance"> Évaluation performance digitalisée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="collaboration_tools"> Outils de collaboration (Teams, Slack...)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="rh" value="teletravail"> Infrastructures télétravail
                    </label>
                </div>
                <textarea id="rh_notes" class="text-input textarea" placeholder="Organisation RH, niveau de digitalisation, besoins identifiés..."></textarea>
            </div>
        </div>

        <!-- Finance & Administration -->
        <div class="form-section">
            <h2 class="section-title">Finance & Administration</h2>
            
            <div class="question-group">
                <div class="question-title">Gestion financière et administrative</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="erp_integre"> ERP intégré complet
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="facturation_electronique"> Facturation électronique
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="tresorerie_temps_reel"> Suivi trésorerie temps réel
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="dematerialisation"> Dématérialisation administrative
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="reporting_financier"> Reporting financier automatisé
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="finance" value="conformite_auto"> Conformité réglementaire automatisée
                    </label>
                </div>
                <textarea id="finance_notes" class="text-input textarea" placeholder="Logiciels financiers, processus administratifs, niveau d'automatisation..."></textarea>
            </div>
        </div>

        <!-- Infrastructure & Sécurité -->
        <div class="form-section">
            <h2 class="section-title">Infrastructure & Sécurité</h2>
            
            <div class="question-group">
                <div class="question-title">Infrastructure technique</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="infrastructure" value="cloud_adoption"> Adoption du cloud
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="infrastructure" value="parc_moderne"> Parc informatique moderne
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="infrastructure" value="reseau_performant"> Infrastructure réseau performante
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="infrastructure" value="mobilite"> Solutions de mobilité
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="infrastructure" value="integration_api"> Intégrations API
                    </label>
                </div>
            </div>

            <div class="question-group">
                <div class="question-title">Sécurité et gouvernance</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="securite" value="cybersecurite"> Stratégie cybersécurité avancée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="securite" value="sauvegarde_auto"> Sauvegarde automatisée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="securite" value="rgpd_compliance"> Conformité RGPD
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="securite" value="plan_continuite"> Plan de continuité d'activité
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="securite" value="formation_securite"> Formation sécurité des utilisateurs
                    </label>
                </div>
                <textarea id="infrastructure_notes" class="text-input textarea" placeholder="État de l'infrastructure, politique de sécurité, support IT..."></textarea>
            </div>
        </div>

        <!-- Innovation & Data -->
        <div class="form-section">
            <h2 class="section-title">Innovation & Data</h2>
            
            <div class="question-group">
                <div class="question-title">Exploitation des données</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="data" value="data_strategy"> Stratégie data définie
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="data" value="business_intelligence"> Business Intelligence/BI
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="data" value="data_analytics"> Analytics avancés
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="data" value="ia_machine_learning"> IA/Machine Learning
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="data" value="data_governance"> Gouvernance des données
                    </label>
                </div>
            </div>

            <div class="question-group">
                <div class="question-title">Innovation et transformation</div>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="innovation" value="veille_techno"> Veille technologique organisée
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="innovation" value="r_et_d_digitale"> R&D digitale
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="innovation" value="partenariats_tech"> Partenariats technologiques
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="innovation" value="roadmap_digitale"> Roadmap transformation digitale
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="innovation" value="culture_innovation"> Culture d'innovation
                    </label>
                </div>
                <textarea id="innovation_notes" class="text-input textarea" placeholder="Initiatives d'innovation, projets technologiques, vision future..."></textarea>
            </div>
        </div>

        <!-- Synthèse -->
        <div class="form-section">
            <h2 class="section-title">Synthèse & Priorités</h2>
            
            <div class="question-group">
                <div class="question-title">Points de douleur identifiés</div>
                <textarea id="pain_points" class="text-input textarea" placeholder="Quels sont les principaux points de douleur exprimés par l'entreprise ?"></textarea>
            </div>

            <div class="question-group">
                <div class="question-title">Ambitions et contraintes</div>
                <textarea id="ambitions" class="text-input textarea" placeholder="Projets de croissance, contraintes budgétaires, appétence au changement..."></textarea>
            </div>

            <div class="question-group">
                <div class="question-title">Budget approximatif pour la digitalisation</div>
                <select id="budget_range" class="text-input">
                    <option value="">-- Sélectionner une fourchette --</option>
                    <option value="0-10k">0 - 10 000 €</option>
                    <option value="10k-25k">10 000 - 25 000 €</option>
                    <option value="25k-50k">25 000 - 50 000 €</option>
                    <option value="50k-100k">50 000 - 100 000 €</option>
                    <option value="100k-250k">100 000 - 250 000 €</option>
                    <option value="250k+">Plus de 250 000 €</option>
                </select>
            </div>

            <div class="question-group">
                <div class="question-title">Niveau d'urgence de la transformation</div>
                <select id="urgency" class="text-input">
                    <option value="">-- Sélectionner --</option>
                    <option value="critique">Critique - Besoin immédiat</option>
                    <option value="urgent">Urgent - Dans les 6 mois</option>
                    <option value="important">Important - Dans l'année</option>
                    <option value="planifie">Planifié - 1 à 2 ans</option>
                    <option value="reflexion">En réflexion - Pas de timeline</option>
                </select>
            </div>
        </div>

        <div class="utility-buttons">
            <button class="utility-btn" onclick="loadDemoData()" style="background: #e74c3c; color: white;">🎯 Démo</button>
            <button class="utility-btn" onclick="resetForm()">Réinitialiser</button>
            <button class="utility-btn" onclick="saveProgress()">Sauvegarder</button>
            <button class="utility-btn" onclick="loadProgress()">Charger</button>
        </div>

        <button id="generateReport" class="generate-btn">
            Générer le Rapport de Maturité Digitale
        </button>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Analyse en cours et génération du rapport personnalisé...</p>
        </div>

        <!-- Section Rapport -->
        <div id="reportSection" class="report-section">
            <h2 class="section-title">Rapport de Maturité Digitale</h2>
            
            <div class="score-indicator" id="globalScores">
                <!-- Scores globaux générés dynamiquement -->
            </div>

            <div class="chart-container">
                <div class="chart-wrapper">
                    <h3>Radar de Maturité par Domaine</h3>
                    <canvas id="radarChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <h3>Répartition des Scores</h3>
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <div class="report-content" id="reportContent">
                <!-- Contenu du rapport généré par l'IA -->
            </div>

            <div class="utility-buttons">
                <button class="utility-btn" onclick="exportToPDF()">Exporter PDF</button>
                <button class="utility-btn" onclick="shareReport()">Partager</button>
                <button class="utility-btn" onclick="showUsageStats()">📊 Statistiques</button>
                <button class="utility-btn" onclick="newAudit()">Nouvel Audit</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration et variables globales
        let radarChart = null;
        let barChart = null;

        function loadDemoData() {
            if (!confirm('Cette action va remplir le formulaire avec des données de démonstration.\n\nVoulez-vous continuer ?')) {
                return;
            }

            // Informations générales
            document.getElementById('company_name').value = 'TechSolutions SARL';
            document.getElementById('contact_name').value = 'Marie Dupont';
            document.getElementById('contact_role').value = 'Directrice Générale';
            document.getElementById('audit_date').value = new Date().toISOString().split('T')[0];
            document.getElementById('employee_count').value = '45';
            document.getElementById('company_context').value = 'TechSolutions est une entreprise de services informatiques spécialisée dans le développement d\'applications web et mobiles. Créée il y a 8 ans, elle compte 45 employés et réalise un chiffre d\'affaires de 4,2M€. L\'entreprise opère principalement en France avec quelques clients internationaux.';

            // Sélection secteur
            document.querySelector('input[name="sector"][value="services"]').checked = true;

            // Configuration API (optionnelle pour la démo)
            document.querySelector('input[name="api_provider"][value="anthropic"]').checked = true;

            // Commercial & Marketing
            document.querySelector('input[name="commercial"][value="crm_structure"]').checked = true;
            document.querySelector('input[name="commercial"][value="site_web_pro"]').checked = true;
            document.querySelector('input[name="commercial"][value="marketing_automation"]').checked = true;
            document.querySelector('input[name="commercial"][value="analytics"]').checked = true;
            document.getElementById('commercial_notes').value = 'L\'entreprise utilise un CRM basique et a un site web professionnel. Cependant, les processus de marketing automation et d\'analytics sont encore limités.';

            // Vente
            document.querySelector('input[name="vente"][value="logiciel_devis"]').checked = true;
            document.querySelector('input[name="vente"][value="signature_electronique"]').checked = true;
            document.querySelector('input[name="vente"][value="suivi_pipeline"]').checked = true;
            document.getElementById('vente_notes').value = 'Processus de vente structuré avec devis automatisés et signature électronique. Le suivi du pipeline commercial pourrait être amélioré.';

            // Production & Opérations
            document.querySelector('input[name="production"][value="planning_digital"]').checked = true;
            document.querySelector('input[name="production"][value="suivi_temps_reel"]').checked = true;
            document.querySelector('input[name="production"][value="gestion_priorites"]').checked = true;
            document.querySelector('input[name="production"][value="kpi_dashboards"]').checked = true;
            document.querySelector('input[name="ressources"][value="gestion_stocks"]').checked = true;
            document.querySelector('input[name="ressources"][value="codes_barres"]').checked = true;
            document.getElementById('production_notes').value = 'L\'équipe utilise des outils de gestion de projet modernes mais la planification opérationnelle pourrait être optimisée avec des tableaux de bord plus avancés.';

            // Service Client
            document.querySelector('input[name="service_client"][value="helpdesk"]').checked = true;
            document.querySelector('input[name="service_client"][value="portail_client"]').checked = true;
            document.querySelector('input[name="service_client"][value="chat_support"]').checked = true;
            document.querySelector('input[name="service_client"][value="knowledge_base"]').checked = true;
            document.getElementById('service_notes').value = 'Support client organisé avec helpdesk et portail client. L\'expérience pourrait être enrichie avec un chatbot et une base de connaissances plus complète.';

            // RH
            document.querySelector('input[name="rh"][value="sirh"]').checked = true;
            document.querySelector('input[name="rh"][value="planning_equipes"]').checked = true;
            document.querySelector('input[name="rh"][value="formation_elearning"]').checked = true;
            document.querySelector('input[name="rh"][value="collaboration_tools"]').checked = true;
            document.getElementById('rh_notes').value = 'SIRH en place avec planning digital et outils collaboratifs. La formation e-learning est utilisée mais pourrait être étendue.';

            // Finance & Admin
            document.querySelector('input[name="finance"][value="erp_integre"]').checked = true;
            document.querySelector('input[name="finance"][value="facturation_electronique"]').checked = true;
            document.querySelector('input[name="finance"][value="reporting_financier"]').checked = true;
            document.querySelector('input[name="finance"][value="dematerialisation"]').checked = true;
            document.getElementById('finance_notes').value = 'ERP intégré avec facturation électronique et dématérialisation administrative. Le reporting financier est automatisé.';

            // Infrastructure
            document.querySelector('input[name="infrastructure"][value="cloud_adoption"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="parc_moderne"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="reseau_performant"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="integration_api"]').checked = true;
            document.querySelector('input[name="securite"][value="cybersecurite"]').checked = true;
            document.querySelector('input[name="securite"][value="sauvegarde_auto"]').checked = true;
            document.querySelector('input[name="securite"][value="rgpd_compliance"]').checked = true;
            document.getElementById('infrastructure_notes').value = 'Infrastructure cloud moderne avec sécurité avancée. Bonne conformité RGPD et sauvegardes automatiques.';

            // Innovation & Data
            document.querySelector('input[name="data"][value="business_intelligence"]').checked = true;
            document.querySelector('input[name="data"][value="data_analytics"]').checked = true;
            document.querySelector('input[name="data"][value="data_governance"]').checked = true;
            document.querySelector('input[name="innovation"][value="veille_techno"]').checked = true;
            document.querySelector('input[name="innovation"][value="roadmap_digitale"]').checked = true;
            document.getElementById('innovation_notes').value = 'Business Intelligence en place avec analytics avancés. Veille technologique organisée et roadmap digitale définie.';

            // Synthèse
            document.getElementById('pain_points').value = 'Difficultés de recrutement de profils techniques, concurrence accrue sur le marché, besoin d\'accélérer la transformation digitale pour rester compétitif.';
            document.getElementById('ambitions').value = 'Croissance de 30% en 2 ans, diversification vers de nouveaux secteurs, amélioration de la productivité de 25%, développement de l\'innovation produit.';
            document.getElementById('budget_range').value = '50k-100k';
            document.getElementById('urgency').value = 'important';

            // Sauvegarde automatique
            saveProgress();

            alert('✅ Données de démonstration chargées !\n\nVous pouvez maintenant générer le rapport pour voir le résultat.');
        }

        // Configuration API dynamique
        const apiConfigs = {
            anthropic: {
                name: 'Claude (Anthropic)',
                placeholder: 'Clé format sk-ant-...',
                endpoint: 'https://api.anthropic.com/v1/messages',
                help: 'Claude (Anthropic): Clé format "sk-ant-..." - Recommandé pour l\'analyse business<br>Endpoint: https://api.anthropic.com/v1/messages'
            },
            openai: {
                name: 'GPT (OpenAI)',
                placeholder: 'Clé format sk-...',
                endpoint: 'https://api.openai.com/v1/chat/completions',
                help: 'GPT (OpenAI): Clé format "sk-..." - Excellent pour l\'analyse générale<br>Endpoint: https://api.openai.com/v1/chat/completions'
            },
            gemini: {
                name: 'Gemini (Google)',
                placeholder: 'Clé API Google AI',
                endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
                help: 'Gemini (Google): Clé API Google AI - Bon pour l\'analyse multimodale<br>Endpoint: https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent'
            },
            grok: {
                name: 'Grok (xAI)',
                placeholder: 'Clé API xAI',
                endpoint: 'https://api.x.ai/v1/chat/completions',
                help: 'Grok (xAI): Clé API xAI - Approche directe et sans détours<br>Endpoint: https://api.x.ai/v1/chat/completions'
            }
        };

        // Fonctions de gestion des clés API
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            const provider = document.querySelector('input[name="api_provider"]:checked').value;

            if (!apiKey.trim()) {
                alert('Veuillez saisir une clé API avant de sauvegarder.');
                return;
            }

            const apiData = {
                key: apiKey,
                provider: provider,
                timestamp: Date.now()
            };

            localStorage.setItem('saved_api_key', JSON.stringify(apiData));
            updateApiSecurityInfo(true);

            // Animation de confirmation
            const saveBtn = document.getElementById('saveApiKeyBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '✓ Sauvegardé';
            saveBtn.style.background = '#27ae60';

            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = '#27ae60';
            }, 2000);
        }

        function loadSavedApiKey() {
            const saved = localStorage.getItem('saved_api_key');
            if (saved) {
                try {
                    const apiData = JSON.parse(saved);
                    document.getElementById('apiKey').value = apiData.key;

                    // Restaurer le provider sélectionné
                    const providerRadio = document.querySelector(`input[name="api_provider"][value="${apiData.provider}"]`);
                    if (providerRadio) {
                        providerRadio.checked = true;
                        updateApiConfig();
                    }

                    updateApiSecurityInfo(true);
                } catch (e) {
                    console.error('Erreur lors de la restauration de la clé API:', e);
                    localStorage.removeItem('saved_api_key');
                }
            } else {
                updateApiSecurityInfo(false);
            }
        }

        function clearSavedApiKey() {
            if (confirm('Voulez-vous effacer la clé API sauvegardée ?\n\nVous devrez la ressaisir lors de votre prochaine visite.')) {
                localStorage.removeItem('saved_api_key');
                document.getElementById('apiKey').value = '';
                updateApiSecurityInfo(false);
                alert('Clé API effacée.');
            }
        }

        function updateApiSecurityInfo(isSaved) {
            const infoElement = document.getElementById('apiSecurityInfo');
            if (isSaved) {
                infoElement.innerHTML = '🔒 Clé API sauvegardée localement dans votre navigateur - <button onclick="clearSavedApiKey()" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 3px; font-size: 0.8em; cursor: pointer;">Effacer</button>';
            } else {
                infoElement.innerHTML = '🔓 Clé API non sauvegardée - Cliquez sur "Sauver" pour la mémoriser';
            }
        }

        // Gestion changement d'API
        document.addEventListener('DOMContentLoaded', function() {
            const apiRadios = document.querySelectorAll('input[name="api_provider"]');
            const apiKeyInput = document.getElementById('apiKey');
            const apiHelp = document.getElementById('apiHelp');

            function updateApiConfig() {
                const selected = document.querySelector('input[name="api_provider"]:checked').value;
                const config = apiConfigs[selected];

                apiKeyInput.placeholder = config.placeholder;
                apiHelp.innerHTML = config.help;
            }

            // Charger la clé API sauvegardée au chargement de la page
            loadSavedApiKey();

            apiRadios.forEach(radio => {
                radio.addEventListener('change', updateApiConfig);
            });

            // Sauvegarder automatiquement quand on tape dans le champ (avec délai)
            let saveTimeout;
            apiKeyInput.addEventListener('input', function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    if (apiKeyInput.value.trim().length > 10) { // Seulement si ça ressemble à une vraie clé
                        const currentSaved = localStorage.getItem('saved_api_key');
                        if (currentSaved) {
                            // Mise à jour automatique si déjà une clé sauvegardée
                            saveApiKey();
                        }
                    }
                }, 1500); // Attendre 1.5 secondes après la dernière frappe
            });

            // Gestion secteur personnalisé
            const sectorRadios = document.querySelectorAll('input[name="sector"]');
            const customSectorInput = document.getElementById('sector_custom');

            sectorRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'autre') {
                        customSectorInput.style.display = 'block';
                        customSectorInput.required = true;
                    } else {
                        customSectorInput.style.display = 'none';
                        customSectorInput.required = false;
                        customSectorInput.value = '';
                    }
                });
            });

            // Date par défaut
            document.getElementById('audit_date').value = new Date().toISOString().split('T')[0];

            // Event listener pour le bouton de génération
            document.getElementById('generateReport').addEventListener('click', generateReport);
        });

        // Collecte des données du formulaire
        function collectFormData() {
            const selectedSector = document.querySelector('input[name="sector"]:checked');
            const sector = selectedSector ? 
                (selectedSector.value === 'autre' ? document.getElementById('sector_custom').value : selectedSector.value) 
                : '';

            const data = {
                api_provider: document.querySelector('input[name="api_provider"]:checked').value,
                company_info: {
                    name: document.getElementById('company_name').value,
                    contact: document.getElementById('contact_name').value,
                    role: document.getElementById('contact_role').value,
                    date: document.getElementById('audit_date').value,
                    employees: document.getElementById('employee_count').value,
                    sector: sector,
                    context: document.getElementById('company_context').value
                },
                scores: {},
                notes: {},
                pain_points: document.getElementById('pain_points').value,
                ambitions: document.getElementById('ambitions').value,
                budget_range: document.getElementById('budget_range').value,
                urgency: document.getElementById('urgency').value
            };

            // Collecte des cases cochées par catégorie
            const categories = [
                'commercial', 'vente', 'production', 'ressources', 'service_client', 
                'rh', 'finance', 'infrastructure', 'securite', 'data', 'innovation'
            ];
            
            categories.forEach(category => {
                const checkboxes = document.querySelectorAll(`input[name="${category}"]:checked`);
                data.scores[category] = Array.from(checkboxes).map(cb => cb.value);
            });

            // Collecte des notes textuelles
            const noteFields = [
                'commercial_notes', 'vente_notes', 'production_notes', 'service_notes',
                'rh_notes', 'finance_notes', 'infrastructure_notes', 'innovation_notes'
            ];
            
            noteFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    data.notes[field] = element.value;
                }
            });

            return data;
        }

        // Calcul des scores de maturité
        function calculateMaturityScores(data) {
            const domainMapping = {
                'Commercial & Marketing': ['commercial', 'vente'],
                'Production & Opérations': ['production', 'ressources'],
                'Service Client': ['service_client'],
                'Ressources Humaines': ['rh'],
                'Finance & Administration': ['finance'],
                'Infrastructure': ['infrastructure', 'securite'],
                'Innovation & Data': ['data', 'innovation']
            };

            const maxScoresByCategory = {
                commercial: 6, vente: 5, production: 6, ressources: 5,
                service_client: 6, rh: 6, finance: 6,
                infrastructure: 5, securite: 5, data: 5, innovation: 5
            };

            const scores = {};
            let globalScore = 0;
            let totalPossible = 0;

            Object.keys(domainMapping).forEach(domain => {
                let domainScore = 0;
                let domainMax = 0;

                domainMapping[domain].forEach(category => {
                    const categoryScore = data.scores[category] ? data.scores[category].length : 0;
                    const categoryMax = maxScoresByCategory[category];
                    
                    domainScore += categoryScore;
                    domainMax += categoryMax;
                });

                scores[domain] = Math.round((domainScore / domainMax) * 100);
                globalScore += domainScore;
                totalPossible += domainMax;
            });

            scores['Global'] = Math.round((globalScore / totalPossible) * 100);
            return scores;
        }

        // Appel API multi-provider
        async function generateAIAnalysis(data, scores) {
            const apiKey = document.getElementById('apiKey').value;
            const provider = data.api_provider;
            
            if (!apiKey) {
                throw new Error('Clé API requise');
            }

            const sectorContext = getSectorContext(data.company_info.sector);
            const prompt = createPrompt(data, scores, sectorContext);

            try {
                switch (provider) {
                    case 'anthropic':
                        return await callAnthropicAPI(apiKey, prompt);
                    case 'openai':
                        return await callOpenAIAPI(apiKey, prompt);
                    case 'gemini':
                        return await callGeminiAPI(apiKey, prompt);
                    case 'grok':
                        return await callGrokAPI(apiKey, prompt);
                    default:
                        throw new Error('Provider non supporté');
                }
            } catch (error) {
                console.error('Erreur API:', error);
                throw error;
            }
        }

        function createPrompt(data, scores, sectorContext) {
            return `Tu es un consultant en transformation digitale expert tous secteurs. 

Voici les résultats d'un audit de maturité digitale pour l'entreprise ${data.company_info.name} :

INFORMATIONS ENTREPRISE :
- Secteur : ${data.company_info.sector}
- Taille : ${data.company_info.employees} employés
- Contact : ${data.company_info.contact} (${data.company_info.role})
- Contexte : ${data.company_info.context}

CONTEXTE SECTORIEL :
${sectorContext}

SCORES DE MATURITÉ :
${Object.entries(scores).map(([domain, score]) => `- ${domain}: ${score}%`).join('\n')}

POINTS DE DOULEUR :
${data.pain_points}

AMBITIONS ET CONTRAINTES :
${data.ambitions}

BUDGET : ${data.budget_range}
URGENCE : ${data.urgency}

Génère un rapport professionnel structuré avec :

1. EXECUTIVE SUMMARY (3-4 phrases)
   - Niveau de maturité global et positionnement sectoriel
   - Enjeux clés identifiés

2. ANALYSE DÉTAILLÉE PAR DOMAINE
   Pour chaque domaine avec score < 70% :
   - Diagnostic de l'existant
   - Écarts par rapport aux meilleures pratiques sectorielles
   - Impacts business quantifiés

3. RECOMMANDATIONS PRIORISÉES
   - Quick wins (3-6 mois, ROI rapide)
   - Projets structurants (6-18 mois, transformation)
   - Vision long terme (18+ mois, innovation)

4. ROADMAP DÉTAILLÉE
   - Phasage avec jalons clés
   - Estimation budgétaire par phase
   - Ressources nécessaires

5. PROCHAINES ÉTAPES
   - Actions immédiates à entreprendre
   - Décisions à prendre
   - Planning de mise en œuvre

Adapte le vocabulaire et les recommandations au secteur spécifique. Reste pragmatique et actionnable.`;
        }

        async function callAnthropicAPI(apiKey, prompt) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-sonnet-20240229',
                    max_tokens: 4000,
                    messages: [{ role: 'user', content: prompt }]
                })
            });

            if (!response.ok) throw new Error(`Erreur API Anthropic: ${response.status}`);
            const result = await response.json();
            return result.content[0].text;
        }

        async function callOpenAIAPI(apiKey, prompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4-turbo-preview',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 4000
                })
            });

            if (!response.ok) throw new Error(`Erreur API OpenAI: ${response.status}`);
            const result = await response.json();
            return result.choices[0].message.content;
        }

        async function callGeminiAPI(apiKey, prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });

            if (!response.ok) throw new Error(`Erreur API Gemini: ${response.status}`);
            const result = await response.json();
            return result.candidates[0].content.parts[0].text;
        }

        async function callGrokAPI(apiKey, prompt) {
            const response = await fetch('https://api.x.ai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'grok-beta',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 4000
                })
            });

            if (!response.ok) throw new Error(`Erreur API Grok: ${response.status}`);
            const result = await response.json();
            return result.choices[0].message.content;
        }

        function getSectorContext(sector) {
            const contexts = {
                'industrie': 'Secteur industriel : Focus sur l\'automatisation, IoT, maintenance prédictive, ERP intégré, gestion de production.',
                'btp': 'Secteur BTP : Enjeux mobilité, gestion de chantiers, planification, sécurité, relation clients projets.',
                'services': 'Secteur services : Focus CRM, facturation temps, gestion projets, collaboration, expertise.',
                'commerce': 'Commerce/Distribution : E-commerce, omnicanalité, gestion stocks, logistique, expérience client.',
                'sante': 'Secteur santé : Conformité réglementaire, dossiers patients, télémédecine, sécurité données.',
                'education': 'Éducation/Formation : LMS, e-learning, gestion étudiants, outils pédagogiques numériques.',
                'transport': 'Transport/Logistique : Traçabilité, optimisation tournées, gestion flottes, supply chain.',
                'agriculture': 'Agriculture : Precision farming, IoT, traçabilité, gestion exploitations, circuits courts.',
                'finance': 'Finance/Banque : Conformité, sécurité renforcée, digitalisation parcours client, fintech.'
            };
            return contexts[sector] || 'Secteur spécifique : Analyse adaptée aux particularités métier.';
        }

        function generateBasicReport(data, scores) {
            const sector = data.company_info.sector;
            const globalScore = scores['Global'];
            const domains = Object.keys(scores).filter(domain => domain !== 'Global');

            // Déterminer le niveau de maturité
            let maturityLevel, maturityDescription;
            if (globalScore >= 80) {
                maturityLevel = 'Avancée';
                maturityDescription = 'L\'entreprise dispose d\'une maturité digitale élevée avec des processus largement automatisés.';
            } else if (globalScore >= 60) {
                maturityLevel = 'Intermédiaire';
                maturityDescription = 'L\'entreprise a amorcé sa transformation digitale mais des améliorations significatives sont possibles.';
            } else if (globalScore >= 40) {
                maturityLevel = 'Basique';
                maturityDescription = 'L\'entreprise utilise des outils digitaux de base mais manque de vision d\'ensemble et d\'intégration.';
            } else {
                maturityLevel = 'Émergente';
                maturityDescription = 'L\'entreprise débute sa transformation digitale avec de nombreuses opportunités d\'amélioration.';
            }

            // Identifier les domaines forts et faibles
            const sortedDomains = domains.sort((a, b) => scores[b] - scores[a]);
            const topDomains = sortedDomains.slice(0, 2);
            const weakDomains = sortedDomains.slice(-2);

            // Générer les recommandations sectorielles
            const sectorRecommendations = getSectorRecommendations(sector, scores);
            const priorityRecommendations = getPriorityRecommendations(data, scores);

            return `
                <div style="line-height: 1.8; font-size: 14px;">
                    <h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                        RAPPORT D'AUDIT - ${data.company_info.name.toUpperCase()}
                    </h2>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="color: #3498db; margin-bottom: 15px;">📊 SYNTHÈSE EXÉCUTIVE</h3>
                        <p><strong>Niveau de maturité :</strong> ${maturityLevel} (${globalScore}%)</p>
                        <p><strong>Secteur d'activité :</strong> ${getSectorLabel(sector)}</p>
                        <p><strong>Taille :</strong> ${data.company_info.employees} employés</p>
                        <br>
                        <p>${maturityDescription}</p>
                        ${data.pain_points ? `<p><strong>Points de douleur identifiés :</strong> ${data.pain_points}</p>` : ''}
                    </div>

                    <h3 style="color: #3498db; margin: 25px 0 15px 0;">🎯 ANALYSE PAR DOMAINE</h3>

                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="color: #27ae60; margin-bottom: 10px;">✅ POINTS FORTS</h4>
                        ${topDomains.map(domain => `
                            <p><strong>${domain} (${scores[domain]}%)</strong> - ${getDomainAnalysis(domain, scores[domain], 'strong')}</p>
                        `).join('')}
                    </div>

                    <div style="background: #fef9e7; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="color: #f39c12; margin-bottom: 10px;">⚠️ AXES D'AMÉLIORATION</h4>
                        ${weakDomains.map(domain => `
                            <p><strong>${domain} (${scores[domain]}%)</strong> - ${getDomainAnalysis(domain, scores[domain], 'weak')}</p>
                        `).join('')}
                    </div>

                    <h3 style="color: #3498db; margin: 25px 0 15px 0;">🚀 RECOMMANDATIONS PRIORITAIRES</h3>

                    <div style="background: #fff; border-left: 4px solid #3498db; padding: 20px; margin: 15px 0;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">QUICK WINS (3-6 mois)</h4>
                        ${priorityRecommendations.quickWins.map(rec => `<p>• ${rec}</p>`).join('')}
                    </div>

                    <div style="background: #fff; border-left: 4px solid #e74c3c; padding: 20px; margin: 15px 0;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">PROJETS STRUCTURANTS (6-18 mois)</h4>
                        ${priorityRecommendations.structural.map(rec => `<p>• ${rec}</p>`).join('')}
                    </div>

                    <h4 style="color: #3498db; margin: 25px 0 15px 0;">📋 RECOMMANDATIONS SECTORIELLES</h4>
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px;">
                        ${sectorRecommendations.map(rec => `<p>• ${rec}</p>`).join('')}
                    </div>

                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 25px 0;">
                        <h4 style="color: #856404; margin-bottom: 10px;">⚡ PROCHAINES ÉTAPES</h4>
                        <p>1. <strong>Prioriser</strong> les quick wins selon votre budget (${data.budget_range || 'à définir'})</p>
                        <p>2. <strong>Constituer</strong> une équipe projet avec un sponsor métier</p>
                        <p>3. <strong>Planifier</strong> selon votre niveau d'urgence (${data.urgency || 'à définir'})</p>
                        <p>4. <strong>Mesurer</strong> les gains après chaque étape</p>

                        <p style="margin-top: 15px; font-style: italic; color: #666;">
                            💡 <strong>Conseil :</strong> Pour une analyse plus approfondie et personnalisée,
                            utilisez une clé API pour bénéficier de recommandations adaptées par intelligence artificielle.
                        </p>
                    </div>
                </div>
            `;
        }

        function getSectorLabel(sector) {
            const labels = {
                'industrie': 'Industrie & Manufacturing',
                'btp': 'BTP & Construction',
                'services': 'Services & Conseil',
                'commerce': 'Commerce & Distribution',
                'sante': 'Santé & Médical',
                'education': 'Éducation & Formation',
                'transport': 'Transport & Logistique',
                'agriculture': 'Agriculture & Agroalimentaire',
                'finance': 'Finance & Banque'
            };
            return labels[sector] || sector;
        }

        function getDomainAnalysis(domain, score, type) {
            const analyses = {
                'Commercial & Marketing': {
                    strong: 'Bonne maîtrise des outils de prospection et de suivi client. L\'entreprise capitalise efficacement sur ses relations commerciales.',
                    weak: 'Opportunités d\'amélioration sur la digitalisation du processus commercial et l\'automatisation du marketing.'
                },
                'Production & Opérations': {
                    strong: 'Processus opérationnels bien structurés avec des outils de planification et de suivi adaptés.',
                    weak: 'Potentiel d\'optimisation via l\'automatisation, l\'IoT et l\'amélioration du suivi temps réel.'
                },
                'Service Client': {
                    strong: 'Organisation client satisfaisante avec des processus de support structurés.',
                    weak: 'Amélioration possible de l\'expérience client via des outils de self-service et d\'automatisation.'
                },
                'Ressources Humaines': {
                    strong: 'Gestion RH organisée avec de bons outils de collaboration et de suivi des équipes.',
                    weak: 'Opportunités de digitalisation des processus RH et d\'amélioration de la collaboration.'
                },
                'Finance & Administration': {
                    strong: 'Processus administratifs et financiers bien maîtrisés avec des outils adaptés.',
                    weak: 'Potentiel d\'automatisation et d\'intégration des processus administratifs et financiers.'
                },
                'Infrastructure': {
                    strong: 'Infrastructure technique robuste permettant de supporter la croissance digitale.',
                    weak: 'Modernisation nécessaire de l\'infrastructure pour supporter une transformation digitale avancée.'
                },
                'Innovation & Data': {
                    strong: 'Bonne approche de l\'innovation et exploitation efficace des données disponibles.',
                    weak: 'Opportunités importantes d\'exploitation des données et de développement d\'une culture d\'innovation.'
                }
            };

            return analyses[domain] ? analyses[domain][type] :
                   `Score de ${score}% dans ce domaine ${type === 'strong' ? 'témoigne d\'une bonne maîtrise' : 'indique des axes d\'amélioration'}.`;
        }

        function getSectorRecommendations(sector, scores) {
            const recommendations = {
                'industrie': [
                    'Intégration IoT pour le monitoring des équipements',
                    'Mise en place de maintenance prédictive',
                    'Digitalisation de la chaîne logistique',
                    'Implémentation d\'un MES (Manufacturing Execution System)'
                ],
                'btp': [
                    'Applications mobiles pour le suivi de chantiers',
                    'Maquettes numériques BIM pour améliorer la collaboration',
                    'Géolocalisation des équipes et matériels',
                    'Dématérialisation des rapports de chantier'
                ],
                'services': [
                    'CRM avancé pour la gestion de la relation client',
                    'Outils de facturation au temps et gestion de projets',
                    'Portail client pour le suivi des prestations',
                    'Knowledge management pour capitaliser l\'expertise'
                ],
                'commerce': [
                    'Plateforme e-commerce omnicanale',
                    'Gestion intelligente des stocks',
                    'Analyse prédictive des ventes',
                    'Personnalisation de l\'expérience client'
                ],
                'sante': [
                    'Dossier patient électronique sécurisé',
                    'Télémédecine et consultations à distance',
                    'Planning intelligent des ressources',
                    'Conformité RGPD renforcée'
                ],
                'education': [
                    'Plateforme LMS pour l\'apprentissage en ligne',
                    'Outils de collaboration étudiants-enseignants',
                    'Gestion digitale des inscriptions et évaluations',
                    'Analytics d\'apprentissage'
                ],
                'transport': [
                    'Optimisation des tournées par algorithmes',
                    'Traçabilité temps réel des expéditions',
                    'Gestion intelligente de la flotte',
                    'Intégration EDI avec les partenaires'
                ],
                'agriculture': [
                    'Agriculture de précision avec capteurs IoT',
                    'Traçabilité de la production',
                    'Gestion optimisée des ressources (eau, fertilisants)',
                    'Plateformes de vente directe'
                ],
                'finance': [
                    'Digitalisation complète du parcours client',
                    'IA pour la détection de fraude',
                    'API banking pour les partenariats fintech',
                    'Conformité réglementaire automatisée'
                ]
            };

            return recommendations[sector] || [
                'Audit approfondi des processus métier',
                'Cartographie des flux d\'information',
                'Benchmark sectoriel des meilleures pratiques',
                'Roadmap de transformation adaptée'
            ];
        }

        function getPriorityRecommendations(data, scores) {
            const quickWins = [];
            const structural = [];

            // Analyse des scores pour générer des recommandations
            Object.keys(scores).forEach(domain => {
                if (domain === 'Global') return;

                const score = scores[domain];

                if (score < 30) {
                    // Domaines très faibles = projets structurants
                    if (domain.includes('Commercial')) {
                        structural.push('Implémentation d\'un CRM et digitalisation du processus de vente');
                    } else if (domain.includes('Production')) {
                        structural.push('Mise en place d\'un système de planification et suivi de production');
                    } else if (domain.includes('Infrastructure')) {
                        structural.push('Modernisation complète de l\'infrastructure informatique');
                    }
                } else if (score < 60) {
                    // Domaines moyens = quick wins possibles
                    if (domain.includes('Commercial')) {
                        quickWins.push('Amélioration du site web et mise en place d\'outils de prospection digitale');
                    } else if (domain.includes('Service Client')) {
                        quickWins.push('Création d\'une FAQ en ligne et amélioration de la communication client');
                    } else if (domain.includes('RH')) {
                        quickWins.push('Déploiement d\'outils de collaboration (Teams, Slack) et digitalisation des plannings');
                    }
                }
            });

            // Recommandations par défaut si peu de données
            if (quickWins.length === 0) {
                quickWins.push(
                    'Audit de sécurité informatique et mise en place de sauvegardes automatiques',
                    'Formation des équipes aux outils digitaux existants',
                    'Dématérialisation des documents administratifs'
                );
            }

            if (structural.length === 0) {
                structural.push(
                    'Élaboration d\'une stratégie de transformation digitale globale',
                    'Choix et implémentation d\'un ERP adapté au secteur',
                    'Mise en place d\'indicateurs de performance digitaux'
                );
            }

            return { quickWins, structural };
        }

        function upgradeToAI() {
            const apiSection = document.querySelector('.api-config');
            apiSection.scrollIntoView({ behavior: 'smooth' });
            document.getElementById('apiKey').focus();
            alert('Veuillez saisir votre clé API ci-dessus pour bénéficier de l\'analyse IA personnalisée.');
        }

        // Fonction de cache pour les rapports basiques
        function getCachedBasicReport(formData) {
            const cacheKey = 'basic_report_' + JSON.stringify(formData).length; // Simple hash
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                const parsed = JSON.parse(cached);
                // Vérifier si les données sont identiques (simple vérification)
                if (parsed.timestamp > Date.now() - 3600000) { // Cache valide 1 heure
                    return parsed.report;
                }
            }
            return null;
        }

        function cacheBasicReport(formData, report) {
            const cacheKey = 'basic_report_' + JSON.stringify(formData).length;
            const cacheData = {
                report: report,
                timestamp: Date.now(),
                company: formData.company_info.name
            };
            localStorage.setItem(cacheKey, JSON.stringify(cacheData));
        }

        // Analytics pour suivre l'utilisation des modes
        function trackUsage(mode) {
            const usage = JSON.parse(localStorage.getItem('audit_usage') || '{"ai": 0, "basic": 0}');
            usage[mode]++;
            localStorage.setItem('audit_usage', JSON.stringify(usage));
        }

        // Fonction pour afficher les statistiques d'utilisation
        function showUsageStats() {
            const usage = JSON.parse(localStorage.getItem('audit_usage') || '{"ai": 0, "basic": 0}');
            const total = usage.ai + usage.basic;
            if (total > 0) {
                alert(`Statistiques d'utilisation :\n` +
                      `Rapports IA : ${usage.ai} (${Math.round(usage.ai/total*100)}%)\n` +
                      `Rapports basiques : ${usage.basic} (${Math.round(usage.basic/total*100)}%)\n` +
                      `Total : ${total} rapports générés`);
            } else {
                alert('Aucun rapport généré pour le moment.');
            }
        }

        // Fonctions graphiques et utilitaires (identiques à la version précédente)
        function createRadarChart(scores) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (radarChart) radarChart.destroy();

            const domains = Object.keys(scores).filter(domain => domain !== 'Global');
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: domains.map(domain => domain.length > 15 ? domain.substring(0, 15) + '...' : domain),
                    datasets: [{
                        label: 'Score de Maturité (%)',
                        data: domains.map(domain => scores[domain]),
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                        pointBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { stepSize: 20 } } }
                }
            });
        }

        function createBarChart(scores) {
            const ctx = document.getElementById('barChart').getContext('2d');
            if (barChart) barChart.destroy();

            const domains = Object.keys(scores).filter(domain => domain !== 'Global');
            
            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: domains.map(domain => domain.length > 15 ? domain.substring(0, 15) + '...' : domain),
                    datasets: [{
                        label: 'Score de Maturité (%)',
                        data: domains.map(domain => scores[domain]),
                        backgroundColor: domains.map(domain => {
                            const score = scores[domain];
                            if (score >= 80) return 'rgba(46, 204, 113, 0.8)';
                            if (score >= 60) return 'rgba(241, 196, 15, 0.8)';
                            if (score >= 40) return 'rgba(230, 126, 34, 0.8)';
                            return 'rgba(231, 76, 60, 0.8)';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        function displayGlobalScores(scores) {
            const container = document.getElementById('globalScores');
            const globalScore = scores['Global'];
            
            let maturityLevel = '';
            let maturityColor = '';
            
            if (globalScore >= 80) { maturityLevel = 'Avancée'; maturityColor = '#2ecc71'; }
            else if (globalScore >= 60) { maturityLevel = 'Intermédiaire'; maturityColor = '#f1c40f'; }
            else if (globalScore >= 40) { maturityLevel = 'Basique'; maturityColor = '#e67e22'; }
            else { maturityLevel = 'Émergente'; maturityColor = '#e74c3c'; }

            const domains = Object.keys(scores).filter(domain => domain !== 'Global');
            const sortedDomains = domains.sort((a, b) => scores[b] - scores[a]);

            container.innerHTML = `
                <div class="score-item">
                    <div class="score-value">${globalScore}%</div>
                    <div class="score-label">Score Global</div>
                </div>
                <div class="score-item" style="background: ${maturityColor};">
                    <div class="score-value">${maturityLevel}</div>
                    <div class="score-label">Maturité</div>
                </div>
                <div class="score-item">
                    <div class="score-value">${scores[sortedDomains[0]]}%</div>
                    <div class="score-label">Point fort</div>
                </div>
                <div class="score-item">
                    <div class="score-value">${scores[sortedDomains[sortedDomains.length - 1]]}%</div>
                    <div class="score-label">À améliorer</div>
                </div>
            `;
        }

        async function generateReport() {
            const generateBtn = document.getElementById('generateReport');
            const loadingDiv = document.getElementById('loading');
            const reportSection = document.getElementById('reportSection');

            try {
                const apiKey = document.getElementById('apiKey').value;
                const companyName = document.getElementById('company_name').value;

                if (!companyName) {
                    alert('Veuillez saisir le nom de l\'entreprise');
                    return;
                }

                generateBtn.disabled = true;
                loadingDiv.style.display = 'block';
                reportSection.style.display = 'none';

                const formData = collectFormData();
                const scores = calculateMaturityScores(formData);

                let reportContentHTML;
                let isDegradedMode = false;

                // Update loading message
                const loadingText = loadingDiv.querySelector('p');
                loadingText.textContent = apiKey ?
                    'Analyse en cours et génération du rapport personnalisé...' :
                    'Génération du rapport d\'analyse basique...';

                if (!apiKey) {
                    // Mode dégradé sans API
                    const confirmDegraded = confirm(
                        'Aucune clé API détectée.\n\n' +
                        'Voulez-vous générer un rapport basique (sans analyse IA personnalisée) ?\n\n' +
                        '✓ Scores et graphiques\n' +
                        '✓ Recommandations génériques\n' +
                        '✗ Analyse personnalisée'
                    );

                    if (!confirmDegraded) {
                        generateBtn.disabled = false;
                        loadingDiv.style.display = 'none';
                        return;
                    }

                    // Générer rapport dégradé (avec cache)
                    let cachedReport = getCachedBasicReport(formData);
                    if (cachedReport) {
                        reportContentHTML = cachedReport;
                    } else {
                        reportContentHTML = generateBasicReport(formData, scores);
                        cacheBasicReport(formData, reportContentHTML);
                    }
                    isDegradedMode = true;
                    trackUsage('basic');
                } else {
                    // Mode IA normal
                    const aiAnalysis = await generateAIAnalysis(formData, scores);
                    reportContentHTML = `
                        <div style="white-space: pre-wrap; line-height: 1.8; font-size: 14px;">
                            ${aiAnalysis
                                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #2c3e50; font-size: 1.1em;">$1</strong>')
                                .replace(/^(\d+\..*$)/gm, '<h3 style="color: #3498db; margin: 20px 0 10px 0; font-size: 1.2em;">$1</h3>')
                                .replace(/^(-.*$)/gm, '<li style="margin: 5px 0;">$1</li>')
                                .replace(/\n/g, '<br>')
                            }
                        </div>
                    `;
                    trackUsage('ai');
                }

                displayGlobalScores(scores);
                createRadarChart(scores);
                createBarChart(scores);

                const reportContent = document.getElementById('reportContent');

                // Ajouter l'indicateur de mode dégradé si nécessaire
                const degradedModeIndicator = isDegradedMode ? `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #856404; margin-bottom: 10px;">ℹ️ Mode d'analyse basique</h4>
                        <p style="color: #856404; margin: 0;">
                            Ce rapport a été généré sans intelligence artificielle.
                            Pour une analyse personnalisée et des recommandations sur-mesure,
                            utilisez une clé API (Claude, GPT, Gemini ou Grok).
                        </p>
                        <button onclick="upgradeToAI()" style="background: #3498db; color: white; padding: 8px 16px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer;">
                            🤖 Passer au mode IA personnalisé
                        </button>
                    </div>
                ` : '';

                reportContent.innerHTML = degradedModeIndicator + reportContentHTML;

                reportSection.style.display = 'block';
                reportSection.scrollIntoView({ behavior: 'smooth' });
                saveProgress();

            } catch (error) {
                console.error('Erreur:', error);
                alert(`Erreur lors de la génération du rapport: ${error.message}`);
            } finally {
                generateBtn.disabled = false;
                loadingDiv.style.display = 'none';
            }
        }

        // Fonctions utilitaires
        function saveProgress() {
            const formData = collectFormData();
            localStorage.setItem('audit_progress', JSON.stringify(formData));
            alert('Progression sauvegardée !');
        }

        function loadProgress() {
            const saved = localStorage.getItem('audit_progress');
            if (saved) {
                alert('Progression restaurée !');
                // Logique de restauration simplifiée
            } else {
                alert('Aucune sauvegarde trouvée.');
            }
        }

        function loadDemoData() {
            if (!confirm('Cette action va remplir le formulaire avec des données de démonstration.\n\nVoulez-vous continuer ?')) {
                return;
            }

            // Informations générales
            document.getElementById('company_name').value = 'TechSolutions SARL';
            document.getElementById('contact_name').value = 'Marie Dupont';
            document.getElementById('contact_role').value = 'Directrice Générale';
            document.getElementById('audit_date').value = new Date().toISOString().split('T')[0];
            document.getElementById('employee_count').value = '45';
            document.getElementById('company_context').value = 'TechSolutions est une entreprise de services informatiques spécialisée dans le développement d\'applications web et mobiles. Créée il y a 8 ans, elle compte 45 employés et réalise un chiffre d\'affaires de 4,2M€. L\'entreprise opère principalement en France avec quelques clients internationaux.';

            // Sélection secteur
            document.querySelector('input[name="sector"][value="services"]').checked = true;

            // Configuration API (optionnelle pour la démo)
            document.querySelector('input[name="api_provider"][value="anthropic"]').checked = true;

            // Commercial & Marketing
            document.querySelector('input[name="commercial"][value="crm_structure"]').checked = true;
            document.querySelector('input[name="commercial"][value="site_web_pro"]').checked = true;
            document.querySelector('input[name="commercial"][value="marketing_automation"]').checked = true;
            document.querySelector('input[name="commercial"][value="analytics"]').checked = true;
            document.getElementById('commercial_notes').value = 'L\'entreprise utilise un CRM basique et a un site web professionnel. Cependant, les processus de marketing automation et d\'analytics sont encore limités.';

            // Vente
            document.querySelector('input[name="vente"][value="logiciel_devis"]').checked = true;
            document.querySelector('input[name="vente"][value="signature_electronique"]').checked = true;
            document.querySelector('input[name="vente"][value="suivi_pipeline"]').checked = true;
            document.getElementById('vente_notes').value = 'Processus de vente structuré avec devis automatisés et signature électronique. Le suivi du pipeline commercial pourrait être amélioré.';

            // Production & Opérations
            document.querySelector('input[name="production"][value="planning_digital"]').checked = true;
            document.querySelector('input[name="production"][value="suivi_temps_reel"]').checked = true;
            document.querySelector('input[name="production"][value="gestion_priorites"]').checked = true;
            document.querySelector('input[name="production"][value="kpi_dashboards"]').checked = true;
            document.querySelector('input[name="ressources"][value="gestion_stocks"]').checked = true;
            document.querySelector('input[name="ressources"][value="codes_barres"]').checked = true;
            document.getElementById('production_notes').value = 'L\'équipe utilise des outils de gestion de projet modernes mais la planification opérationnelle pourrait être optimisée avec des tableaux de bord plus avancés.';

            // Service Client
            document.querySelector('input[name="service_client"][value="helpdesk"]').checked = true;
            document.querySelector('input[name="service_client"][value="portail_client"]').checked = true;
            document.querySelector('input[name="service_client"][value="chat_support"]').checked = true;
            document.querySelector('input[name="service_client"][value="knowledge_base"]').checked = true;
            document.getElementById('service_notes').value = 'Support client organisé avec helpdesk et portail client. L\'expérience pourrait être enrichie avec un chatbot et une base de connaissances plus complète.';

            // RH
            document.querySelector('input[name="rh"][value="sirh"]').checked = true;
            document.querySelector('input[name="rh"][value="planning_equipes"]').checked = true;
            document.querySelector('input[name="rh"][value="formation_elearning"]').checked = true;
            document.querySelector('input[name="rh"][value="collaboration_tools"]').checked = true;
            document.getElementById('rh_notes').value = 'SIRH en place avec planning digital et outils collaboratifs. La formation e-learning est utilisée mais pourrait être étendue.';

            // Finance & Admin
            document.querySelector('input[name="finance"][value="erp_integre"]').checked = true;
            document.querySelector('input[name="finance"][value="facturation_electronique"]').checked = true;
            document.querySelector('input[name="finance"][value="reporting_financier"]').checked = true;
            document.querySelector('input[name="finance"][value="dematerialisation"]').checked = true;
            document.getElementById('finance_notes').value = 'ERP intégré avec facturation électronique et dématérialisation administrative. Le reporting financier est automatisé.';

            // Infrastructure
            document.querySelector('input[name="infrastructure"][value="cloud_adoption"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="parc_moderne"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="reseau_performant"]').checked = true;
            document.querySelector('input[name="infrastructure"][value="integration_api"]').checked = true;
            document.querySelector('input[name="securite"][value="cybersecurite"]').checked = true;
            document.querySelector('input[name="securite"][value="sauvegarde_auto"]').checked = true;
            document.querySelector('input[name="securite"][value="rgpd_compliance"]').checked = true;
            document.getElementById('infrastructure_notes').value = 'Infrastructure cloud moderne avec sécurité avancée. Bonne conformité RGPD et sauvegardes automatiques.';

            // Innovation & Data
            document.querySelector('input[name="data"][value="business_intelligence"]').checked = true;
            document.querySelector('input[name="data"][value="data_analytics"]').checked = true;
            document.querySelector('input[name="data"][value="data_governance"]').checked = true;
            document.querySelector('input[name="innovation"][value="veille_techno"]').checked = true;
            document.querySelector('input[name="innovation"][value="roadmap_digitale"]').checked = true;
            document.getElementById('innovation_notes').value = 'Business Intelligence en place avec analytics avancés. Veille technologique organisée et roadmap digitale définie.';

            // Synthèse
            document.getElementById('pain_points').value = 'Difficultés de recrutement de profils techniques, concurrence accrue sur le marché, besoin d\'accélérer la transformation digitale pour rester compétitif.';
            document.getElementById('ambitions').value = 'Croissance de 30% en 2 ans, diversification vers de nouveaux secteurs, amélioration de la productivité de 25%, développement de l\'innovation produit.';
            document.getElementById('budget_range').value = '50k-100k';
            document.getElementById('urgency').value = 'important';

            // Sauvegarde automatique
            saveProgress();

            alert('✅ Données de démonstration chargées !\n\nVous pouvez maintenant générer le rapport pour voir le résultat.');
        }

        
        function resetForm() {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser le formulaire ?')) {
                const keepApiKey = confirm('Voulez-vous conserver la clé API sauvegardée ?');

                localStorage.removeItem('audit_progress');
                if (!keepApiKey) {
                    localStorage.removeItem('saved_api_key');
                }
                window.location.reload();
            }
        }

        function exportToPDF() { window.print(); }
        function shareReport() {
            if (navigator.share) {
                navigator.share({
                    title: 'Rapport Maturité Digitale',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Lien copié !');
            }
        }
        function newAudit() {
            if (confirm('Démarrer un nouvel audit ?')) {
                const keepApiKey = confirm('Voulez-vous conserver la clé API sauvegardée ?');

                localStorage.removeItem('audit_progress');
                if (!keepApiKey) {
                    localStorage.removeItem('saved_api_key');
                }
                window.location.reload();
            }
        }
    </script>
</body>
</html>
